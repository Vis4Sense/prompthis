import{H as Fs,b as Un,I as nn,J as rn,K as ts,L as lf,M as cf,N as ln,d as Le,t as Rn,r as Vt,m as Te,c as ff,e as it,f as ct,g as P,s as be,p as et,G as te,h as Ye,A as Ee,y as En,T as hf,l as Cr,o as Xs,F as ge,z as pe,B as br,w as Ds,O as zs,P as df,Q as vf,R as Xt,U as gf,V as es,W as pf,X as mf,Y as ns,i as yf}from"./index-3db1096c.js";function _f(t,e){const n=new Set(t),r=new Set(e),i=new Set([...n].filter(u=>r.has(u))),o=new Set([...n,...r]);return i.size/o.size}const Ls=Fs("session",{state:()=>({records:[],images:{},image_projection:{},text_projection:{},clusters:{},cache:null,edges:[],edgeGroups:[]}),getters:{promptSimilarityMatrix(t){const{records:e}=t,n=e.length,r=Array(n).fill(0).map(()=>Array(n).fill(0));for(let i=0;i<n;i++){const o=e[i].promptTokens;for(let u=i+1;u<n;u++){const l=e[u].promptTokens;r[i][u]=_f(o,l)}}return r}},actions:{async fetchSessionData(){const t=Un(),e={};t.userId!==null&&t.sessionId!==null&&(e.userId=t.userId,e.sessionId=t.sessionId);const n=await nn(rn.fetchSessionData,e),{records:r,images:i,image_projection:o,text_projection:u}=ts(n);this.records=r,this.images=i,this.image_projection=o,this.text_projection=u},async fetchFullImage(t,e){const n=Un(),{userId:r,sessionId:i}=n,o={userId:r,sessionId:i,filename:t},u=await nn(rn.fetchFullImage,o);return e(u.data),u},async runGeneration(t){const e=Un(),{userId:n,sessionId:r}=e,i=await nn(rn.runGeneration,{...t,userId:n,sessionId:r}),{status:o,promptId:u,message:l}=i,{prompt:v}=t;if(o!=="success")return o;this.cache={promptId:u,prompt:v},lf(()=>nn(rn.fetchNewData,{promptId:u,userId:n,sessionId:r}),m=>{const{records:_,images:k,image_projection:R,text_projection:A}=ts(m.data);console.log("new records",_),this.image_projection={...this.image_projection,...R},this.text_projection={...this.text_projection,...A},this.images={...this.images,...k},this.records=_,this.emptyCache()})},async tokenizePrompts(){const e={prompts:this.records.map(o=>({prompt:o.prompt}))},r=(await nn(rn.tokenizePrompts,e)).data.prompts,i=cf(this.records,r);this.records=i},async clusterImages(t,e){const n={embeddings:t,threshold:e},r=await nn(rn.clusterImages,n);this.clusters=r.data.clusters},async deriveEdges(t){const e=this.records.map(f=>({words:f.promptTokens.map(d=>({text:d,weight:1}))})),n=this.records.map(f=>f.outputFilenames.map(d=>d.slice(0,d.lastIndexOf(".")))),r=this.clusters,i={prompts:e,promptPairs:t,imageClusters:r,imageIndices:n},o=await nn(rn.deriveEdges,i),{edges:u,edgeGroups:l}=o.data,v=l;v.forEach((f,d)=>{const m=[];u.forEach((_,k)=>{_.word===f.word&&_.action===f.action&&_.src_clu===f.src_clu&&_.tgt_clu===f.tgt_clu&&m.push(k)}),f.edges=m,f.idx=d}),this.edges=u,this.edgeGroups=v},emptySessionData(){this.records=[],this.images={},this.image_projection={},this.text_projection={},this.clusters={},this.cache=null,this.edges=[],this.edgeGroups=[]},emptyCache(){this.cache=null}}}),Gs=Fs("controls",{state:()=>({showIVG:!0,embeddingWeight:.5,minSimilarity:.6,edgeWeightMax:1,edgeWeightThresh:.5,clusterThresh:.5,promptPairs:[],stages:[],fullImageModal:!1,fullImageData:null,copiedPrompt:null,hovered:null,selected:[]}),getters:{},actions:{toggleIVG(){this.showIVG=!this.showIVG},setEmbeddingWeight(t){this.embeddingWeight=t},setEdgeWeightMax(t){this.edgeWeightMax=t},setEdgeWeightThresh(t){this.edgeWeightThresh=t},setMinSimilarity(t){this.minSimilarity=t},setClusterThresh(t){this.clusterThresh=t},filterPromptPairs(t){const e=t.length,n=[];for(let r=0;r<e;r++)for(let i=r+1;i<e;i++)t[r][i]>this.minSimilarity&&n.push([r,i]);this.promptPairs=n},updateStages(t){const e=t.length,n=[...this.stages],r=n.flat();if(r.length>0&&e-r.length===1){t[e-2][e-1]>this.minSimilarity?n[n.length-1].push(e-1):n.push([e-1]),this.stages=n;return}n.length=0,r.length=0;const o=(r.length?r[r.length-1]:-1)+1;for(let u=o;u<e;u++)n.length===0?n.push([0]):t[u-1][u]>this.minSimilarity?n[n.length-1].push(u):n.push([u]);this.stages=n},segmentStages(t){console.log("segment stages",t);const e=[...this.stages],n=e.map(r=>r[0]);if(n.includes(t)){const r=n.indexOf(t);r>0&&(e[r-1]=e[r-1].concat(e[r]),e.splice(r,1))}else{const r=e.findIndex(v=>v.includes(t)),i=e[r],o=i.indexOf(t),u=i.slice(0,o),l=i.slice(o);e[r]=u,e.splice(r+1,0,l)}this.stages=e},emptyPromptPairs(){this.promptPairs=[]},emptyStages(){this.stages=[]},async openFullImage({data:t,filename:e}){if(this.fullImageModal=!0,this.fullImageData=t,e!==""){const n=Ls(),r=i=>{this.fullImageData=i};n.fetchFullImage(e,r)}},setCopiedPrompt(t){this.copiedPrompt=t,ln(()=>{this.copiedPrompt=null})},setHovered(t=null){console.log("set hovered",t),this.hovered=t},setSelected(t=null){console.log("set selected",t),t===null?this.selected=[]:this.selected=[t]},closeFullImage(){this.fullImageModal=!1,this.fullImageData=null}}}),bf={class:"flex items-center px-3"},xf={class:"text-xs mr-1"},wf={key:0,class:"text-xs mr-1"},kf={key:1,class:"text-xs ml-4"},or=Le({__name:"VSlider",props:{attributeName:{type:String,required:!0},descriptionStart:{type:String,default:""},descriptionEnd:{type:String,default:""},defaultValue:{type:Number,default:50},fillBar:{type:Boolean,default:!0},rangeDirection:{type:String,default:"lower"},leftValue:{type:Number,default:0},rightValue:{type:Number,default:100},precision:{type:Number,default:0}},emits:["input","change"],setup(t,{emit:e}){const n=t,{attributeName:r,leftValue:i,precision:o}=n,{rightValue:u,defaultValue:l}=Rn(n),v=R=>parseFloat((i+R*(u.value-i)/100).toFixed(o)),f=R=>(R-i)/(u.value-i)*100,d=Vt(f(l.value));Te(l,()=>{d.value=f(l.value)});const m=e,_=R=>{const A=v(R);return m("input",A),A},k=R=>{m("change",v(R))};return(R,A)=>{const J=ff("el-slider");return it(),ct("div",bf,[P("span",xf,be(et(r)),1),t.descriptionStart?(it(),ct("span",wf,be(t.descriptionStart),1)):te("",!0),Ye(J,{modelValue:d.value,"onUpdate:modelValue":A[0]||(A[0]=D=>d.value=D),size:"small",class:Ee(["w-16 ml-2 h-1",{"no-fill-bar":t.fillBar===!1,"reverse-bar":t.rangeDirection==="upper"}]),"format-tooltip":_,onChange:k},null,8,["modelValue","class"]),t.descriptionEnd?(it(),ct("span",kf,be(t.descriptionEnd),1)):te("",!0)])}}});const Af={class:"flex text-slate-50"},Mf={class:"px-3"},$f=Le({__name:"TheViewControls",setup(t){const e=Gs(),{embeddingWeight:n,minSimilarity:r,clusterThresh:i}=e,{edgeWeightMax:o,edgeWeightThresh:u}=En(e),{showIVG:l}=En(e),v=()=>{e.toggleIVG()},f=k=>{e.setEmbeddingWeight(k)},d=k=>{e.setEdgeWeightThresh(k)},m=k=>{e.setMinSimilarity(k)},_=k=>{e.setClusterThresh(k)};return(k,R)=>(it(),ct("div",Af,[P("div",Mf,[P("button",{class:Ee(["border border-0.5 py-1 px-2 hover:bg-neutral-700 text-xs rounded",{"bg-transparent":!et(l),"bg-neutral-600":et(l),"border-neutral-600":et(l),"border-neutral-400":!et(l),"text-neutral-400":!et(l),"text-neutral-100":et(l)}]),onClick:v}," IVG ",2)]),Ye(or,{"attribute-name":"Embedding:","description-start":"Text","description-end":"Image","fill-bar":!1,"right-value":1,precision:2,"default-value":et(n),onInput:f},null,8,["default-value"]),Ye(or,{"attribute-name":"Prompt similarity","range-direction":"upper","right-value":1,"left-value":.5,precision:2,"default-value":et(r),onInput:m},null,8,["default-value"]),Ye(or,{"attribute-name":"Edge weight","range-direction":"upper","right-value":et(o),precision:2,"default-value":et(u),onInput:d},null,8,["right-value","default-value"]),Ye(or,{"attribute-name":"Cluster distance","right-value":1,precision:2,"default-value":et(i),onChange:_},null,8,["default-value"])]))}}),If={class:"text-sm text-slate-50"},Ef=Le({__name:"TheViewUser",setup(t){const e=Un();return En(e),(n,r)=>(it(),ct("span",If,"User"))}}),Tf={class:"flex items-center justify-between bg-neutral-950 px-3 py-2"},h1=Le({__name:"TheViewHeader",setup(t){return(e,n)=>(it(),ct("div",Tf,[Ye(hf),Ye($f),Ye(Ef)]))}}),Sf="/prompthis/assets/copy-286e288a.svg",Nf="/prompthis/assets/raw-cd43697d.svg",Cf="/prompthis/assets/shrink-b0ab636b.svg";const Rf={},Pf={class:"loading-container"},Of=P("div",{class:"loader"},[P("div",{class:"dot dot1"}),P("div",{class:"dot dot2"}),P("div",{class:"dot dot3"})],-1),Yf=[Of];function Ff(t,e){return it(),ct("div",Pf,Yf)}const Xf=Cr(Rf,[["render",Ff]]),Df={class:"w-full h-full border-l-1 border-r-1 border-neutral-400 py-2"},zf=["id"],Lf={class:"hbrecord-prompt px-2 py-0 text-sm text-neutral-900"},Gf=["onMouseenter","onMouseleave"],Hf={key:0},Uf={key:1},qf=["onMouseenter","onMouseleave"],Vf={key:2},Bf=["onMouseenter","onMouseleave"],Wf={key:3,class:"absolute right-0 bottom-0 m-1 flex space-x-1"},Qf=["src","onClick"],Zf=["src","onClick"],jf=["src","onClick"],Jf={key:0,class:"relative p-1 text-neutral-600"},Kf={class:"p-1 px-2 pr-4 border border-neutral-400 bg-neutral-50 rounded-sm text-xs font-mono"},th={class:"absolute right-3 top-1 cursor-pointer p-0"},eh=["onClick"],nh={class:"hbrecord-prompt w-full px-2 py-1 grid grid-cols-4 gap-1 min-h-full place-items-center"},rh=["src","onClick","onMouseenter"],ah=Le({__name:"VHistoryBox",props:{records:{type:Array,required:!0},cache:{type:Object,default:null},hovered:{type:Object,default:null},selected:{type:Array,default:()=>[]}},emits:["open-image","copy-prompt","hover-image","unhover-image","hover-word","unhover-word","hover-prompt","unhover-prompt"],setup(t,{emit:e}){const n=t,{records:r,cache:i,selected:o,hovered:u}=Rn(n),l=Vt(),v=Vt(r.value.map(()=>!1)),f=Vt(r.value.map(()=>!1)),d=()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)},m=(J,D)=>{v.value[J]=D},_=(J,D=!0)=>{m(J,D),D?A("hover-prompt",J):A("unhover-prompt",null)};Te(r,()=>{ln(d)}),Te(o,()=>{if(o.value.length===0)return;const J=o.value[0],{field:D,value:ft,triggerView:nt}=J;if(D==="image"){const{promptIndex:H}=ft,F=document.getElementById("hbrecord-"+H);F&&F.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}else if(D==="prompt"){const H=document.getElementById("hbrecord-"+ft);H&&H.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}});const k=Vt(null),R=Vt(null);Te(u,()=>{if(u.value===null){k.value=null,R.value=null;return}const{field:J,value:D,triggerView:ft}=u.value;if(J==="image"){const{promptIndex:nt,imageIndex:H}=D;k.value=nt,R.value=D}else J==="prompt"&&(k.value=D)}),Xs(()=>{ln(d)});const A=e;return(J,D)=>(it(),ct("div",Df,[P("div",{class:"h-full overflow-y-auto smooth-scroll",ref_key:"recordContainer",ref:l},[(it(!0),ct(ge,null,pe(et(r),({meta:ft,details:nt},H)=>(it(),ct("div",{class:"hbrecord",key:H,id:"hbrecord-"+H},[P("div",Lf,[P("div",{class:Ee(["relative p-1 border rounded-md transition duration-300 ease-in-out transform hover:border-amber-200 hover:bg-amber-200 hover:bg-opacity-10",{"border-transparent":k.value!==H,"border-amber-200 bg-amber-200 bg-opacity-10":k.value===H}]),onMouseenter:F=>_(H,!0),onMouseleave:F=>_(H,!1)},[!ft.promptTokenDiff||!ft.promptTokens?(it(),ct("div",Hf,[P("span",null,be(ft.promptId+1+". "),1),P("span",null,be(ft.prompt),1)])):ft.showDiff?(it(),ct("div",Vf,[P("span",null,be(ft.promptId+1+". "),1),(it(!0),ct(ge,null,pe(ft.promptTokenDiff,(F,V)=>(it(),ct("span",{key:"hbrecord-"+H+"-"+V,class:Ee(["hover:bg-amber-200 cursor-pointer",["hb-word-"+F.action]]),onMouseenter:st=>A("hover-word",{action:F.action,text:F.text}),onMouseleave:st=>A("hover-prompt",H)},be(F.text+" "),43,Bf))),128))])):(it(),ct("div",Uf,[P("span",null,be(ft.promptId+1+". "),1),(it(!0),ct(ge,null,pe(ft.promptTokens,(F,V)=>(it(),ct("span",{key:"hbrecord-"+H+"-"+V,class:"hover:bg-amber-200 cursor-pointer",onMouseenter:st=>A("hover-word",{action:null,text:F}),onMouseleave:st=>A("hover-prompt",H)},be(F+" "),41,qf))),128))])),v.value[H]?(it(),ct("div",Wf,[f.value[H]?te("",!0):(it(),ct("img",{key:0,src:et(Nf),class:"w-4 h-4 cursor-pointer",onClick:()=>f.value[H]=!0},null,8,Qf)),f.value[H]?(it(),ct("img",{key:1,src:et(Cf),class:"w-4 h-4 cursor-pointer",onClick:()=>f.value[H]=!1},null,8,Zf)):te("",!0),P("img",{src:et(Sf),class:"w-4 h-4 cursor-pointer",onClick:F=>A("copy-prompt",ft.prompt)},null,8,jf)])):te("",!0)],42,Gf),Ye(zs,null,{default:Ds(()=>[f.value[H]?(it(),ct("div",Jf,[P("div",Kf,be(ft.prompt),1),P("div",th,[P("span",{class:"hover:font-bold",onClick:()=>f.value[H]=!1},"×",8,eh)])])):te("",!0)]),_:2},1024)]),P("div",nh,[(it(!0),ct(ge,null,pe(nt,(F,V)=>(it(),ct("div",{key:F.id,class:Ee(["cursor-pointer p-1 rounded-sm hover:shadow-custom hover:bg-amber-200 col-span-1",{"shadow-custom bg-amber-200":R.value&&R.value.promptIndex===H&&R.value.imageId===F.id}])},[P("img",{src:"data:image/png;base64,"+F.data,onClick:st=>A("open-image",{data:F.data,filename:F.id}),onMouseenter:st=>A("hover-image",{promptIndex:H,imageIndex:V,imageId:F.id}),onMouseleave:D[0]||(D[0]=st=>A("unhover-image",null))},null,40,rh)],2))),128))])],8,zf))),128)),et(i)?(it(),br(Xf,{key:0})):te("",!0)],512)]))}});const ih=Cr(ah,[["__scopeId","data-v-accdc8d2"]]);var Hs={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(t,e){(function(n,r){t.exports=r()})(df,function(){for(var n=function(a,s,c){return s===void 0&&(s=0),c===void 0&&(c=1),a<s?s:a>c?c:a},r=n,i=function(a){a._clipped=!1,a._unclipped=a.slice(0);for(var s=0;s<=3;s++)s<3?((a[s]<0||a[s]>255)&&(a._clipped=!0),a[s]=r(a[s],0,255)):s===3&&(a[s]=r(a[s],0,1));return a},o={},u=0,l=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];u<l.length;u+=1){var v=l[u];o["[object "+v+"]"]=v.toLowerCase()}var f=function(a){return o[Object.prototype.toString.call(a)]||"object"},d=f,m=function(a,s){return s===void 0&&(s=null),a.length>=3?Array.prototype.slice.call(a):d(a[0])=="object"&&s?s.split("").filter(function(c){return a[0][c]!==void 0}).map(function(c){return a[0][c]}):a[0]},_=f,k=function(a){if(a.length<2)return null;var s=a.length-1;return _(a[s])=="string"?a[s].toLowerCase():null},R=Math.PI,A={clip_rgb:i,limit:n,type:f,unpack:m,last:k,PI:R,TWOPI:R*2,PITHIRD:R/3,DEG2RAD:R/180,RAD2DEG:180/R},J={format:{},autodetect:[]},D=A.last,ft=A.clip_rgb,nt=A.type,H=J,F=function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];var g=this;if(nt(s[0])==="object"&&s[0].constructor&&s[0].constructor===this.constructor)return s[0];var b=D(s),w=!1;if(!b){w=!0,H.sorted||(H.autodetect=H.autodetect.sort(function(L,lt){return lt.p-L.p}),H.sorted=!0);for(var p=0,$=H.autodetect;p<$.length;p+=1){var I=$[p];if(b=I.test.apply(I,s),b)break}}if(H.format[b]){var Y=H.format[b].apply(null,w?s:s.slice(0,-1));g._rgb=ft(Y)}else throw new Error("unknown format: "+s);g._rgb.length===3&&g._rgb.push(1)};F.prototype.toString=function(){return nt(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var V=F,st=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(st.Color,[null].concat(a)))};st.Color=V,st.version="2.4.2";var $t=st,wt=A.unpack,Mt=Math.max,q=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=wt(a,"rgb"),g=c[0],b=c[1],w=c[2];g=g/255,b=b/255,w=w/255;var p=1-Mt(g,Mt(b,w)),$=p<1?1/(1-p):0,I=(1-g-p)*$,Y=(1-b-p)*$,L=(1-w-p)*$;return[I,Y,L,p]},vt=q,at=A.unpack,x=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=at(a,"cmyk");var c=a[0],g=a[1],b=a[2],w=a[3],p=a.length>4?a[4]:1;return w===1?[0,0,0,p]:[c>=1?0:255*(1-c)*(1-w),g>=1?0:255*(1-g)*(1-w),b>=1?0:255*(1-b)*(1-w),p]},z=x,O=$t,Q=V,ot=J,ht=A.unpack,ut=A.type,_t=vt;Q.prototype.cmyk=function(){return _t(this._rgb)},O.cmyk=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Q,[null].concat(a,["cmyk"])))},ot.format.cmyk=z,ot.autodetect.push({p:2,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=ht(a,"cmyk"),ut(a)==="array"&&a.length===4)return"cmyk"}});var rt=A.unpack,dt=A.last,St=function(a){return Math.round(a*100)/100},h=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=rt(a,"hsla"),g=dt(a)||"lsa";return c[0]=St(c[0]||0),c[1]=St(c[1]*100)+"%",c[2]=St(c[2]*100)+"%",g==="hsla"||c.length>3&&c[3]<1?(c[3]=c.length>3?c[3]:1,g="hsla"):c.length=3,g+"("+c.join(",")+")"},y=h,E=A.unpack,S=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=E(a,"rgba");var c=a[0],g=a[1],b=a[2];c/=255,g/=255,b/=255;var w=Math.min(c,g,b),p=Math.max(c,g,b),$=(p+w)/2,I,Y;return p===w?(I=0,Y=Number.NaN):I=$<.5?(p-w)/(p+w):(p-w)/(2-p-w),c==p?Y=(g-b)/(p-w):g==p?Y=2+(b-c)/(p-w):b==p&&(Y=4+(c-g)/(p-w)),Y*=60,Y<0&&(Y+=360),a.length>3&&a[3]!==void 0?[Y,I,$,a[3]]:[Y,I,$]},M=S,C=A.unpack,B=A.last,U=y,tt=M,j=Math.round,mt=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=C(a,"rgba"),g=B(a)||"rgb";return g.substr(0,3)=="hsl"?U(tt(c),g):(c[0]=j(c[0]),c[1]=j(c[1]),c[2]=j(c[2]),(g==="rgba"||c.length>3&&c[3]<1)&&(c[3]=c.length>3?c[3]:1,g="rgba"),g+"("+c.slice(0,g==="rgb"?3:4).join(",")+")")},yt=mt,bt=A.unpack,Nt=Math.round,Ht=function(){for(var a,s=[],c=arguments.length;c--;)s[c]=arguments[c];s=bt(s,"hsl");var g=s[0],b=s[1],w=s[2],p,$,I;if(b===0)p=$=I=w*255;else{var Y=[0,0,0],L=[0,0,0],lt=w<.5?w*(1+b):w+b-w*b,W=2*w-lt,pt=g/360;Y[0]=pt+1/3,Y[1]=pt,Y[2]=pt-1/3;for(var gt=0;gt<3;gt++)Y[gt]<0&&(Y[gt]+=1),Y[gt]>1&&(Y[gt]-=1),6*Y[gt]<1?L[gt]=W+(lt-W)*6*Y[gt]:2*Y[gt]<1?L[gt]=lt:3*Y[gt]<2?L[gt]=W+(lt-W)*(2/3-Y[gt])*6:L[gt]=W;a=[Nt(L[0]*255),Nt(L[1]*255),Nt(L[2]*255)],p=a[0],$=a[1],I=a[2]}return s.length>3?[p,$,I,s[3]]:[p,$,I,1]},zt=Ht,Ct=zt,ae=J,jt=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,kt=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,he=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,me=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Zt=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,ue=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ae=Math.round,ie=function(a){a=a.toLowerCase().trim();var s;if(ae.format.named)try{return ae.format.named(a)}catch{}if(s=a.match(jt)){for(var c=s.slice(1,4),g=0;g<3;g++)c[g]=+c[g];return c[3]=1,c}if(s=a.match(kt)){for(var b=s.slice(1,5),w=0;w<4;w++)b[w]=+b[w];return b}if(s=a.match(he)){for(var p=s.slice(1,4),$=0;$<3;$++)p[$]=Ae(p[$]*2.55);return p[3]=1,p}if(s=a.match(me)){for(var I=s.slice(1,5),Y=0;Y<3;Y++)I[Y]=Ae(I[Y]*2.55);return I[3]=+I[3],I}if(s=a.match(Zt)){var L=s.slice(1,4);L[1]*=.01,L[2]*=.01;var lt=Ct(L);return lt[3]=1,lt}if(s=a.match(ue)){var W=s.slice(1,4);W[1]*=.01,W[2]*=.01;var pt=Ct(W);return pt[3]=+s[4],pt}};ie.test=function(a){return jt.test(a)||kt.test(a)||he.test(a)||me.test(a)||Zt.test(a)||ue.test(a)};var Xe=ie,Se=$t,He=V,Pn=J,Fr=A.type,jn=yt,On=Xe;He.prototype.css=function(a){return jn(this._rgb,a)},Se.css=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(He,[null].concat(a,["css"])))},Pn.format.css=On,Pn.autodetect.push({p:5,test:function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];if(!s.length&&Fr(a)==="string"&&On.test(a))return"css"}});var Yn=V,Xr=$t,Jn=J,X=A.unpack;Jn.format.gl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=X(a,"rgba");return c[0]*=255,c[1]*=255,c[2]*=255,c},Xr.gl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Yn,[null].concat(a,["gl"])))},Yn.prototype.gl=function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var N=A.unpack,T=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=N(a,"rgb"),g=c[0],b=c[1],w=c[2],p=Math.min(g,b,w),$=Math.max(g,b,w),I=$-p,Y=I*100/255,L=p/(255-I)*100,lt;return I===0?lt=Number.NaN:(g===$&&(lt=(b-w)/I),b===$&&(lt=2+(w-g)/I),w===$&&(lt=4+(g-b)/I),lt*=60,lt<0&&(lt+=360)),[lt,Y,L]},K=T,G=A.unpack,xt=Math.floor,Et=function(){for(var a,s,c,g,b,w,p=[],$=arguments.length;$--;)p[$]=arguments[$];p=G(p,"hcg");var I=p[0],Y=p[1],L=p[2],lt,W,pt;L=L*255;var gt=Y*255;if(Y===0)lt=W=pt=L;else{I===360&&(I=0),I>360&&(I-=360),I<0&&(I+=360),I/=60;var Pt=xt(I),Ft=I-Pt,Lt=L*(1-Y),qt=Lt+gt*(1-Ft),de=Lt+gt*Ft,fe=Lt+gt;switch(Pt){case 0:a=[fe,de,Lt],lt=a[0],W=a[1],pt=a[2];break;case 1:s=[qt,fe,Lt],lt=s[0],W=s[1],pt=s[2];break;case 2:c=[Lt,fe,de],lt=c[0],W=c[1],pt=c[2];break;case 3:g=[Lt,qt,fe],lt=g[0],W=g[1],pt=g[2];break;case 4:b=[de,Lt,fe],lt=b[0],W=b[1],pt=b[2];break;case 5:w=[fe,Lt,qt],lt=w[0],W=w[1],pt=w[2];break}}return[lt,W,pt,p.length>3?p[3]:1]},Tt=Et,re=A.unpack,ne=A.type,It=$t,Rt=V,Ut=J,xe=K;Rt.prototype.hcg=function(){return xe(this._rgb)},It.hcg=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Rt,[null].concat(a,["hcg"])))},Ut.format.hcg=Tt,Ut.autodetect.push({p:1,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=re(a,"hcg"),ne(a)==="array"&&a.length===3)return"hcg"}});var Ie=A.unpack,vn=A.last,gn=Math.round,Eo=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=Ie(a,"rgba"),g=c[0],b=c[1],w=c[2],p=c[3],$=vn(a)||"auto";p===void 0&&(p=1),$==="auto"&&($=p<1?"rgba":"rgb"),g=gn(g),b=gn(b),w=gn(w);var I=g<<16|b<<8|w,Y="000000"+I.toString(16);Y=Y.substr(Y.length-6);var L="0"+gn(p*255).toString(16);switch(L=L.substr(L.length-2),$.toLowerCase()){case"rgba":return"#"+Y+L;case"argb":return"#"+L+Y;default:return"#"+Y}},Ua=Eo,To=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,So=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,No=function(a){if(a.match(To)){(a.length===4||a.length===7)&&(a=a.substr(1)),a.length===3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var s=parseInt(a,16),c=s>>16,g=s>>8&255,b=s&255;return[c,g,b,1]}if(a.match(So)){(a.length===5||a.length===9)&&(a=a.substr(1)),a.length===4&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);var w=parseInt(a,16),p=w>>24&255,$=w>>16&255,I=w>>8&255,Y=Math.round((w&255)/255*100)/100;return[p,$,I,Y]}throw new Error("unknown hex color: "+a)},qa=No,Co=$t,Va=V,Ro=A.type,Ba=J,Po=Ua;Va.prototype.hex=function(a){return Po(this._rgb,a)},Co.hex=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Va,[null].concat(a,["hex"])))},Ba.format.hex=qa,Ba.autodetect.push({p:4,test:function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];if(!s.length&&Ro(a)==="string"&&[3,4,5,6,7,8,9].indexOf(a.length)>=0)return"hex"}});var Oo=A.unpack,Wa=A.TWOPI,Yo=Math.min,Fo=Math.sqrt,Xo=Math.acos,Do=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=Oo(a,"rgb"),g=c[0],b=c[1],w=c[2];g/=255,b/=255,w/=255;var p,$=Yo(g,b,w),I=(g+b+w)/3,Y=I>0?1-$/I:0;return Y===0?p=NaN:(p=(g-b+(g-w))/2,p/=Fo((g-b)*(g-b)+(g-w)*(b-w)),p=Xo(p),w>b&&(p=Wa-p),p/=Wa),[p*360,Y,I]},zo=Do,Lo=A.unpack,Dr=A.limit,pn=A.TWOPI,zr=A.PITHIRD,mn=Math.cos,Go=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=Lo(a,"hsi");var c=a[0],g=a[1],b=a[2],w,p,$;return isNaN(c)&&(c=0),isNaN(g)&&(g=0),c>360&&(c-=360),c<0&&(c+=360),c/=360,c<1/3?($=(1-g)/3,w=(1+g*mn(pn*c)/mn(zr-pn*c))/3,p=1-($+w)):c<2/3?(c-=1/3,w=(1-g)/3,p=(1+g*mn(pn*c)/mn(zr-pn*c))/3,$=1-(w+p)):(c-=2/3,p=(1-g)/3,$=(1+g*mn(pn*c)/mn(zr-pn*c))/3,w=1-(p+$)),w=Dr(b*w*3),p=Dr(b*p*3),$=Dr(b*$*3),[w*255,p*255,$*255,a.length>3?a[3]:1]},Ho=Go,Uo=A.unpack,qo=A.type,Vo=$t,Qa=V,Za=J,Bo=zo;Qa.prototype.hsi=function(){return Bo(this._rgb)},Vo.hsi=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Qa,[null].concat(a,["hsi"])))},Za.format.hsi=Ho,Za.autodetect.push({p:2,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=Uo(a,"hsi"),qo(a)==="array"&&a.length===3)return"hsi"}});var Wo=A.unpack,Qo=A.type,Zo=$t,ja=V,Ja=J,jo=M;ja.prototype.hsl=function(){return jo(this._rgb)},Zo.hsl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(ja,[null].concat(a,["hsl"])))},Ja.format.hsl=zt,Ja.autodetect.push({p:2,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=Wo(a,"hsl"),Qo(a)==="array"&&a.length===3)return"hsl"}});var Jo=A.unpack,Ko=Math.min,tu=Math.max,eu=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=Jo(a,"rgb");var c=a[0],g=a[1],b=a[2],w=Ko(c,g,b),p=tu(c,g,b),$=p-w,I,Y,L;return L=p/255,p===0?(I=Number.NaN,Y=0):(Y=$/p,c===p&&(I=(g-b)/$),g===p&&(I=2+(b-c)/$),b===p&&(I=4+(c-g)/$),I*=60,I<0&&(I+=360)),[I,Y,L]},nu=eu,ru=A.unpack,au=Math.floor,iu=function(){for(var a,s,c,g,b,w,p=[],$=arguments.length;$--;)p[$]=arguments[$];p=ru(p,"hsv");var I=p[0],Y=p[1],L=p[2],lt,W,pt;if(L*=255,Y===0)lt=W=pt=L;else{I===360&&(I=0),I>360&&(I-=360),I<0&&(I+=360),I/=60;var gt=au(I),Pt=I-gt,Ft=L*(1-Y),Lt=L*(1-Y*Pt),qt=L*(1-Y*(1-Pt));switch(gt){case 0:a=[L,qt,Ft],lt=a[0],W=a[1],pt=a[2];break;case 1:s=[Lt,L,Ft],lt=s[0],W=s[1],pt=s[2];break;case 2:c=[Ft,L,qt],lt=c[0],W=c[1],pt=c[2];break;case 3:g=[Ft,Lt,L],lt=g[0],W=g[1],pt=g[2];break;case 4:b=[qt,Ft,L],lt=b[0],W=b[1],pt=b[2];break;case 5:w=[L,Ft,Lt],lt=w[0],W=w[1],pt=w[2];break}}return[lt,W,pt,p.length>3?p[3]:1]},su=iu,ou=A.unpack,uu=A.type,lu=$t,Ka=V,ti=J,cu=nu;Ka.prototype.hsv=function(){return cu(this._rgb)},lu.hsv=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Ka,[null].concat(a,["hsv"])))},ti.format.hsv=su,ti.autodetect.push({p:2,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=ou(a,"hsv"),uu(a)==="array"&&a.length===3)return"hsv"}});var Kn={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},yn=Kn,fu=A.unpack,ei=Math.pow,hu=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=fu(a,"rgb"),g=c[0],b=c[1],w=c[2],p=du(g,b,w),$=p[0],I=p[1],Y=p[2],L=116*I-16;return[L<0?0:L,500*($-I),200*(I-Y)]},Lr=function(a){return(a/=255)<=.04045?a/12.92:ei((a+.055)/1.055,2.4)},Gr=function(a){return a>yn.t3?ei(a,1/3):a/yn.t2+yn.t0},du=function(a,s,c){a=Lr(a),s=Lr(s),c=Lr(c);var g=Gr((.4124564*a+.3575761*s+.1804375*c)/yn.Xn),b=Gr((.2126729*a+.7151522*s+.072175*c)/yn.Yn),w=Gr((.0193339*a+.119192*s+.9503041*c)/yn.Zn);return[g,b,w]},ni=hu,_n=Kn,vu=A.unpack,gu=Math.pow,pu=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=vu(a,"lab");var c=a[0],g=a[1],b=a[2],w,p,$,I,Y,L;return p=(c+16)/116,w=isNaN(g)?p:p+g/500,$=isNaN(b)?p:p-b/200,p=_n.Yn*Ur(p),w=_n.Xn*Ur(w),$=_n.Zn*Ur($),I=Hr(3.2404542*w-1.5371385*p-.4985314*$),Y=Hr(-.969266*w+1.8760108*p+.041556*$),L=Hr(.0556434*w-.2040259*p+1.0572252*$),[I,Y,L,a.length>3?a[3]:1]},Hr=function(a){return 255*(a<=.00304?12.92*a:1.055*gu(a,1/2.4)-.055)},Ur=function(a){return a>_n.t1?a*a*a:_n.t2*(a-_n.t0)},ri=pu,mu=A.unpack,yu=A.type,_u=$t,ai=V,ii=J,bu=ni;ai.prototype.lab=function(){return bu(this._rgb)},_u.lab=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(ai,[null].concat(a,["lab"])))},ii.format.lab=ri,ii.autodetect.push({p:2,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=mu(a,"lab"),yu(a)==="array"&&a.length===3)return"lab"}});var xu=A.unpack,wu=A.RAD2DEG,ku=Math.sqrt,Au=Math.atan2,Mu=Math.round,$u=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=xu(a,"lab"),g=c[0],b=c[1],w=c[2],p=ku(b*b+w*w),$=(Au(w,b)*wu+360)%360;return Mu(p*1e4)===0&&($=Number.NaN),[g,p,$]},si=$u,Iu=A.unpack,Eu=ni,Tu=si,Su=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=Iu(a,"rgb"),g=c[0],b=c[1],w=c[2],p=Eu(g,b,w),$=p[0],I=p[1],Y=p[2];return Tu($,I,Y)},Nu=Su,Cu=A.unpack,Ru=A.DEG2RAD,Pu=Math.sin,Ou=Math.cos,Yu=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=Cu(a,"lch"),g=c[0],b=c[1],w=c[2];return isNaN(w)&&(w=0),w=w*Ru,[g,Ou(w)*b,Pu(w)*b]},oi=Yu,Fu=A.unpack,Xu=oi,Du=ri,zu=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=Fu(a,"lch");var c=a[0],g=a[1],b=a[2],w=Xu(c,g,b),p=w[0],$=w[1],I=w[2],Y=Du(p,$,I),L=Y[0],lt=Y[1],W=Y[2];return[L,lt,W,a.length>3?a[3]:1]},ui=zu,Lu=A.unpack,Gu=ui,Hu=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=Lu(a,"hcl").reverse();return Gu.apply(void 0,c)},Uu=Hu,qu=A.unpack,Vu=A.type,li=$t,tr=V,qr=J,ci=Nu;tr.prototype.lch=function(){return ci(this._rgb)},tr.prototype.hcl=function(){return ci(this._rgb).reverse()},li.lch=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(tr,[null].concat(a,["lch"])))},li.hcl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(tr,[null].concat(a,["hcl"])))},qr.format.lch=ui,qr.format.hcl=Uu,["lch","hcl"].forEach(function(a){return qr.autodetect.push({p:2,test:function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];if(s=qu(s,a),Vu(s)==="array"&&s.length===3)return a}})});var Bu={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},fi=Bu,Wu=V,hi=J,Qu=A.type,Fn=fi,Zu=qa,ju=Ua;Wu.prototype.name=function(){for(var a=ju(this._rgb,"rgb"),s=0,c=Object.keys(Fn);s<c.length;s+=1){var g=c[s];if(Fn[g]===a)return g.toLowerCase()}return a},hi.format.named=function(a){if(a=a.toLowerCase(),Fn[a])return Zu(Fn[a]);throw new Error("unknown color name: "+a)},hi.autodetect.push({p:5,test:function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];if(!s.length&&Qu(a)==="string"&&Fn[a.toLowerCase()])return"named"}});var Ju=A.unpack,Ku=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=Ju(a,"rgb"),g=c[0],b=c[1],w=c[2];return(g<<16)+(b<<8)+w},tl=Ku,el=A.type,nl=function(a){if(el(a)=="number"&&a>=0&&a<=16777215){var s=a>>16,c=a>>8&255,g=a&255;return[s,c,g,1]}throw new Error("unknown num color: "+a)},rl=nl,al=$t,di=V,vi=J,il=A.type,sl=tl;di.prototype.num=function(){return sl(this._rgb)},al.num=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(di,[null].concat(a,["num"])))},vi.format.num=rl,vi.autodetect.push({p:5,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a.length===1&&il(a[0])==="number"&&a[0]>=0&&a[0]<=16777215)return"num"}});var ol=$t,Vr=V,gi=J,pi=A.unpack,mi=A.type,yi=Math.round;Vr.prototype.rgb=function(a){return a===void 0&&(a=!0),a===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(yi)},Vr.prototype.rgba=function(a){return a===void 0&&(a=!0),this._rgb.slice(0,4).map(function(s,c){return c<3?a===!1?s:yi(s):s})},ol.rgb=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Vr,[null].concat(a,["rgb"])))},gi.format.rgb=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=pi(a,"rgba");return c[3]===void 0&&(c[3]=1),c},gi.autodetect.push({p:3,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=pi(a,"rgba"),mi(a)==="array"&&(a.length===3||a.length===4&&mi(a[3])=="number"&&a[3]>=0&&a[3]<=1))return"rgb"}});var er=Math.log,ul=function(a){var s=a/100,c,g,b;return s<66?(c=255,g=s<6?0:-155.25485562709179-.44596950469579133*(g=s-2)+104.49216199393888*er(g),b=s<20?0:-254.76935184120902+.8274096064007395*(b=s-10)+115.67994401066147*er(b)):(c=351.97690566805693+.114206453784165*(c=s-55)-40.25366309332127*er(c),g=325.4494125711974+.07943456536662342*(g=s-50)-28.0852963507957*er(g),b=255),[c,g,b,1]},_i=ul,ll=_i,cl=A.unpack,fl=Math.round,hl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];for(var c=cl(a,"rgb"),g=c[0],b=c[2],w=1e3,p=4e4,$=.4,I;p-w>$;){I=(p+w)*.5;var Y=ll(I);Y[2]/Y[0]>=b/g?p=I:w=I}return fl(I)},dl=hl,Br=$t,nr=V,Wr=J,vl=dl;nr.prototype.temp=nr.prototype.kelvin=nr.prototype.temperature=function(){return vl(this._rgb)},Br.temp=Br.kelvin=Br.temperature=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(nr,[null].concat(a,["temp"])))},Wr.format.temp=Wr.format.kelvin=Wr.format.temperature=_i;var gl=A.unpack,Qr=Math.cbrt,pl=Math.pow,ml=Math.sign,yl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=gl(a,"rgb"),g=c[0],b=c[1],w=c[2],p=[Zr(g/255),Zr(b/255),Zr(w/255)],$=p[0],I=p[1],Y=p[2],L=Qr(.4122214708*$+.5363325363*I+.0514459929*Y),lt=Qr(.2119034982*$+.6806995451*I+.1073969566*Y),W=Qr(.0883024619*$+.2817188376*I+.6299787005*Y);return[.2104542553*L+.793617785*lt-.0040720468*W,1.9779984951*L-2.428592205*lt+.4505937099*W,.0259040371*L+.7827717662*lt-.808675766*W]},bi=yl;function Zr(a){var s=Math.abs(a);return s<.04045?a/12.92:(ml(a)||1)*pl((s+.055)/1.055,2.4)}var _l=A.unpack,rr=Math.pow,bl=Math.sign,xl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=_l(a,"lab");var c=a[0],g=a[1],b=a[2],w=rr(c+.3963377774*g+.2158037573*b,3),p=rr(c-.1055613458*g-.0638541728*b,3),$=rr(c-.0894841775*g-1.291485548*b,3);return[255*jr(4.0767416621*w-3.3077115913*p+.2309699292*$),255*jr(-1.2684380046*w+2.6097574011*p-.3413193965*$),255*jr(-.0041960863*w-.7034186147*p+1.707614701*$),a.length>3?a[3]:1]},xi=xl;function jr(a){var s=Math.abs(a);return s>.0031308?(bl(a)||1)*(1.055*rr(s,1/2.4)-.055):a*12.92}var wl=A.unpack,kl=A.type,Al=$t,wi=V,ki=J,Ml=bi;wi.prototype.oklab=function(){return Ml(this._rgb)},Al.oklab=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(wi,[null].concat(a,["oklab"])))},ki.format.oklab=xi,ki.autodetect.push({p:3,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=wl(a,"oklab"),kl(a)==="array"&&a.length===3)return"oklab"}});var $l=A.unpack,Il=bi,El=si,Tl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];var c=$l(a,"rgb"),g=c[0],b=c[1],w=c[2],p=Il(g,b,w),$=p[0],I=p[1],Y=p[2];return El($,I,Y)},Sl=Tl,Nl=A.unpack,Cl=oi,Rl=xi,Pl=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];a=Nl(a,"lch");var c=a[0],g=a[1],b=a[2],w=Cl(c,g,b),p=w[0],$=w[1],I=w[2],Y=Rl(p,$,I),L=Y[0],lt=Y[1],W=Y[2];return[L,lt,W,a.length>3?a[3]:1]},Ol=Pl,Yl=A.unpack,Fl=A.type,Xl=$t,Ai=V,Mi=J,Dl=Sl;Ai.prototype.oklch=function(){return Dl(this._rgb)},Xl.oklch=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return new(Function.prototype.bind.apply(Ai,[null].concat(a,["oklch"])))},Mi.format.oklch=Ol,Mi.autodetect.push({p:3,test:function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(a=Yl(a,"oklch"),Fl(a)==="array"&&a.length===3)return"oklch"}});var $i=V,zl=A.type;$i.prototype.alpha=function(a,s){return s===void 0&&(s=!1),a!==void 0&&zl(a)==="number"?s?(this._rgb[3]=a,this):new $i([this._rgb[0],this._rgb[1],this._rgb[2],a],"rgb"):this._rgb[3]};var Ll=V;Ll.prototype.clipped=function(){return this._rgb._clipped||!1};var Ke=V,Gl=Kn;Ke.prototype.darken=function(a){a===void 0&&(a=1);var s=this,c=s.lab();return c[0]-=Gl.Kn*a,new Ke(c,"lab").alpha(s.alpha(),!0)},Ke.prototype.brighten=function(a){return a===void 0&&(a=1),this.darken(-a)},Ke.prototype.darker=Ke.prototype.darken,Ke.prototype.brighter=Ke.prototype.brighten;var Hl=V;Hl.prototype.get=function(a){var s=a.split("."),c=s[0],g=s[1],b=this[c]();if(g){var w=c.indexOf(g)-(c.substr(0,2)==="ok"?2:0);if(w>-1)return b[w];throw new Error("unknown channel "+g+" in mode "+c)}else return b};var bn=V,Ul=A.type,ql=Math.pow,Vl=1e-7,Bl=20;bn.prototype.luminance=function(a){if(a!==void 0&&Ul(a)==="number"){if(a===0)return new bn([0,0,0,this._rgb[3]],"rgb");if(a===1)return new bn([255,255,255,this._rgb[3]],"rgb");var s=this.luminance(),c="rgb",g=Bl,b=function(p,$){var I=p.interpolate($,.5,c),Y=I.luminance();return Math.abs(a-Y)<Vl||!g--?I:Y>a?b(p,I):b(I,$)},w=(s>a?b(new bn([0,0,0]),this):b(this,new bn([255,255,255]))).rgb();return new bn(w.concat([this._rgb[3]]))}return Wl.apply(void 0,this._rgb.slice(0,3))};var Wl=function(a,s,c){return a=Jr(a),s=Jr(s),c=Jr(c),.2126*a+.7152*s+.0722*c},Jr=function(a){return a/=255,a<=.03928?a/12.92:ql((a+.055)/1.055,2.4)},Me={},Ii=V,Ei=A.type,ar=Me,Ti=function(a,s,c){c===void 0&&(c=.5);for(var g=[],b=arguments.length-3;b-- >0;)g[b]=arguments[b+3];var w=g[0]||"lrgb";if(!ar[w]&&!g.length&&(w=Object.keys(ar)[0]),!ar[w])throw new Error("interpolation mode "+w+" is not defined");return Ei(a)!=="object"&&(a=new Ii(a)),Ei(s)!=="object"&&(s=new Ii(s)),ar[w](a,s,c).alpha(a.alpha()+c*(s.alpha()-a.alpha()))},Si=V,Ql=Ti;Si.prototype.mix=Si.prototype.interpolate=function(a,s){s===void 0&&(s=.5);for(var c=[],g=arguments.length-2;g-- >0;)c[g]=arguments[g+2];return Ql.apply(void 0,[this,a,s].concat(c))};var Ni=V;Ni.prototype.premultiply=function(a){a===void 0&&(a=!1);var s=this._rgb,c=s[3];return a?(this._rgb=[s[0]*c,s[1]*c,s[2]*c,c],this):new Ni([s[0]*c,s[1]*c,s[2]*c,c],"rgb")};var Kr=V,Zl=Kn;Kr.prototype.saturate=function(a){a===void 0&&(a=1);var s=this,c=s.lch();return c[1]+=Zl.Kn*a,c[1]<0&&(c[1]=0),new Kr(c,"lch").alpha(s.alpha(),!0)},Kr.prototype.desaturate=function(a){return a===void 0&&(a=1),this.saturate(-a)};var Ci=V,Ri=A.type;Ci.prototype.set=function(a,s,c){c===void 0&&(c=!1);var g=a.split("."),b=g[0],w=g[1],p=this[b]();if(w){var $=b.indexOf(w)-(b.substr(0,2)==="ok"?2:0);if($>-1){if(Ri(s)=="string")switch(s.charAt(0)){case"+":p[$]+=+s;break;case"-":p[$]+=+s;break;case"*":p[$]*=+s.substr(1);break;case"/":p[$]/=+s.substr(1);break;default:p[$]=+s}else if(Ri(s)==="number")p[$]=s;else throw new Error("unsupported value for Color.set");var I=new Ci(p,b);return c?(this._rgb=I._rgb,this):I}throw new Error("unknown channel "+w+" in mode "+b)}else return p};var jl=V,Jl=function(a,s,c){var g=a._rgb,b=s._rgb;return new jl(g[0]+c*(b[0]-g[0]),g[1]+c*(b[1]-g[1]),g[2]+c*(b[2]-g[2]),"rgb")};Me.rgb=Jl;var Kl=V,ta=Math.sqrt,xn=Math.pow,tc=function(a,s,c){var g=a._rgb,b=g[0],w=g[1],p=g[2],$=s._rgb,I=$[0],Y=$[1],L=$[2];return new Kl(ta(xn(b,2)*(1-c)+xn(I,2)*c),ta(xn(w,2)*(1-c)+xn(Y,2)*c),ta(xn(p,2)*(1-c)+xn(L,2)*c),"rgb")};Me.lrgb=tc;var ec=V,nc=function(a,s,c){var g=a.lab(),b=s.lab();return new ec(g[0]+c*(b[0]-g[0]),g[1]+c*(b[1]-g[1]),g[2]+c*(b[2]-g[2]),"lab")};Me.lab=nc;var Pi=V,wn=function(a,s,c,g){var b,w,p,$;g==="hsl"?(p=a.hsl(),$=s.hsl()):g==="hsv"?(p=a.hsv(),$=s.hsv()):g==="hcg"?(p=a.hcg(),$=s.hcg()):g==="hsi"?(p=a.hsi(),$=s.hsi()):g==="lch"||g==="hcl"?(g="hcl",p=a.hcl(),$=s.hcl()):g==="oklch"&&(p=a.oklch().reverse(),$=s.oklch().reverse());var I,Y,L,lt,W,pt;(g.substr(0,1)==="h"||g==="oklch")&&(b=p,I=b[0],L=b[1],W=b[2],w=$,Y=w[0],lt=w[1],pt=w[2]);var gt,Pt,Ft,Lt;return!isNaN(I)&&!isNaN(Y)?(Y>I&&Y-I>180?Lt=Y-(I+360):Y<I&&I-Y>180?Lt=Y+360-I:Lt=Y-I,Pt=I+c*Lt):isNaN(I)?isNaN(Y)?Pt=Number.NaN:(Pt=Y,(W==1||W==0)&&g!="hsv"&&(gt=lt)):(Pt=I,(pt==1||pt==0)&&g!="hsv"&&(gt=L)),gt===void 0&&(gt=L+c*(lt-L)),Ft=W+c*(pt-W),g==="oklch"?new Pi([Ft,gt,Pt],g):new Pi([Pt,gt,Ft],g)},rc=wn,Oi=function(a,s,c){return rc(a,s,c,"lch")};Me.lch=Oi,Me.hcl=Oi;var ac=V,ic=function(a,s,c){var g=a.num(),b=s.num();return new ac(g+c*(b-g),"num")};Me.num=ic;var sc=wn,oc=function(a,s,c){return sc(a,s,c,"hcg")};Me.hcg=oc;var uc=wn,lc=function(a,s,c){return uc(a,s,c,"hsi")};Me.hsi=lc;var cc=wn,fc=function(a,s,c){return cc(a,s,c,"hsl")};Me.hsl=fc;var hc=wn,dc=function(a,s,c){return hc(a,s,c,"hsv")};Me.hsv=dc;var vc=V,gc=function(a,s,c){var g=a.oklab(),b=s.oklab();return new vc(g[0]+c*(b[0]-g[0]),g[1]+c*(b[1]-g[1]),g[2]+c*(b[2]-g[2]),"oklab")};Me.oklab=gc;var pc=wn,mc=function(a,s,c){return pc(a,s,c,"oklch")};Me.oklch=mc;var ea=V,yc=A.clip_rgb,na=Math.pow,ra=Math.sqrt,aa=Math.PI,Yi=Math.cos,Fi=Math.sin,_c=Math.atan2,bc=function(a,s,c){s===void 0&&(s="lrgb"),c===void 0&&(c=null);var g=a.length;c||(c=Array.from(new Array(g)).map(function(){return 1}));var b=g/c.reduce(function(Pt,Ft){return Pt+Ft});if(c.forEach(function(Pt,Ft){c[Ft]*=b}),a=a.map(function(Pt){return new ea(Pt)}),s==="lrgb")return xc(a,c);for(var w=a.shift(),p=w.get(s),$=[],I=0,Y=0,L=0;L<p.length;L++)if(p[L]=(p[L]||0)*c[0],$.push(isNaN(p[L])?0:c[0]),s.charAt(L)==="h"&&!isNaN(p[L])){var lt=p[L]/180*aa;I+=Yi(lt)*c[0],Y+=Fi(lt)*c[0]}var W=w.alpha()*c[0];a.forEach(function(Pt,Ft){var Lt=Pt.get(s);W+=Pt.alpha()*c[Ft+1];for(var qt=0;qt<p.length;qt++)if(!isNaN(Lt[qt]))if($[qt]+=c[Ft+1],s.charAt(qt)==="h"){var de=Lt[qt]/180*aa;I+=Yi(de)*c[Ft+1],Y+=Fi(de)*c[Ft+1]}else p[qt]+=Lt[qt]*c[Ft+1]});for(var pt=0;pt<p.length;pt++)if(s.charAt(pt)==="h"){for(var gt=_c(Y/$[pt],I/$[pt])/aa*180;gt<0;)gt+=360;for(;gt>=360;)gt-=360;p[pt]=gt}else p[pt]=p[pt]/$[pt];return W/=g,new ea(p,s).alpha(W>.99999?1:W,!0)},xc=function(a,s){for(var c=a.length,g=[0,0,0,0],b=0;b<a.length;b++){var w=a[b],p=s[b]/c,$=w._rgb;g[0]+=na($[0],2)*p,g[1]+=na($[1],2)*p,g[2]+=na($[2],2)*p,g[3]+=$[3]*p}return g[0]=ra(g[0]),g[1]=ra(g[1]),g[2]=ra(g[2]),g[3]>.9999999&&(g[3]=1),new ea(yc(g))},Ne=$t,kn=A.type,wc=Math.pow,ia=function(a){var s="rgb",c=Ne("#ccc"),g=0,b=[0,1],w=[],p=[0,0],$=!1,I=[],Y=!1,L=0,lt=1,W=!1,pt={},gt=!0,Pt=1,Ft=function(Z){if(Z=Z||["#fff","#000"],Z&&kn(Z)==="string"&&Ne.brewer&&Ne.brewer[Z.toLowerCase()]&&(Z=Ne.brewer[Z.toLowerCase()]),kn(Z)==="array"){Z.length===1&&(Z=[Z[0],Z[0]]),Z=Z.slice(0);for(var At=0;At<Z.length;At++)Z[At]=Ne(Z[At]);w.length=0;for(var Yt=0;Yt<Z.length;Yt++)w.push(Yt/(Z.length-1))}return we(),I=Z},Lt=function(Z){if($!=null){for(var At=$.length-1,Yt=0;Yt<At&&Z>=$[Yt];)Yt++;return Yt-1}return 0},qt=function(Z){return Z},de=function(Z){return Z},fe=function(Z,At){var Yt,Ot;if(At==null&&(At=!1),isNaN(Z)||Z===null)return c;if(At)Ot=Z;else if($&&$.length>2){var ve=Lt(Z);Ot=ve/($.length-2)}else lt!==L?Ot=(Z-L)/(lt-L):Ot=1;Ot=de(Ot),At||(Ot=qt(Ot)),Pt!==1&&(Ot=wc(Ot,Pt)),Ot=p[0]+Ot*(1-p[0]-p[1]),Ot=Math.min(1,Math.max(0,Ot));var Jt=Math.floor(Ot*1e4);if(gt&&pt[Jt])Yt=pt[Jt];else{if(kn(I)==="array")for(var Gt=0;Gt<w.length;Gt++){var Bt=w[Gt];if(Ot<=Bt){Yt=I[Gt];break}if(Ot>=Bt&&Gt===w.length-1){Yt=I[Gt];break}if(Ot>Bt&&Ot<w[Gt+1]){Ot=(Ot-Bt)/(w[Gt+1]-Bt),Yt=Ne.interpolate(I[Gt],I[Gt+1],Ot,s);break}}else kn(I)==="function"&&(Yt=I(Ot));gt&&(pt[Jt]=Yt)}return Yt},we=function(){return pt={}};Ft(a);var Dt=function(Z){var At=Ne(fe(Z));return Y&&At[Y]?At[Y]():At};return Dt.classes=function(Z){if(Z!=null){if(kn(Z)==="array")$=Z,b=[Z[0],Z[Z.length-1]];else{var At=Ne.analyze(b);Z===0?$=[At.min,At.max]:$=Ne.limits(At,"e",Z)}return Dt}return $},Dt.domain=function(Z){if(!arguments.length)return b;L=Z[0],lt=Z[Z.length-1],w=[];var At=I.length;if(Z.length===At&&L!==lt)for(var Yt=0,Ot=Array.from(Z);Yt<Ot.length;Yt+=1){var ve=Ot[Yt];w.push((ve-L)/(lt-L))}else{for(var Jt=0;Jt<At;Jt++)w.push(Jt/(At-1));if(Z.length>2){var Gt=Z.map(function(Wt,Qt){return Qt/(Z.length-1)}),Bt=Z.map(function(Wt){return(Wt-L)/(lt-L)});Bt.every(function(Wt,Qt){return Gt[Qt]===Wt})||(de=function(Wt){if(Wt<=0||Wt>=1)return Wt;for(var Qt=0;Wt>=Bt[Qt+1];)Qt++;var Re=(Wt-Bt[Qt])/(Bt[Qt+1]-Bt[Qt]),je=Gt[Qt]+Re*(Gt[Qt+1]-Gt[Qt]);return je})}}return b=[L,lt],Dt},Dt.mode=function(Z){return arguments.length?(s=Z,we(),Dt):s},Dt.range=function(Z,At){return Ft(Z),Dt},Dt.out=function(Z){return Y=Z,Dt},Dt.spread=function(Z){return arguments.length?(g=Z,Dt):g},Dt.correctLightness=function(Z){return Z==null&&(Z=!0),W=Z,we(),W?qt=function(At){for(var Yt=fe(0,!0).lab()[0],Ot=fe(1,!0).lab()[0],ve=Yt>Ot,Jt=fe(At,!0).lab()[0],Gt=Yt+(Ot-Yt)*At,Bt=Jt-Gt,Wt=0,Qt=1,Re=20;Math.abs(Bt)>.01&&Re-- >0;)(function(){return ve&&(Bt*=-1),Bt<0?(Wt=At,At+=(Qt-At)*.5):(Qt=At,At+=(Wt-At)*.5),Jt=fe(At,!0).lab()[0],Bt=Jt-Gt})();return At}:qt=function(At){return At},Dt},Dt.padding=function(Z){return Z!=null?(kn(Z)==="number"&&(Z=[Z,Z]),p=Z,Dt):p},Dt.colors=function(Z,At){arguments.length<2&&(At="hex");var Yt=[];if(arguments.length===0)Yt=I.slice(0);else if(Z===1)Yt=[Dt(.5)];else if(Z>1){var Ot=b[0],ve=b[1]-Ot;Yt=kc(0,Z,!1).map(function(Qt){return Dt(Ot+Qt/(Z-1)*ve)})}else{a=[];var Jt=[];if($&&$.length>2)for(var Gt=1,Bt=$.length,Wt=1<=Bt;Wt?Gt<Bt:Gt>Bt;Wt?Gt++:Gt--)Jt.push(($[Gt-1]+$[Gt])*.5);else Jt=b;Yt=Jt.map(function(Qt){return Dt(Qt)})}return Ne[At]&&(Yt=Yt.map(function(Qt){return Qt[At]()})),Yt},Dt.cache=function(Z){return Z!=null?(gt=Z,Dt):gt},Dt.gamma=function(Z){return Z!=null?(Pt=Z,Dt):Pt},Dt.nodata=function(Z){return Z!=null?(c=Ne(Z),Dt):c},Dt};function kc(a,s,c){for(var g=[],b=a<s,w=c?b?s+1:s-1:s,p=a;b?p<w:p>w;b?p++:p--)g.push(p);return g}var Xn=V,Ac=ia,Mc=function(a){for(var s=[1,1],c=1;c<a;c++){for(var g=[1],b=1;b<=s.length;b++)g[b]=(s[b]||0)+s[b-1];s=g}return s},$c=function(a){var s,c,g,b,w,p,$;if(a=a.map(function(W){return new Xn(W)}),a.length===2)s=a.map(function(W){return W.lab()}),w=s[0],p=s[1],b=function(W){var pt=[0,1,2].map(function(gt){return w[gt]+W*(p[gt]-w[gt])});return new Xn(pt,"lab")};else if(a.length===3)c=a.map(function(W){return W.lab()}),w=c[0],p=c[1],$=c[2],b=function(W){var pt=[0,1,2].map(function(gt){return(1-W)*(1-W)*w[gt]+2*(1-W)*W*p[gt]+W*W*$[gt]});return new Xn(pt,"lab")};else if(a.length===4){var I;g=a.map(function(W){return W.lab()}),w=g[0],p=g[1],$=g[2],I=g[3],b=function(W){var pt=[0,1,2].map(function(gt){return(1-W)*(1-W)*(1-W)*w[gt]+3*(1-W)*(1-W)*W*p[gt]+3*(1-W)*W*W*$[gt]+W*W*W*I[gt]});return new Xn(pt,"lab")}}else if(a.length>=5){var Y,L,lt;Y=a.map(function(W){return W.lab()}),lt=a.length-1,L=Mc(lt),b=function(W){var pt=1-W,gt=[0,1,2].map(function(Pt){return Y.reduce(function(Ft,Lt,qt){return Ft+L[qt]*Math.pow(pt,lt-qt)*Math.pow(W,qt)*Lt[Pt]},0)});return new Xn(gt,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return b},Ic=function(a){var s=$c(a);return s.scale=function(){return Ac(s)},s},sa=$t,Ce=function(a,s,c){if(!Ce[c])throw new Error("unknown blend mode "+c);return Ce[c](a,s)},Qe=function(a){return function(s,c){var g=sa(c).rgb(),b=sa(s).rgb();return sa.rgb(a(g,b))}},Ze=function(a){return function(s,c){var g=[];return g[0]=a(s[0],c[0]),g[1]=a(s[1],c[1]),g[2]=a(s[2],c[2]),g}},Ec=function(a){return a},Tc=function(a,s){return a*s/255},Sc=function(a,s){return a>s?s:a},Nc=function(a,s){return a>s?a:s},Cc=function(a,s){return 255*(1-(1-a/255)*(1-s/255))},Rc=function(a,s){return s<128?2*a*s/255:255*(1-2*(1-a/255)*(1-s/255))},Pc=function(a,s){return 255*(1-(1-s/255)/(a/255))},Oc=function(a,s){return a===255?255:(a=255*(s/255)/(1-a/255),a>255?255:a)};Ce.normal=Qe(Ze(Ec)),Ce.multiply=Qe(Ze(Tc)),Ce.screen=Qe(Ze(Cc)),Ce.overlay=Qe(Ze(Rc)),Ce.darken=Qe(Ze(Sc)),Ce.lighten=Qe(Ze(Nc)),Ce.dodge=Qe(Ze(Oc)),Ce.burn=Qe(Ze(Pc));for(var Yc=Ce,oa=A.type,Fc=A.clip_rgb,Xc=A.TWOPI,Dc=Math.pow,zc=Math.sin,Lc=Math.cos,Xi=$t,Gc=function(a,s,c,g,b){a===void 0&&(a=300),s===void 0&&(s=-1.5),c===void 0&&(c=1),g===void 0&&(g=1),b===void 0&&(b=[0,1]);var w=0,p;oa(b)==="array"?p=b[1]-b[0]:(p=0,b=[b,b]);var $=function(I){var Y=Xc*((a+120)/360+s*I),L=Dc(b[0]+p*I,g),lt=w!==0?c[0]+I*w:c,W=lt*L*(1-L)/2,pt=Lc(Y),gt=zc(Y),Pt=L+W*(-.14861*pt+1.78277*gt),Ft=L+W*(-.29227*pt-.90649*gt),Lt=L+W*(1.97294*pt);return Xi(Fc([Pt*255,Ft*255,Lt*255,1]))};return $.start=function(I){return I==null?a:(a=I,$)},$.rotations=function(I){return I==null?s:(s=I,$)},$.gamma=function(I){return I==null?g:(g=I,$)},$.hue=function(I){return I==null?c:(c=I,oa(c)==="array"?(w=c[1]-c[0],w===0&&(c=c[1])):w=0,$)},$.lightness=function(I){return I==null?b:(oa(I)==="array"?(b=I,p=I[1]-I[0]):(b=[I,I],p=0),$)},$.scale=function(){return Xi.scale($)},$.hue(c),$},Hc=V,Uc="0123456789abcdef",qc=Math.floor,Vc=Math.random,Bc=function(){for(var a="#",s=0;s<6;s++)a+=Uc.charAt(qc(Vc()*16));return new Hc(a,"hex")},ua=f,Di=Math.log,Wc=Math.pow,Qc=Math.floor,Zc=Math.abs,zi=function(a,s){s===void 0&&(s=null);var c={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return ua(a)==="object"&&(a=Object.values(a)),a.forEach(function(g){s&&ua(g)==="object"&&(g=g[s]),g!=null&&!isNaN(g)&&(c.values.push(g),c.sum+=g,g<c.min&&(c.min=g),g>c.max&&(c.max=g),c.count+=1)}),c.domain=[c.min,c.max],c.limits=function(g,b){return Li(c,g,b)},c},Li=function(a,s,c){s===void 0&&(s="equal"),c===void 0&&(c=7),ua(a)=="array"&&(a=zi(a));var g=a.min,b=a.max,w=a.values.sort(function(ca,fa){return ca-fa});if(c===1)return[g,b];var p=[];if(s.substr(0,1)==="c"&&(p.push(g),p.push(b)),s.substr(0,1)==="e"){p.push(g);for(var $=1;$<c;$++)p.push(g+$/c*(b-g));p.push(b)}else if(s.substr(0,1)==="l"){if(g<=0)throw new Error("Logarithmic scales are only possible for values > 0");var I=Math.LOG10E*Di(g),Y=Math.LOG10E*Di(b);p.push(g);for(var L=1;L<c;L++)p.push(Wc(10,I+L/c*(Y-I)));p.push(b)}else if(s.substr(0,1)==="q"){p.push(g);for(var lt=1;lt<c;lt++){var W=(w.length-1)*lt/c,pt=Qc(W);if(pt===W)p.push(w[pt]);else{var gt=W-pt;p.push(w[pt]*(1-gt)+w[pt+1]*gt)}}p.push(b)}else if(s.substr(0,1)==="k"){var Pt,Ft=w.length,Lt=new Array(Ft),qt=new Array(c),de=!0,fe=0,we=null;we=[],we.push(g);for(var Dt=1;Dt<c;Dt++)we.push(g+Dt/c*(b-g));for(we.push(b);de;){for(var Z=0;Z<c;Z++)qt[Z]=0;for(var At=0;At<Ft;At++)for(var Yt=w[At],Ot=Number.MAX_VALUE,ve=void 0,Jt=0;Jt<c;Jt++){var Gt=Zc(we[Jt]-Yt);Gt<Ot&&(Ot=Gt,ve=Jt),qt[ve]++,Lt[At]=ve}for(var Bt=new Array(c),Wt=0;Wt<c;Wt++)Bt[Wt]=null;for(var Qt=0;Qt<Ft;Qt++)Pt=Lt[Qt],Bt[Pt]===null?Bt[Pt]=w[Qt]:Bt[Pt]+=w[Qt];for(var Re=0;Re<c;Re++)Bt[Re]*=1/qt[Re];de=!1;for(var je=0;je<c;je++)if(Bt[je]!==we[je]){de=!0;break}we=Bt,fe++,fe>200&&(de=!1)}for(var Je={},An=0;An<c;An++)Je[An]=[];for(var Mn=0;Mn<Ft;Mn++)Pt=Lt[Mn],Je[Pt].push(w[Mn]);for(var qe=[],tn=0;tn<c;tn++)qe.push(Je[tn][0]),qe.push(Je[tn][Je[tn].length-1]);qe=qe.sort(function(ca,fa){return ca-fa}),p.push(qe[0]);for(var Dn=1;Dn<qe.length;Dn+=2){var en=qe[Dn];!isNaN(en)&&p.indexOf(en)===-1&&p.push(en)}}return p},Gi={analyze:zi,limits:Li},Hi=V,jc=function(a,s){a=new Hi(a),s=new Hi(s);var c=a.luminance(),g=s.luminance();return c>g?(c+.05)/(g+.05):(g+.05)/(c+.05)},Ui=V,Ue=Math.sqrt,le=Math.pow,Jc=Math.min,Kc=Math.max,qi=Math.atan2,Vi=Math.abs,ir=Math.cos,Bi=Math.sin,tf=Math.exp,Wi=Math.PI,ef=function(a,s,c,g,b){c===void 0&&(c=1),g===void 0&&(g=1),b===void 0&&(b=1);var w=function(en){return 360*en/(2*Wi)},p=function(en){return 2*Wi*en/360};a=new Ui(a),s=new Ui(s);var $=Array.from(a.lab()),I=$[0],Y=$[1],L=$[2],lt=Array.from(s.lab()),W=lt[0],pt=lt[1],gt=lt[2],Pt=(I+W)/2,Ft=Ue(le(Y,2)+le(L,2)),Lt=Ue(le(pt,2)+le(gt,2)),qt=(Ft+Lt)/2,de=.5*(1-Ue(le(qt,7)/(le(qt,7)+le(25,7)))),fe=Y*(1+de),we=pt*(1+de),Dt=Ue(le(fe,2)+le(L,2)),Z=Ue(le(we,2)+le(gt,2)),At=(Dt+Z)/2,Yt=w(qi(L,fe)),Ot=w(qi(gt,we)),ve=Yt>=0?Yt:Yt+360,Jt=Ot>=0?Ot:Ot+360,Gt=Vi(ve-Jt)>180?(ve+Jt+360)/2:(ve+Jt)/2,Bt=1-.17*ir(p(Gt-30))+.24*ir(p(2*Gt))+.32*ir(p(3*Gt+6))-.2*ir(p(4*Gt-63)),Wt=Jt-ve;Wt=Vi(Wt)<=180?Wt:Jt<=ve?Wt+360:Wt-360,Wt=2*Ue(Dt*Z)*Bi(p(Wt)/2);var Qt=W-I,Re=Z-Dt,je=1+.015*le(Pt-50,2)/Ue(20+le(Pt-50,2)),Je=1+.045*At,An=1+.015*At*Bt,Mn=30*tf(-le((Gt-275)/25,2)),qe=2*Ue(le(At,7)/(le(At,7)+le(25,7))),tn=-qe*Bi(2*p(Mn)),Dn=Ue(le(Qt/(c*je),2)+le(Re/(g*Je),2)+le(Wt/(b*An),2)+tn*(Re/(g*Je))*(Wt/(b*An)));return Kc(0,Jc(100,Dn))},Qi=V,nf=function(a,s,c){c===void 0&&(c="lab"),a=new Qi(a),s=new Qi(s);var g=a.get(c),b=s.get(c),w=0;for(var p in g){var $=(g[p]||0)-(b[p]||0);w+=$*$}return Math.sqrt(w)},rf=V,af=function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];try{return new(Function.prototype.bind.apply(rf,[null].concat(a))),!0}catch{return!1}},Zi=$t,ji=ia,sf={cool:function(){return ji([Zi.hsl(180,1,.9),Zi.hsl(250,.7,.4)])},hot:function(){return ji(["#000","#f00","#ff0","#fff"]).mode("rgb")}},sr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},la=0,Ji=Object.keys(sr);la<Ji.length;la+=1){var Ki=Ji[la];sr[Ki.toLowerCase()]=sr[Ki]}var of=sr,ce=$t;ce.average=bc,ce.bezier=Ic,ce.blend=Yc,ce.cubehelix=Gc,ce.mix=ce.interpolate=Ti,ce.random=Bc,ce.scale=ia,ce.analyze=Gi.analyze,ce.contrast=jc,ce.deltaE=ef,ce.distance=nf,ce.limits=Gi.limits,ce.valid=af,ce.scales=sf,ce.colors=fi,ce.brewer=of;var uf=ce;return uf})})(Hs);var sh=Hs.exports;const Us=vf(sh);function vr(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function oh(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function qs(t){let e,n,r;t.length!==2?(e=vr,n=(l,v)=>vr(t(l),v),r=(l,v)=>t(l)-v):(e=t===vr||t===oh?t:uh,n=t,r=t);function i(l,v,f=0,d=l.length){if(f<d){if(e(v,v)!==0)return d;do{const m=f+d>>>1;n(l[m],v)<0?f=m+1:d=m}while(f<d)}return f}function o(l,v,f=0,d=l.length){if(f<d){if(e(v,v)!==0)return d;do{const m=f+d>>>1;n(l[m],v)<=0?f=m+1:d=m}while(f<d)}return f}function u(l,v,f=0,d=l.length){const m=i(l,v,f,d-1);return m>f&&r(l[m-1],v)>-r(l[m],v)?m-1:m}return{left:i,center:u,right:o}}function uh(){return 0}function lh(t){return t===null?NaN:+t}const ch=qs(vr),fh=ch.right;qs(lh).center;const hh=fh;class rs extends Map{constructor(e,n=gh){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(as(this,e))}has(e){return super.has(as(this,e))}set(e,n){return super.set(dh(this,e),n)}delete(e){return super.delete(vh(this,e))}}function as({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function dh({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function vh({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function gh(t){return t!==null&&typeof t=="object"?t.valueOf():t}const ph=Math.sqrt(50),mh=Math.sqrt(10),yh=Math.sqrt(2);function xr(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),u=o>=ph?10:o>=mh?5:o>=yh?2:1;let l,v,f;return i<0?(f=Math.pow(10,-i)/u,l=Math.round(t*f),v=Math.round(e*f),l/f<t&&++l,v/f>e&&--v,f=-f):(f=Math.pow(10,i)*u,l=Math.round(t/f),v=Math.round(e/f),l*f<t&&++l,v*f>e&&--v),v<l&&.5<=n&&n<2?xr(t,e,n*2):[l,v,f]}function _h(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,o,u]=r?xr(e,t,n):xr(t,e,n);if(!(o>=i))return[];const l=o-i+1,v=new Array(l);if(r)if(u<0)for(let f=0;f<l;++f)v[f]=(o-f)/-u;else for(let f=0;f<l;++f)v[f]=(o-f)*u;else if(u<0)for(let f=0;f<l;++f)v[f]=(i+f)/-u;else for(let f=0;f<l;++f)v[f]=(i+f)*u;return v}function ya(t,e,n){return e=+e,t=+t,n=+n,xr(t,e,n)[2]}function bh(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?ya(e,t,n):ya(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function is(t,e){let n=0;if(e===void 0)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}var xh={value:()=>{}};function Na(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new gr(n)}function gr(t){this._=t}function wh(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}gr.prototype=Na.prototype={constructor:gr,on:function(t,e){var n=this._,r=wh(t+"",n),i,o=-1,u=r.length;if(arguments.length<2){for(;++o<u;)if((i=(t=r[o]).type)&&(i=kh(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<u;)if(i=(t=r[o]).type)n[i]=ss(n[i],t.name,e);else if(e==null)for(i in n)n[i]=ss(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new gr(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function kh(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function ss(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=xh,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var _a="http://www.w3.org/1999/xhtml";const os={svg:"http://www.w3.org/2000/svg",xhtml:_a,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Rr(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),os.hasOwnProperty(e)?{space:os[e],local:t}:t}function Ah(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===_a&&e.documentElement.namespaceURI===_a?e.createElement(t):e.createElementNS(n,t)}}function Mh(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Ca(t){var e=Rr(t);return(e.local?Mh:Ah)(e)}function $h(){}function Ra(t){return t==null?$h:function(){return this.querySelector(t)}}function Ih(t){typeof t!="function"&&(t=Ra(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],u=o.length,l=r[i]=new Array(u),v,f,d=0;d<u;++d)(v=o[d])&&(f=t.call(v,v.__data__,d,o))&&("__data__"in v&&(f.__data__=v.__data__),l[d]=f);return new $e(r,this._parents)}function Eh(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Th(){return[]}function Vs(t){return t==null?Th:function(){return this.querySelectorAll(t)}}function Sh(t){return function(){return Eh(t.apply(this,arguments))}}function Nh(t){typeof t=="function"?t=Sh(t):t=Vs(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var u=e[o],l=u.length,v,f=0;f<l;++f)(v=u[f])&&(r.push(t.call(v,v.__data__,f,u)),i.push(v));return new $e(r,i)}function Bs(t){return function(){return this.matches(t)}}function Ws(t){return function(e){return e.matches(t)}}var Ch=Array.prototype.find;function Rh(t){return function(){return Ch.call(this.children,t)}}function Ph(){return this.firstElementChild}function Oh(t){return this.select(t==null?Ph:Rh(typeof t=="function"?t:Ws(t)))}var Yh=Array.prototype.filter;function Fh(){return Array.from(this.children)}function Xh(t){return function(){return Yh.call(this.children,t)}}function Dh(t){return this.selectAll(t==null?Fh:Xh(typeof t=="function"?t:Ws(t)))}function zh(t){typeof t!="function"&&(t=Bs(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],u=o.length,l=r[i]=[],v,f=0;f<u;++f)(v=o[f])&&t.call(v,v.__data__,f,o)&&l.push(v);return new $e(r,this._parents)}function Qs(t){return new Array(t.length)}function Lh(){return new $e(this._enter||this._groups.map(Qs),this._parents)}function wr(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}wr.prototype={constructor:wr,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Gh(t){return function(){return t}}function Hh(t,e,n,r,i,o){for(var u=0,l,v=e.length,f=o.length;u<f;++u)(l=e[u])?(l.__data__=o[u],r[u]=l):n[u]=new wr(t,o[u]);for(;u<v;++u)(l=e[u])&&(i[u]=l)}function Uh(t,e,n,r,i,o,u){var l,v,f=new Map,d=e.length,m=o.length,_=new Array(d),k;for(l=0;l<d;++l)(v=e[l])&&(_[l]=k=u.call(v,v.__data__,l,e)+"",f.has(k)?i[l]=v:f.set(k,v));for(l=0;l<m;++l)k=u.call(t,o[l],l,o)+"",(v=f.get(k))?(r[l]=v,v.__data__=o[l],f.delete(k)):n[l]=new wr(t,o[l]);for(l=0;l<d;++l)(v=e[l])&&f.get(_[l])===v&&(i[l]=v)}function qh(t){return t.__data__}function Vh(t,e){if(!arguments.length)return Array.from(this,qh);var n=e?Uh:Hh,r=this._parents,i=this._groups;typeof t!="function"&&(t=Gh(t));for(var o=i.length,u=new Array(o),l=new Array(o),v=new Array(o),f=0;f<o;++f){var d=r[f],m=i[f],_=m.length,k=Bh(t.call(d,d&&d.__data__,f,r)),R=k.length,A=l[f]=new Array(R),J=u[f]=new Array(R),D=v[f]=new Array(_);n(d,m,A,J,D,k,e);for(var ft=0,nt=0,H,F;ft<R;++ft)if(H=A[ft]){for(ft>=nt&&(nt=ft+1);!(F=J[nt])&&++nt<R;);H._next=F||null}}return u=new $e(u,r),u._enter=l,u._exit=v,u}function Bh(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Wh(){return new $e(this._exit||this._groups.map(Qs),this._parents)}function Qh(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function Zh(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,u=Math.min(i,o),l=new Array(i),v=0;v<u;++v)for(var f=n[v],d=r[v],m=f.length,_=l[v]=new Array(m),k,R=0;R<m;++R)(k=f[R]||d[R])&&(_[R]=k);for(;v<i;++v)l[v]=n[v];return new $e(l,this._parents)}function jh(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],u;--i>=0;)(u=r[i])&&(o&&u.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(u,o),o=u);return this}function Jh(t){t||(t=Kh);function e(m,_){return m&&_?t(m.__data__,_.__data__):!m-!_}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var u=n[o],l=u.length,v=i[o]=new Array(l),f,d=0;d<l;++d)(f=u[d])&&(v[d]=f);v.sort(e)}return new $e(i,this._parents).order()}function Kh(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function td(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ed(){return Array.from(this)}function nd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var u=r[i];if(u)return u}return null}function rd(){let t=0;for(const e of this)++t;return t}function ad(){return!this.node()}function id(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,u=i.length,l;o<u;++o)(l=i[o])&&t.call(l,l.__data__,o,i);return this}function sd(t){return function(){this.removeAttribute(t)}}function od(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ud(t,e){return function(){this.setAttribute(t,e)}}function ld(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function cd(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function fd(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function hd(t,e){var n=Rr(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?od:sd:typeof e=="function"?n.local?fd:cd:n.local?ld:ud)(n,e))}function Zs(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function dd(t){return function(){this.style.removeProperty(t)}}function vd(t,e,n){return function(){this.style.setProperty(t,e,n)}}function gd(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function pd(t,e,n){return arguments.length>1?this.each((e==null?dd:typeof e=="function"?gd:vd)(t,e,n??"")):Sn(this.node(),t)}function Sn(t,e){return t.style.getPropertyValue(e)||Zs(t).getComputedStyle(t,null).getPropertyValue(e)}function md(t){return function(){delete this[t]}}function yd(t,e){return function(){this[t]=e}}function _d(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function bd(t,e){return arguments.length>1?this.each((e==null?md:typeof e=="function"?_d:yd)(t,e)):this.node()[t]}function js(t){return t.trim().split(/^|\s+/)}function Pa(t){return t.classList||new Js(t)}function Js(t){this._node=t,this._names=js(t.getAttribute("class")||"")}Js.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ks(t,e){for(var n=Pa(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function to(t,e){for(var n=Pa(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function xd(t){return function(){Ks(this,t)}}function wd(t){return function(){to(this,t)}}function kd(t,e){return function(){(e.apply(this,arguments)?Ks:to)(this,t)}}function Ad(t,e){var n=js(t+"");if(arguments.length<2){for(var r=Pa(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?kd:e?xd:wd)(n,e))}function Md(){this.textContent=""}function $d(t){return function(){this.textContent=t}}function Id(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ed(t){return arguments.length?this.each(t==null?Md:(typeof t=="function"?Id:$d)(t)):this.node().textContent}function Td(){this.innerHTML=""}function Sd(t){return function(){this.innerHTML=t}}function Nd(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Cd(t){return arguments.length?this.each(t==null?Td:(typeof t=="function"?Nd:Sd)(t)):this.node().innerHTML}function Rd(){this.nextSibling&&this.parentNode.appendChild(this)}function Pd(){return this.each(Rd)}function Od(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Yd(){return this.each(Od)}function Fd(t){var e=typeof t=="function"?t:Ca(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Xd(){return null}function Dd(t,e){var n=typeof t=="function"?t:Ca(t),r=e==null?Xd:typeof e=="function"?e:Ra(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function zd(){var t=this.parentNode;t&&t.removeChild(this)}function Ld(){return this.each(zd)}function Gd(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Hd(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ud(t){return this.select(t?Hd:Gd)}function qd(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Vd(t){return function(e){t.call(this,e,this.__data__)}}function Bd(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Wd(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Qd(t,e,n){return function(){var r=this.__on,i,o=Vd(e);if(r){for(var u=0,l=r.length;u<l;++u)if((i=r[u]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Zd(t,e,n){var r=Bd(t+""),i,o=r.length,u;if(arguments.length<2){var l=this.node().__on;if(l){for(var v=0,f=l.length,d;v<f;++v)for(i=0,d=l[v];i<o;++i)if((u=r[i]).type===d.type&&u.name===d.name)return d.value}return}for(l=e?Qd:Wd,i=0;i<o;++i)this.each(l(r[i],e,n));return this}function eo(t,e,n){var r=Zs(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function jd(t,e){return function(){return eo(this,t,e)}}function Jd(t,e){return function(){return eo(this,t,e.apply(this,arguments))}}function Kd(t,e){return this.each((typeof e=="function"?Jd:jd)(t,e))}function*tv(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,u;i<o;++i)(u=r[i])&&(yield u)}var no=[null];function $e(t,e){this._groups=t,this._parents=e}function Qn(){return new $e([[document.documentElement]],no)}function ev(){return this}$e.prototype=Qn.prototype={constructor:$e,select:Ih,selectAll:Nh,selectChild:Oh,selectChildren:Dh,filter:zh,data:Vh,enter:Lh,exit:Wh,join:Qh,merge:Zh,selection:ev,order:jh,sort:Jh,call:td,nodes:ed,node:nd,size:rd,empty:ad,each:id,attr:hd,style:pd,property:bd,classed:Ad,text:Ed,html:Cd,raise:Pd,lower:Yd,append:Fd,insert:Dd,remove:Ld,clone:Ud,datum:qd,on:Zd,dispatch:Kd,[Symbol.iterator]:tv};function Kt(t){return typeof t=="string"?new $e([[document.querySelector(t)]],[document.documentElement]):new $e([[t]],no)}function nv(t){return Kt(Ca(t).call(document.documentElement))}function rv(t){let e;for(;e=t.sourceEvent;)t=e;return t}function an(t,e){if(t=rv(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const ba={capture:!0,passive:!1};function xa(t){t.preventDefault(),t.stopImmediatePropagation()}function av(t){var e=t.document.documentElement,n=Kt(t).on("dragstart.drag",xa,ba);"onselectstart"in e?n.on("selectstart.drag",xa,ba):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function iv(t,e){var n=t.document.documentElement,r=Kt(t).on("dragstart.drag",null);e&&(r.on("click.drag",xa,ba),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Oa(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function ro(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Zn(){}var qn=.7,kr=1/qn,Tn="\\s*([+-]?\\d+)\\s*",Vn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ze="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sv=/^#([0-9a-f]{3,8})$/,ov=new RegExp(`^rgb\\(${Tn},${Tn},${Tn}\\)$`),uv=new RegExp(`^rgb\\(${ze},${ze},${ze}\\)$`),lv=new RegExp(`^rgba\\(${Tn},${Tn},${Tn},${Vn}\\)$`),cv=new RegExp(`^rgba\\(${ze},${ze},${ze},${Vn}\\)$`),fv=new RegExp(`^hsl\\(${Vn},${ze},${ze}\\)$`),hv=new RegExp(`^hsla\\(${Vn},${ze},${ze},${Vn}\\)$`),us={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Oa(Zn,hn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:ls,formatHex:ls,formatHex8:dv,formatHsl:vv,formatRgb:cs,toString:cs});function ls(){return this.rgb().formatHex()}function dv(){return this.rgb().formatHex8()}function vv(){return ao(this).formatHsl()}function cs(){return this.rgb().formatRgb()}function hn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=sv.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?fs(e):n===3?new ke(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ur(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ur(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ov.exec(t))?new ke(e[1],e[2],e[3],1):(e=uv.exec(t))?new ke(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=lv.exec(t))?ur(e[1],e[2],e[3],e[4]):(e=cv.exec(t))?ur(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=fv.exec(t))?vs(e[1],e[2]/100,e[3]/100,1):(e=hv.exec(t))?vs(e[1],e[2]/100,e[3]/100,e[4]):us.hasOwnProperty(t)?fs(us[t]):t==="transparent"?new ke(NaN,NaN,NaN,0):null}function fs(t){return new ke(t>>16&255,t>>8&255,t&255,1)}function ur(t,e,n,r){return r<=0&&(t=e=n=NaN),new ke(t,e,n,r)}function gv(t){return t instanceof Zn||(t=hn(t)),t?(t=t.rgb(),new ke(t.r,t.g,t.b,t.opacity)):new ke}function wa(t,e,n,r){return arguments.length===1?gv(t):new ke(t,e,n,r??1)}function ke(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Oa(ke,wa,ro(Zn,{brighter(t){return t=t==null?kr:Math.pow(kr,t),new ke(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?qn:Math.pow(qn,t),new ke(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ke(cn(this.r),cn(this.g),cn(this.b),Ar(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hs,formatHex:hs,formatHex8:pv,formatRgb:ds,toString:ds}));function hs(){return`#${un(this.r)}${un(this.g)}${un(this.b)}`}function pv(){return`#${un(this.r)}${un(this.g)}${un(this.b)}${un((isNaN(this.opacity)?1:this.opacity)*255)}`}function ds(){const t=Ar(this.opacity);return`${t===1?"rgb(":"rgba("}${cn(this.r)}, ${cn(this.g)}, ${cn(this.b)}${t===1?")":`, ${t})`}`}function Ar(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function cn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function un(t){return t=cn(t),(t<16?"0":"")+t.toString(16)}function vs(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Oe(t,e,n,r)}function ao(t){if(t instanceof Oe)return new Oe(t.h,t.s,t.l,t.opacity);if(t instanceof Zn||(t=hn(t)),!t)return new Oe;if(t instanceof Oe)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),u=NaN,l=o-i,v=(o+i)/2;return l?(e===o?u=(n-r)/l+(n<r)*6:n===o?u=(r-e)/l+2:u=(e-n)/l+4,l/=v<.5?o+i:2-o-i,u*=60):l=v>0&&v<1?0:u,new Oe(u,l,v,t.opacity)}function mv(t,e,n,r){return arguments.length===1?ao(t):new Oe(t,e,n,r??1)}function Oe(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Oa(Oe,mv,ro(Zn,{brighter(t){return t=t==null?kr:Math.pow(kr,t),new Oe(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?qn:Math.pow(qn,t),new Oe(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new ke(ha(t>=240?t-240:t+120,i,r),ha(t,i,r),ha(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Oe(gs(this.h),lr(this.s),lr(this.l),Ar(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ar(this.opacity);return`${t===1?"hsl(":"hsla("}${gs(this.h)}, ${lr(this.s)*100}%, ${lr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function gs(t){return t=(t||0)%360,t<0?t+360:t}function lr(t){return Math.max(0,Math.min(1,t||0))}function ha(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Ya=t=>()=>t;function yv(t,e){return function(n){return t+n*e}}function _v(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function bv(t){return(t=+t)==1?io:function(e,n){return n-e?_v(e,n,t):Ya(isNaN(e)?n:e)}}function io(t,e){var n=e-t;return n?yv(t,n):Ya(isNaN(t)?e:t)}const Mr=function t(e){var n=bv(e);function r(i,o){var u=n((i=wa(i)).r,(o=wa(o)).r),l=n(i.g,o.g),v=n(i.b,o.b),f=io(i.opacity,o.opacity);return function(d){return i.r=u(d),i.g=l(d),i.b=v(d),i.opacity=f(d),i+""}}return r.gamma=t,r}(1);function xv(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=t[i]*(1-o)+e[i]*o;return r}}function wv(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function kv(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),o=new Array(n),u;for(u=0;u<r;++u)i[u]=Fa(t[u],e[u]);for(;u<n;++u)o[u]=e[u];return function(l){for(u=0;u<r;++u)o[u]=i[u](l);return o}}function Av(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Pe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Mv(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Fa(t[i],e[i]):r[i]=e[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var ka=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,da=new RegExp(ka.source,"g");function $v(t){return function(){return t}}function Iv(t){return function(e){return t(e)+""}}function so(t,e){var n=ka.lastIndex=da.lastIndex=0,r,i,o,u=-1,l=[],v=[];for(t=t+"",e=e+"";(r=ka.exec(t))&&(i=da.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),l[u]?l[u]+=o:l[++u]=o),(r=r[0])===(i=i[0])?l[u]?l[u]+=i:l[++u]=i:(l[++u]=null,v.push({i:u,x:Pe(r,i)})),n=da.lastIndex;return n<e.length&&(o=e.slice(n),l[u]?l[u]+=o:l[++u]=o),l.length<2?v[0]?Iv(v[0].x):$v(e):(e=v.length,function(f){for(var d=0,m;d<e;++d)l[(m=v[d]).i]=m.x(f);return l.join("")})}function Fa(t,e){var n=typeof e,r;return e==null||n==="boolean"?Ya(e):(n==="number"?Pe:n==="string"?(r=hn(e))?(e=r,Mr):so:e instanceof hn?Mr:e instanceof Date?Av:wv(e)?xv:Array.isArray(e)?kv:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Mv:Pe)(t,e)}function Ev(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var ps=180/Math.PI,Aa={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function oo(t,e,n,r,i,o){var u,l,v;return(u=Math.sqrt(t*t+e*e))&&(t/=u,e/=u),(v=t*n+e*r)&&(n-=t*v,r-=e*v),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,v/=l),t*r<e*n&&(t=-t,e=-e,v=-v,u=-u),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*ps,skewX:Math.atan(v)*ps,scaleX:u,scaleY:l}}var cr;function Tv(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Aa:oo(e.a,e.b,e.c,e.d,e.e,e.f)}function Sv(t){return t==null||(cr||(cr=document.createElementNS("http://www.w3.org/2000/svg","g")),cr.setAttribute("transform",t),!(t=cr.transform.baseVal.consolidate()))?Aa:(t=t.matrix,oo(t.a,t.b,t.c,t.d,t.e,t.f))}function uo(t,e,n,r){function i(f){return f.length?f.pop()+" ":""}function o(f,d,m,_,k,R){if(f!==m||d!==_){var A=k.push("translate(",null,e,null,n);R.push({i:A-4,x:Pe(f,m)},{i:A-2,x:Pe(d,_)})}else(m||_)&&k.push("translate("+m+e+_+n)}function u(f,d,m,_){f!==d?(f-d>180?d+=360:d-f>180&&(f+=360),_.push({i:m.push(i(m)+"rotate(",null,r)-2,x:Pe(f,d)})):d&&m.push(i(m)+"rotate("+d+r)}function l(f,d,m,_){f!==d?_.push({i:m.push(i(m)+"skewX(",null,r)-2,x:Pe(f,d)}):d&&m.push(i(m)+"skewX("+d+r)}function v(f,d,m,_,k,R){if(f!==m||d!==_){var A=k.push(i(k)+"scale(",null,",",null,")");R.push({i:A-4,x:Pe(f,m)},{i:A-2,x:Pe(d,_)})}else(m!==1||_!==1)&&k.push(i(k)+"scale("+m+","+_+")")}return function(f,d){var m=[],_=[];return f=t(f),d=t(d),o(f.translateX,f.translateY,d.translateX,d.translateY,m,_),u(f.rotate,d.rotate,m,_),l(f.skewX,d.skewX,m,_),v(f.scaleX,f.scaleY,d.scaleX,d.scaleY,m,_),f=d=null,function(k){for(var R=-1,A=_.length,J;++R<A;)m[(J=_[R]).i]=J.x(k);return m.join("")}}}var Nv=uo(Tv,"px, ","px)","deg)"),Cv=uo(Sv,", ",")",")"),Rv=1e-12;function ms(t){return((t=Math.exp(t))+1/t)/2}function Pv(t){return((t=Math.exp(t))-1/t)/2}function Ov(t){return((t=Math.exp(2*t))-1)/(t+1)}const Yv=function t(e,n,r){function i(o,u){var l=o[0],v=o[1],f=o[2],d=u[0],m=u[1],_=u[2],k=d-l,R=m-v,A=k*k+R*R,J,D;if(A<Rv)D=Math.log(_/f)/e,J=function(st){return[l+st*k,v+st*R,f*Math.exp(e*st*D)]};else{var ft=Math.sqrt(A),nt=(_*_-f*f+r*A)/(2*f*n*ft),H=(_*_-f*f-r*A)/(2*_*n*ft),F=Math.log(Math.sqrt(nt*nt+1)-nt),V=Math.log(Math.sqrt(H*H+1)-H);D=(V-F)/e,J=function(st){var $t=st*D,wt=ms(F),Mt=f/(n*ft)*(wt*Ov(e*$t+F)-Pv(F));return[l+Mt*k,v+Mt*R,f*wt/ms(e*$t+F)]}}return J.duration=D*1e3*e/Math.SQRT2,J}return i.rho=function(o){var u=Math.max(.001,+o),l=u*u,v=l*l;return t(u,l,v)},i}(Math.SQRT2,2,4);var Nn=0,Gn=0,zn=0,lo=1e3,$r,Hn,Ir=0,dn=0,Pr=0,Bn=typeof performance=="object"&&performance.now?performance:Date,co=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Xa(){return dn||(co(Fv),dn=Bn.now()+Pr)}function Fv(){dn=0}function Er(){this._call=this._time=this._next=null}Er.prototype=fo.prototype={constructor:Er,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Xa():+n)+(e==null?0:+e),!this._next&&Hn!==this&&(Hn?Hn._next=this:$r=this,Hn=this),this._call=t,this._time=n,Ma()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ma())}};function fo(t,e,n){var r=new Er;return r.restart(t,e,n),r}function Xv(){Xa(),++Nn;for(var t=$r,e;t;)(e=dn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Nn}function ys(){dn=(Ir=Bn.now())+Pr,Nn=Gn=0;try{Xv()}finally{Nn=0,zv(),dn=0}}function Dv(){var t=Bn.now(),e=t-Ir;e>lo&&(Pr-=e,Ir=t)}function zv(){for(var t,e=$r,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:$r=n);Hn=t,Ma(r)}function Ma(t){if(!Nn){Gn&&(Gn=clearTimeout(Gn));var e=t-dn;e>24?(t<1/0&&(Gn=setTimeout(ys,t-Bn.now()-Pr)),zn&&(zn=clearInterval(zn))):(zn||(Ir=Bn.now(),zn=setInterval(Dv,lo)),Nn=1,co(ys))}}function _s(t,e,n){var r=new Er;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Lv=Na("start","end","cancel","interrupt"),Gv=[],ho=0,bs=1,$a=2,pr=3,xs=4,Ia=5,mr=6;function Or(t,e,n,r,i,o){var u=t.__transition;if(!u)t.__transition={};else if(n in u)return;Hv(t,n,{name:e,index:r,group:i,on:Lv,tween:Gv,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:ho})}function Da(t,e){var n=Fe(t,e);if(n.state>ho)throw new Error("too late; already scheduled");return n}function Ge(t,e){var n=Fe(t,e);if(n.state>pr)throw new Error("too late; already running");return n}function Fe(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Hv(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=fo(o,0,n.time);function o(f){n.state=bs,n.timer.restart(u,n.delay,n.time),n.delay<=f&&u(f-n.delay)}function u(f){var d,m,_,k;if(n.state!==bs)return v();for(d in r)if(k=r[d],k.name===n.name){if(k.state===pr)return _s(u);k.state===xs?(k.state=mr,k.timer.stop(),k.on.call("interrupt",t,t.__data__,k.index,k.group),delete r[d]):+d<e&&(k.state=mr,k.timer.stop(),k.on.call("cancel",t,t.__data__,k.index,k.group),delete r[d])}if(_s(function(){n.state===pr&&(n.state=xs,n.timer.restart(l,n.delay,n.time),l(f))}),n.state=$a,n.on.call("start",t,t.__data__,n.index,n.group),n.state===$a){for(n.state=pr,i=new Array(_=n.tween.length),d=0,m=-1;d<_;++d)(k=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(i[++m]=k);i.length=m+1}}function l(f){for(var d=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(v),n.state=Ia,1),m=-1,_=i.length;++m<_;)i[m].call(t,d);n.state===Ia&&(n.on.call("end",t,t.__data__,n.index,n.group),v())}function v(){n.state=mr,n.timer.stop(),delete r[e];for(var f in r)return;delete t.__transition}}function yr(t,e){var n=t.__transition,r,i,o=!0,u;if(n){e=e==null?null:e+"";for(u in n){if((r=n[u]).name!==e){o=!1;continue}i=r.state>$a&&r.state<Ia,r.state=mr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[u]}o&&delete t.__transition}}function Uv(t){return this.each(function(){yr(this,t)})}function qv(t,e){var n,r;return function(){var i=Ge(this,t),o=i.tween;if(o!==n){r=n=o;for(var u=0,l=r.length;u<l;++u)if(r[u].name===e){r=r.slice(),r.splice(u,1);break}}i.tween=r}}function Vv(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=Ge(this,t),u=o.tween;if(u!==r){i=(r=u).slice();for(var l={name:e,value:n},v=0,f=i.length;v<f;++v)if(i[v].name===e){i[v]=l;break}v===f&&i.push(l)}o.tween=i}}function Bv(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Fe(this.node(),n).tween,i=0,o=r.length,u;i<o;++i)if((u=r[i]).name===t)return u.value;return null}return this.each((e==null?qv:Vv)(n,t,e))}function za(t,e,n){var r=t._id;return t.each(function(){var i=Ge(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return Fe(i,r).value[e]}}function vo(t,e){var n;return(typeof e=="number"?Pe:e instanceof hn?Mr:(n=hn(e))?(e=n,Mr):so)(t,e)}function Wv(t){return function(){this.removeAttribute(t)}}function Qv(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Zv(t,e,n){var r,i=n+"",o;return function(){var u=this.getAttribute(t);return u===i?null:u===r?o:o=e(r=u,n)}}function jv(t,e,n){var r,i=n+"",o;return function(){var u=this.getAttributeNS(t.space,t.local);return u===i?null:u===r?o:o=e(r=u,n)}}function Jv(t,e,n){var r,i,o;return function(){var u,l=n(this),v;return l==null?void this.removeAttribute(t):(u=this.getAttribute(t),v=l+"",u===v?null:u===r&&v===i?o:(i=v,o=e(r=u,l)))}}function Kv(t,e,n){var r,i,o;return function(){var u,l=n(this),v;return l==null?void this.removeAttributeNS(t.space,t.local):(u=this.getAttributeNS(t.space,t.local),v=l+"",u===v?null:u===r&&v===i?o:(i=v,o=e(r=u,l)))}}function t0(t,e){var n=Rr(t),r=n==="transform"?Cv:vo;return this.attrTween(t,typeof e=="function"?(n.local?Kv:Jv)(n,r,za(this,"attr."+t,e)):e==null?(n.local?Qv:Wv)(n):(n.local?jv:Zv)(n,r,e))}function e0(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function n0(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function r0(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&n0(t,o)),n}return i._value=e,i}function a0(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&e0(t,o)),n}return i._value=e,i}function i0(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Rr(t);return this.tween(n,(r.local?r0:a0)(r,e))}function s0(t,e){return function(){Da(this,t).delay=+e.apply(this,arguments)}}function o0(t,e){return e=+e,function(){Da(this,t).delay=e}}function u0(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?s0:o0)(e,t)):Fe(this.node(),e).delay}function l0(t,e){return function(){Ge(this,t).duration=+e.apply(this,arguments)}}function c0(t,e){return e=+e,function(){Ge(this,t).duration=e}}function f0(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?l0:c0)(e,t)):Fe(this.node(),e).duration}function h0(t,e){if(typeof e!="function")throw new Error;return function(){Ge(this,t).ease=e}}function d0(t){var e=this._id;return arguments.length?this.each(h0(e,t)):Fe(this.node(),e).ease}function v0(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Ge(this,t).ease=n}}function g0(t){if(typeof t!="function")throw new Error;return this.each(v0(this._id,t))}function p0(t){typeof t!="function"&&(t=Bs(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],u=o.length,l=r[i]=[],v,f=0;f<u;++f)(v=o[f])&&t.call(v,v.__data__,f,o)&&l.push(v);return new We(r,this._parents,this._name,this._id)}function m0(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),u=new Array(r),l=0;l<o;++l)for(var v=e[l],f=n[l],d=v.length,m=u[l]=new Array(d),_,k=0;k<d;++k)(_=v[k]||f[k])&&(m[k]=_);for(;l<r;++l)u[l]=e[l];return new We(u,this._parents,this._name,this._id)}function y0(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function _0(t,e,n){var r,i,o=y0(e)?Da:Ge;return function(){var u=o(this,t),l=u.on;l!==r&&(i=(r=l).copy()).on(e,n),u.on=i}}function b0(t,e){var n=this._id;return arguments.length<2?Fe(this.node(),n).on.on(t):this.each(_0(n,t,e))}function x0(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function w0(){return this.on("end.remove",x0(this._id))}function k0(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Ra(t));for(var r=this._groups,i=r.length,o=new Array(i),u=0;u<i;++u)for(var l=r[u],v=l.length,f=o[u]=new Array(v),d,m,_=0;_<v;++_)(d=l[_])&&(m=t.call(d,d.__data__,_,l))&&("__data__"in d&&(m.__data__=d.__data__),f[_]=m,Or(f[_],e,n,_,f,Fe(d,n)));return new We(o,this._parents,e,n)}function A0(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Vs(t));for(var r=this._groups,i=r.length,o=[],u=[],l=0;l<i;++l)for(var v=r[l],f=v.length,d,m=0;m<f;++m)if(d=v[m]){for(var _=t.call(d,d.__data__,m,v),k,R=Fe(d,n),A=0,J=_.length;A<J;++A)(k=_[A])&&Or(k,e,n,A,_,R);o.push(_),u.push(d)}return new We(o,u,e,n)}var M0=Qn.prototype.constructor;function $0(){return new M0(this._groups,this._parents)}function I0(t,e){var n,r,i;return function(){var o=Sn(this,t),u=(this.style.removeProperty(t),Sn(this,t));return o===u?null:o===n&&u===r?i:i=e(n=o,r=u)}}function go(t){return function(){this.style.removeProperty(t)}}function E0(t,e,n){var r,i=n+"",o;return function(){var u=Sn(this,t);return u===i?null:u===r?o:o=e(r=u,n)}}function T0(t,e,n){var r,i,o;return function(){var u=Sn(this,t),l=n(this),v=l+"";return l==null&&(v=l=(this.style.removeProperty(t),Sn(this,t))),u===v?null:u===r&&v===i?o:(i=v,o=e(r=u,l))}}function S0(t,e){var n,r,i,o="style."+e,u="end."+o,l;return function(){var v=Ge(this,t),f=v.on,d=v.value[o]==null?l||(l=go(e)):void 0;(f!==n||i!==d)&&(r=(n=f).copy()).on(u,i=d),v.on=r}}function N0(t,e,n){var r=(t+="")=="transform"?Nv:vo;return e==null?this.styleTween(t,I0(t,r)).on("end.style."+t,go(t)):typeof e=="function"?this.styleTween(t,T0(t,r,za(this,"style."+t,e))).each(S0(this._id,t)):this.styleTween(t,E0(t,r,e),n).on("end.style."+t,null)}function C0(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function R0(t,e,n){var r,i;function o(){var u=e.apply(this,arguments);return u!==i&&(r=(i=u)&&C0(t,u,n)),r}return o._value=e,o}function P0(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,R0(t,e,n??""))}function O0(t){return function(){this.textContent=t}}function Y0(t){return function(){var e=t(this);this.textContent=e??""}}function F0(t){return this.tween("text",typeof t=="function"?Y0(za(this,"text",t)):O0(t==null?"":t+""))}function X0(t){return function(e){this.textContent=t.call(this,e)}}function D0(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&X0(i)),e}return r._value=t,r}function z0(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,D0(t))}function L0(){for(var t=this._name,e=this._id,n=po(),r=this._groups,i=r.length,o=0;o<i;++o)for(var u=r[o],l=u.length,v,f=0;f<l;++f)if(v=u[f]){var d=Fe(v,e);Or(v,t,n,f,u,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new We(r,this._parents,t,n)}function G0(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,u){var l={value:u},v={value:function(){--i===0&&o()}};n.each(function(){var f=Ge(this,r),d=f.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(v)),f.on=e}),i===0&&o()})}var H0=0;function We(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function po(){return++H0}var Ve=Qn.prototype;We.prototype={constructor:We,select:k0,selectAll:A0,selectChild:Ve.selectChild,selectChildren:Ve.selectChildren,filter:p0,merge:m0,selection:$0,transition:L0,call:Ve.call,nodes:Ve.nodes,node:Ve.node,size:Ve.size,empty:Ve.empty,each:Ve.each,on:b0,attr:t0,attrTween:i0,style:N0,styleTween:P0,text:F0,textTween:z0,remove:w0,tween:Bv,delay:u0,duration:f0,ease:d0,easeVarying:g0,end:G0,[Symbol.iterator]:Ve[Symbol.iterator]};function U0(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var q0={time:null,delay:0,duration:250,ease:U0};function V0(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function B0(t){var e,n;t instanceof We?(e=t._id,t=t._name):(e=po(),(n=q0).time=Xa(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var u=r[o],l=u.length,v,f=0;f<l;++f)(v=u[f])&&Or(v,t,e,f,u,n||V0(v,e));return new We(r,this._parents,t,e)}Qn.prototype.interrupt=Uv;Qn.prototype.transition=B0;const Ea=Math.PI,Ta=2*Ea,on=1e-6,W0=Ta-on;function mo(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Q0(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return mo;const n=10**e;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class Z0{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?mo:Q0(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,o,u){this._append`C${+e},${+n},${+r},${+i},${this._x1=+o},${this._y1=+u}`}arcTo(e,n,r,i,o){if(e=+e,n=+n,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let u=this._x1,l=this._y1,v=r-e,f=i-n,d=u-e,m=l-n,_=d*d+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(_>on)if(!(Math.abs(m*v-f*d)>on)||!o)this._append`L${this._x1=e},${this._y1=n}`;else{let k=r-u,R=i-l,A=v*v+f*f,J=k*k+R*R,D=Math.sqrt(A),ft=Math.sqrt(_),nt=o*Math.tan((Ea-Math.acos((A+_-J)/(2*D*ft)))/2),H=nt/ft,F=nt/D;Math.abs(H-1)>on&&this._append`L${e+H*d},${n+H*m}`,this._append`A${o},${o},0,0,${+(m*k>d*R)},${this._x1=e+F*v},${this._y1=n+F*f}`}}arc(e,n,r,i,o,u){if(e=+e,n=+n,r=+r,u=!!u,r<0)throw new Error(`negative radius: ${r}`);let l=r*Math.cos(i),v=r*Math.sin(i),f=e+l,d=n+v,m=1^u,_=u?i-o:o-i;this._x1===null?this._append`M${f},${d}`:(Math.abs(this._x1-f)>on||Math.abs(this._y1-d)>on)&&this._append`L${f},${d}`,r&&(_<0&&(_=_%Ta+Ta),_>W0?this._append`A${r},${r},0,1,${m},${e-l},${n-v}A${r},${r},0,1,${m},${this._x1=f},${this._y1=d}`:_>on&&this._append`A${r},${r},0,${+(_>=Ea)},${m},${this._x1=e+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function j0(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Tr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Cn(t){return t=Tr(Math.abs(t)),t?t[1]:NaN}function J0(t,e){return function(n,r){for(var i=n.length,o=[],u=0,l=t[0],v=0;i>0&&l>0&&(v+l+1>r&&(l=Math.max(1,r-v)),o.push(n.substring(i-=l,i+l)),!((v+=l+1)>r));)l=t[u=(u+1)%t.length];return o.reverse().join(e)}}function K0(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var tg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sr(t){if(!(e=tg.exec(t)))throw new Error("invalid format: "+t);var e;return new La({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Sr.prototype=La.prototype;function La(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}La.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function eg(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var yo;function ng(t,e){var n=Tr(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(yo=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,u=r.length;return o===u?r:o>u?r+new Array(o-u+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Tr(t,Math.max(0,e+o-1))[0]}function ws(t,e){var n=Tr(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ks={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:j0,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>ws(t*100,e),r:ws,s:ng,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function As(t){return t}var Ms=Array.prototype.map,$s=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function rg(t){var e=t.grouping===void 0||t.thousands===void 0?As:J0(Ms.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?As:K0(Ms.call(t.numerals,String)),u=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",v=t.nan===void 0?"NaN":t.nan+"";function f(m){m=Sr(m);var _=m.fill,k=m.align,R=m.sign,A=m.symbol,J=m.zero,D=m.width,ft=m.comma,nt=m.precision,H=m.trim,F=m.type;F==="n"?(ft=!0,F="g"):ks[F]||(nt===void 0&&(nt=12),H=!0,F="g"),(J||_==="0"&&k==="=")&&(J=!0,_="0",k="=");var V=A==="$"?n:A==="#"&&/[boxX]/.test(F)?"0"+F.toLowerCase():"",st=A==="$"?r:/[%p]/.test(F)?u:"",$t=ks[F],wt=/[defgprs%]/.test(F);nt=nt===void 0?6:/[gprs]/.test(F)?Math.max(1,Math.min(21,nt)):Math.max(0,Math.min(20,nt));function Mt(q){var vt=V,at=st,x,z,O;if(F==="c")at=$t(q)+at,q="";else{q=+q;var Q=q<0||1/q<0;if(q=isNaN(q)?v:$t(Math.abs(q),nt),H&&(q=eg(q)),Q&&+q==0&&R!=="+"&&(Q=!1),vt=(Q?R==="("?R:l:R==="-"||R==="("?"":R)+vt,at=(F==="s"?$s[8+yo/3]:"")+at+(Q&&R==="("?")":""),wt){for(x=-1,z=q.length;++x<z;)if(O=q.charCodeAt(x),48>O||O>57){at=(O===46?i+q.slice(x+1):q.slice(x))+at,q=q.slice(0,x);break}}}ft&&!J&&(q=e(q,1/0));var ot=vt.length+q.length+at.length,ht=ot<D?new Array(D-ot+1).join(_):"";switch(ft&&J&&(q=e(ht+q,ht.length?D-at.length:1/0),ht=""),k){case"<":q=vt+q+at+ht;break;case"=":q=vt+ht+q+at;break;case"^":q=ht.slice(0,ot=ht.length>>1)+vt+q+at+ht.slice(ot);break;default:q=ht+vt+q+at;break}return o(q)}return Mt.toString=function(){return m+""},Mt}function d(m,_){var k=f((m=Sr(m),m.type="f",m)),R=Math.max(-8,Math.min(8,Math.floor(Cn(_)/3)))*3,A=Math.pow(10,-R),J=$s[8+R/3];return function(D){return k(A*D)+J}}return{format:f,formatPrefix:d}}var fr,_o,bo;ag({thousands:",",grouping:[3],currency:["$",""]});function ag(t){return fr=rg(t),_o=fr.format,bo=fr.formatPrefix,fr}function ig(t){return Math.max(0,-Cn(Math.abs(t)))}function sg(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Cn(e)/3)))*3-Cn(Math.abs(t)))}function og(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Cn(e)-Cn(t))+1}function xo(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const Is=Symbol("implicit");function wo(){var t=new rs,e=[],n=[],r=Is;function i(o){let u=t.get(o);if(u===void 0){if(r!==Is)return r;t.set(o,u=e.push(o)-1)}return n[u%n.length]}return i.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new rs;for(const u of o)t.has(u)||t.set(u,e.push(u)-1);return i},i.range=function(o){return arguments.length?(n=Array.from(o),i):n.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return wo(e,n).unknown(r)},xo.apply(i,arguments),i}function ug(t){return function(){return t}}function lg(t){return+t}var Es=[0,1];function $n(t){return t}function Sa(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:ug(isNaN(e)?NaN:.5)}function cg(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function fg(t,e,n){var r=t[0],i=t[1],o=e[0],u=e[1];return i<r?(r=Sa(i,r),o=n(u,o)):(r=Sa(r,i),o=n(o,u)),function(l){return o(r(l))}}function hg(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),u=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++u<r;)i[u]=Sa(t[u],t[u+1]),o[u]=n(e[u],e[u+1]);return function(l){var v=hh(t,l,1,r)-1;return o[v](i[v](l))}}function dg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function vg(){var t=Es,e=Es,n=Fa,r,i,o,u=$n,l,v,f;function d(){var _=Math.min(t.length,e.length);return u!==$n&&(u=cg(t[0],t[_-1])),l=_>2?hg:fg,v=f=null,m}function m(_){return _==null||isNaN(_=+_)?o:(v||(v=l(t.map(r),e,n)))(r(u(_)))}return m.invert=function(_){return u(i((f||(f=l(e,t.map(r),Pe)))(_)))},m.domain=function(_){return arguments.length?(t=Array.from(_,lg),d()):t.slice()},m.range=function(_){return arguments.length?(e=Array.from(_),d()):e.slice()},m.rangeRound=function(_){return e=Array.from(_),n=Ev,d()},m.clamp=function(_){return arguments.length?(u=_?!0:$n,d()):u!==$n},m.interpolate=function(_){return arguments.length?(n=_,d()):n},m.unknown=function(_){return arguments.length?(o=_,m):o},function(_,k){return r=_,i=k,d()}}function gg(){return vg()($n,$n)}function pg(t,e,n,r){var i=bh(t,e,n),o;switch(r=Sr(r??",f"),r.type){case"s":{var u=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=sg(i,u))&&(r.precision=o),bo(r,u)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=og(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=ig(i))&&(r.precision=o-(r.type==="%")*2);break}}return _o(r)}function mg(t){var e=t.domain;return t.ticks=function(n){var r=e();return _h(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return pg(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,o=r.length-1,u=r[i],l=r[o],v,f,d=10;for(l<u&&(f=u,u=l,l=f,f=i,i=o,o=f);d-- >0;){if(f=ya(u,l,n),f===v)return r[i]=u,r[o]=l,e(r);if(f>0)u=Math.floor(u/f)*f,l=Math.ceil(l/f)*f;else if(f<0)u=Math.ceil(u*f)/f,l=Math.floor(l*f)/f;else break;v=f}return t},t}function fn(){var t=gg();return t.copy=function(){return dg(t,fn())},xo.apply(t,arguments),mg(t)}function yg(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}const _g=yg("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function se(t){return function(){return t}}const Ts=Math.abs,ye=Math.atan2,sn=Math.cos,bg=Math.max,va=Math.min,De=Math.sin,In=Math.sqrt,_e=1e-12,Wn=Math.PI,Nr=Wn/2,_r=2*Wn;function xg(t){return t>1?0:t<-1?Wn:Math.acos(t)}function Ss(t){return t>=1?Nr:t<=-1?-Nr:Math.asin(t)}function ko(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Z0(e)}function wg(t){return t.innerRadius}function kg(t){return t.outerRadius}function Ag(t){return t.startAngle}function Mg(t){return t.endAngle}function $g(t){return t&&t.padAngle}function Ig(t,e,n,r,i,o,u,l){var v=n-t,f=r-e,d=u-i,m=l-o,_=m*v-d*f;if(!(_*_<_e))return _=(d*(e-o)-m*(t-i))/_,[t+_*v,e+_*f]}function hr(t,e,n,r,i,o,u){var l=t-n,v=e-r,f=(u?o:-o)/In(l*l+v*v),d=f*v,m=-f*l,_=t+d,k=e+m,R=n+d,A=r+m,J=(_+R)/2,D=(k+A)/2,ft=R-_,nt=A-k,H=ft*ft+nt*nt,F=i-o,V=_*A-R*k,st=(nt<0?-1:1)*In(bg(0,F*F*H-V*V)),$t=(V*nt-ft*st)/H,wt=(-V*ft-nt*st)/H,Mt=(V*nt+ft*st)/H,q=(-V*ft+nt*st)/H,vt=$t-J,at=wt-D,x=Mt-J,z=q-D;return vt*vt+at*at>x*x+z*z&&($t=Mt,wt=q),{cx:$t,cy:wt,x01:-d,y01:-m,x11:$t*(i/F-1),y11:wt*(i/F-1)}}function Ao(){var t=wg,e=kg,n=se(0),r=null,i=Ag,o=Mg,u=$g,l=null,v=ko(f);function f(){var d,m,_=+t.apply(this,arguments),k=+e.apply(this,arguments),R=i.apply(this,arguments)-Nr,A=o.apply(this,arguments)-Nr,J=Ts(A-R),D=A>R;if(l||(l=d=v()),k<_&&(m=k,k=_,_=m),!(k>_e))l.moveTo(0,0);else if(J>_r-_e)l.moveTo(k*sn(R),k*De(R)),l.arc(0,0,k,R,A,!D),_>_e&&(l.moveTo(_*sn(A),_*De(A)),l.arc(0,0,_,A,R,D));else{var ft=R,nt=A,H=R,F=A,V=J,st=J,$t=u.apply(this,arguments)/2,wt=$t>_e&&(r?+r.apply(this,arguments):In(_*_+k*k)),Mt=va(Ts(k-_)/2,+n.apply(this,arguments)),q=Mt,vt=Mt,at,x;if(wt>_e){var z=Ss(wt/_*De($t)),O=Ss(wt/k*De($t));(V-=z*2)>_e?(z*=D?1:-1,H+=z,F-=z):(V=0,H=F=(R+A)/2),(st-=O*2)>_e?(O*=D?1:-1,ft+=O,nt-=O):(st=0,ft=nt=(R+A)/2)}var Q=k*sn(ft),ot=k*De(ft),ht=_*sn(F),ut=_*De(F);if(Mt>_e){var _t=k*sn(nt),rt=k*De(nt),dt=_*sn(H),St=_*De(H),h;if(J<Wn)if(h=Ig(Q,ot,dt,St,_t,rt,ht,ut)){var y=Q-h[0],E=ot-h[1],S=_t-h[0],M=rt-h[1],C=1/De(xg((y*S+E*M)/(In(y*y+E*E)*In(S*S+M*M)))/2),B=In(h[0]*h[0]+h[1]*h[1]);q=va(Mt,(_-B)/(C-1)),vt=va(Mt,(k-B)/(C+1))}else q=vt=0}st>_e?vt>_e?(at=hr(dt,St,Q,ot,k,vt,D),x=hr(_t,rt,ht,ut,k,vt,D),l.moveTo(at.cx+at.x01,at.cy+at.y01),vt<Mt?l.arc(at.cx,at.cy,vt,ye(at.y01,at.x01),ye(x.y01,x.x01),!D):(l.arc(at.cx,at.cy,vt,ye(at.y01,at.x01),ye(at.y11,at.x11),!D),l.arc(0,0,k,ye(at.cy+at.y11,at.cx+at.x11),ye(x.cy+x.y11,x.cx+x.x11),!D),l.arc(x.cx,x.cy,vt,ye(x.y11,x.x11),ye(x.y01,x.x01),!D))):(l.moveTo(Q,ot),l.arc(0,0,k,ft,nt,!D)):l.moveTo(Q,ot),!(_>_e)||!(V>_e)?l.lineTo(ht,ut):q>_e?(at=hr(ht,ut,_t,rt,_,-q,D),x=hr(Q,ot,dt,St,_,-q,D),l.lineTo(at.cx+at.x01,at.cy+at.y01),q<Mt?l.arc(at.cx,at.cy,q,ye(at.y01,at.x01),ye(x.y01,x.x01),!D):(l.arc(at.cx,at.cy,q,ye(at.y01,at.x01),ye(at.y11,at.x11),!D),l.arc(0,0,_,ye(at.cy+at.y11,at.cx+at.x11),ye(x.cy+x.y11,x.cx+x.x11),D),l.arc(x.cx,x.cy,q,ye(x.y11,x.x11),ye(x.y01,x.x01),!D))):l.arc(0,0,_,F,H,D)}if(l.closePath(),d)return l=null,d+""||null}return f.centroid=function(){var d=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,m=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Wn/2;return[sn(m)*d,De(m)*d]},f.innerRadius=function(d){return arguments.length?(t=typeof d=="function"?d:se(+d),f):t},f.outerRadius=function(d){return arguments.length?(e=typeof d=="function"?d:se(+d),f):e},f.cornerRadius=function(d){return arguments.length?(n=typeof d=="function"?d:se(+d),f):n},f.padRadius=function(d){return arguments.length?(r=d==null?null:typeof d=="function"?d:se(+d),f):r},f.startAngle=function(d){return arguments.length?(i=typeof d=="function"?d:se(+d),f):i},f.endAngle=function(d){return arguments.length?(o=typeof d=="function"?d:se(+d),f):o},f.padAngle=function(d){return arguments.length?(u=typeof d=="function"?d:se(+d),f):u},f.context=function(d){return arguments.length?(l=d??null,f):l},f}function Mo(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function $o(t){this._context=t}$o.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Eg(t){return new $o(t)}function Tg(t){return t[0]}function Sg(t){return t[1]}function Ng(t,e){var n=se(!0),r=null,i=Eg,o=null,u=ko(l);t=typeof t=="function"?t:t===void 0?Tg:se(t),e=typeof e=="function"?e:e===void 0?Sg:se(e);function l(v){var f,d=(v=Mo(v)).length,m,_=!1,k;for(r==null&&(o=i(k=u())),f=0;f<=d;++f)!(f<d&&n(m=v[f],f,v))===_&&((_=!_)?o.lineStart():o.lineEnd()),_&&o.point(+t(m,f,v),+e(m,f,v));if(k)return o=null,k+""||null}return l.x=function(v){return arguments.length?(t=typeof v=="function"?v:se(+v),l):t},l.y=function(v){return arguments.length?(e=typeof v=="function"?v:se(+v),l):e},l.defined=function(v){return arguments.length?(n=typeof v=="function"?v:se(!!v),l):n},l.curve=function(v){return arguments.length?(i=v,r!=null&&(o=i(r)),l):i},l.context=function(v){return arguments.length?(v==null?r=o=null:o=i(r=v),l):r},l}function Cg(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function Rg(t){return t}function Pg(){var t=Rg,e=Cg,n=null,r=se(0),i=se(_r),o=se(0);function u(l){var v,f=(l=Mo(l)).length,d,m,_=0,k=new Array(f),R=new Array(f),A=+r.apply(this,arguments),J=Math.min(_r,Math.max(-_r,i.apply(this,arguments)-A)),D,ft=Math.min(Math.abs(J)/f,o.apply(this,arguments)),nt=ft*(J<0?-1:1),H;for(v=0;v<f;++v)(H=R[k[v]=v]=+t(l[v],v,l))>0&&(_+=H);for(e!=null?k.sort(function(F,V){return e(R[F],R[V])}):n!=null&&k.sort(function(F,V){return n(l[F],l[V])}),v=0,m=_?(J-f*nt)/_:0;v<f;++v,A=D)d=k[v],H=R[d],D=A+(H>0?H*m:0)+nt,R[d]={data:l[d],index:v,value:H,startAngle:A,endAngle:D,padAngle:ft};return R}return u.value=function(l){return arguments.length?(t=typeof l=="function"?l:se(+l),u):t},u.sortValues=function(l){return arguments.length?(e=l,n=null,u):e},u.sort=function(l){return arguments.length?(n=l,e=null,u):n},u.startAngle=function(l){return arguments.length?(r=typeof l=="function"?l:se(+l),u):r},u.endAngle=function(l){return arguments.length?(i=typeof l=="function"?l:se(+l),u):i},u.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:se(+l),u):o},u}function Ns(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function Ga(t,e){this._context=t,this._k=(1-e)/6}Ga.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Ns(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Ns(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(r){return new Ga(r,e)}return n.tension=function(r){return t(+r)},n})(0);function Og(t,e,n){var r=t._x1,i=t._y1,o=t._x2,u=t._y2;if(t._l01_a>_e){var l=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,v=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*l-t._x0*t._l12_2a+t._x2*t._l01_2a)/v,i=(i*l-t._y0*t._l12_2a+t._y2*t._l01_2a)/v}if(t._l23_a>_e){var f=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,d=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*f+t._x1*t._l23_2a-e*t._l12_2a)/d,u=(u*f+t._y1*t._l23_2a-n*t._l12_2a)/d}t._context.bezierCurveTo(r,i,o,u,t._x2,t._y2)}function Io(t,e){this._context=t,this._alpha=e}Io.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Og(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Yg=function t(e){function n(r){return e?new Io(r,e):new Ga(r,0)}return n.alpha=function(r){return t(+r)},n}(.5),dr=t=>()=>t;function Fg(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Be(t,e,n){this.k=t,this.x=e,this.y=n}Be.prototype={constructor:Be,scale:function(t){return t===1?this:new Be(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Be(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ha=new Be(1,0,0);Be.prototype;function ga(t){t.stopImmediatePropagation()}function Ln(t){t.preventDefault(),t.stopImmediatePropagation()}function Xg(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Dg(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Cs(){return this.__zoom||Ha}function zg(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Lg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Gg(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],u=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),u>o?(o+u)/2:Math.min(0,o)||Math.max(0,u))}function Hg(){var t=Xg,e=Dg,n=Gg,r=zg,i=Lg,o=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],l=250,v=Yv,f=Na("start","zoom","end"),d,m,_,k=500,R=150,A=0,J=10;function D(x){x.property("__zoom",Cs).on("wheel.zoom",$t,{passive:!1}).on("mousedown.zoom",wt).on("dblclick.zoom",Mt).filter(i).on("touchstart.zoom",q).on("touchmove.zoom",vt).on("touchend.zoom touchcancel.zoom",at).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}D.transform=function(x,z,O,Q){var ot=x.selection?x.selection():x;ot.property("__zoom",Cs),x!==ot?F(x,z,O,Q):ot.interrupt().each(function(){V(this,arguments).event(Q).start().zoom(null,typeof z=="function"?z.apply(this,arguments):z).end()})},D.scaleBy=function(x,z,O,Q){D.scaleTo(x,function(){var ot=this.__zoom.k,ht=typeof z=="function"?z.apply(this,arguments):z;return ot*ht},O,Q)},D.scaleTo=function(x,z,O,Q){D.transform(x,function(){var ot=e.apply(this,arguments),ht=this.__zoom,ut=O==null?H(ot):typeof O=="function"?O.apply(this,arguments):O,_t=ht.invert(ut),rt=typeof z=="function"?z.apply(this,arguments):z;return n(nt(ft(ht,rt),ut,_t),ot,u)},O,Q)},D.translateBy=function(x,z,O,Q){D.transform(x,function(){return n(this.__zoom.translate(typeof z=="function"?z.apply(this,arguments):z,typeof O=="function"?O.apply(this,arguments):O),e.apply(this,arguments),u)},null,Q)},D.translateTo=function(x,z,O,Q,ot){D.transform(x,function(){var ht=e.apply(this,arguments),ut=this.__zoom,_t=Q==null?H(ht):typeof Q=="function"?Q.apply(this,arguments):Q;return n(Ha.translate(_t[0],_t[1]).scale(ut.k).translate(typeof z=="function"?-z.apply(this,arguments):-z,typeof O=="function"?-O.apply(this,arguments):-O),ht,u)},Q,ot)};function ft(x,z){return z=Math.max(o[0],Math.min(o[1],z)),z===x.k?x:new Be(z,x.x,x.y)}function nt(x,z,O){var Q=z[0]-O[0]*x.k,ot=z[1]-O[1]*x.k;return Q===x.x&&ot===x.y?x:new Be(x.k,Q,ot)}function H(x){return[(+x[0][0]+ +x[1][0])/2,(+x[0][1]+ +x[1][1])/2]}function F(x,z,O,Q){x.on("start.zoom",function(){V(this,arguments).event(Q).start()}).on("interrupt.zoom end.zoom",function(){V(this,arguments).event(Q).end()}).tween("zoom",function(){var ot=this,ht=arguments,ut=V(ot,ht).event(Q),_t=e.apply(ot,ht),rt=O==null?H(_t):typeof O=="function"?O.apply(ot,ht):O,dt=Math.max(_t[1][0]-_t[0][0],_t[1][1]-_t[0][1]),St=ot.__zoom,h=typeof z=="function"?z.apply(ot,ht):z,y=v(St.invert(rt).concat(dt/St.k),h.invert(rt).concat(dt/h.k));return function(E){if(E===1)E=h;else{var S=y(E),M=dt/S[2];E=new Be(M,rt[0]-S[0]*M,rt[1]-S[1]*M)}ut.zoom(null,E)}})}function V(x,z,O){return!O&&x.__zooming||new st(x,z)}function st(x,z){this.that=x,this.args=z,this.active=0,this.sourceEvent=null,this.extent=e.apply(x,z),this.taps=0}st.prototype={event:function(x){return x&&(this.sourceEvent=x),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(x,z){return this.mouse&&x!=="mouse"&&(this.mouse[1]=z.invert(this.mouse[0])),this.touch0&&x!=="touch"&&(this.touch0[1]=z.invert(this.touch0[0])),this.touch1&&x!=="touch"&&(this.touch1[1]=z.invert(this.touch1[0])),this.that.__zoom=z,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(x){var z=Kt(this.that).datum();f.call(x,this.that,new Fg(x,{sourceEvent:this.sourceEvent,target:D,type:x,transform:this.that.__zoom,dispatch:f}),z)}};function $t(x,...z){if(!t.apply(this,arguments))return;var O=V(this,z).event(x),Q=this.__zoom,ot=Math.max(o[0],Math.min(o[1],Q.k*Math.pow(2,r.apply(this,arguments)))),ht=an(x);if(O.wheel)(O.mouse[0][0]!==ht[0]||O.mouse[0][1]!==ht[1])&&(O.mouse[1]=Q.invert(O.mouse[0]=ht)),clearTimeout(O.wheel);else{if(Q.k===ot)return;O.mouse=[ht,Q.invert(ht)],yr(this),O.start()}Ln(x),O.wheel=setTimeout(ut,R),O.zoom("mouse",n(nt(ft(Q,ot),O.mouse[0],O.mouse[1]),O.extent,u));function ut(){O.wheel=null,O.end()}}function wt(x,...z){if(_||!t.apply(this,arguments))return;var O=x.currentTarget,Q=V(this,z,!0).event(x),ot=Kt(x.view).on("mousemove.zoom",rt,!0).on("mouseup.zoom",dt,!0),ht=an(x,O),ut=x.clientX,_t=x.clientY;av(x.view),ga(x),Q.mouse=[ht,this.__zoom.invert(ht)],yr(this),Q.start();function rt(St){if(Ln(St),!Q.moved){var h=St.clientX-ut,y=St.clientY-_t;Q.moved=h*h+y*y>A}Q.event(St).zoom("mouse",n(nt(Q.that.__zoom,Q.mouse[0]=an(St,O),Q.mouse[1]),Q.extent,u))}function dt(St){ot.on("mousemove.zoom mouseup.zoom",null),iv(St.view,Q.moved),Ln(St),Q.event(St).end()}}function Mt(x,...z){if(t.apply(this,arguments)){var O=this.__zoom,Q=an(x.changedTouches?x.changedTouches[0]:x,this),ot=O.invert(Q),ht=O.k*(x.shiftKey?.5:2),ut=n(nt(ft(O,ht),Q,ot),e.apply(this,z),u);Ln(x),l>0?Kt(this).transition().duration(l).call(F,ut,Q,x):Kt(this).call(D.transform,ut,Q,x)}}function q(x,...z){if(t.apply(this,arguments)){var O=x.touches,Q=O.length,ot=V(this,z,x.changedTouches.length===Q).event(x),ht,ut,_t,rt;for(ga(x),ut=0;ut<Q;++ut)_t=O[ut],rt=an(_t,this),rt=[rt,this.__zoom.invert(rt),_t.identifier],ot.touch0?!ot.touch1&&ot.touch0[2]!==rt[2]&&(ot.touch1=rt,ot.taps=0):(ot.touch0=rt,ht=!0,ot.taps=1+!!d);d&&(d=clearTimeout(d)),ht&&(ot.taps<2&&(m=rt[0],d=setTimeout(function(){d=null},k)),yr(this),ot.start())}}function vt(x,...z){if(this.__zooming){var O=V(this,z).event(x),Q=x.changedTouches,ot=Q.length,ht,ut,_t,rt;for(Ln(x),ht=0;ht<ot;++ht)ut=Q[ht],_t=an(ut,this),O.touch0&&O.touch0[2]===ut.identifier?O.touch0[0]=_t:O.touch1&&O.touch1[2]===ut.identifier&&(O.touch1[0]=_t);if(ut=O.that.__zoom,O.touch1){var dt=O.touch0[0],St=O.touch0[1],h=O.touch1[0],y=O.touch1[1],E=(E=h[0]-dt[0])*E+(E=h[1]-dt[1])*E,S=(S=y[0]-St[0])*S+(S=y[1]-St[1])*S;ut=ft(ut,Math.sqrt(E/S)),_t=[(dt[0]+h[0])/2,(dt[1]+h[1])/2],rt=[(St[0]+y[0])/2,(St[1]+y[1])/2]}else if(O.touch0)_t=O.touch0[0],rt=O.touch0[1];else return;O.zoom("touch",n(nt(ut,_t,rt),O.extent,u))}}function at(x,...z){if(this.__zooming){var O=V(this,z).event(x),Q=x.changedTouches,ot=Q.length,ht,ut;for(ga(x),_&&clearTimeout(_),_=setTimeout(function(){_=null},k),ht=0;ht<ot;++ht)ut=Q[ht],O.touch0&&O.touch0[2]===ut.identifier?delete O.touch0:O.touch1&&O.touch1[2]===ut.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(ut=an(ut,this),Math.hypot(m[0]-ut[0],m[1]-ut[1])<J)){var _t=Kt(this).on("dblclick.zoom");_t&&_t.apply(this,arguments)}}}return D.wheelDelta=function(x){return arguments.length?(r=typeof x=="function"?x:dr(+x),D):r},D.filter=function(x){return arguments.length?(t=typeof x=="function"?x:dr(!!x),D):t},D.touchable=function(x){return arguments.length?(i=typeof x=="function"?x:dr(!!x),D):i},D.extent=function(x){return arguments.length?(e=typeof x=="function"?x:dr([[+x[0][0],+x[0][1]],[+x[1][0],+x[1][1]]]),D):e},D.scaleExtent=function(x){return arguments.length?(o[0]=+x[0],o[1]=+x[1],D):[o[0],o[1]]},D.translateExtent=function(x){return arguments.length?(u[0][0]=+x[0][0],u[1][0]=+x[1][0],u[0][1]=+x[0][1],u[1][1]=+x[1][1],D):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},D.constrain=function(x){return arguments.length?(n=x,D):n},D.duration=function(x){return arguments.length?(l=+x,D):l},D.interpolate=function(x){return arguments.length?(v=x,D):v},D.on=function(){var x=f.on.apply(f,arguments);return x===f?D:x},D.clickDistance=function(x){return arguments.length?(A=(x=+x)*x,D):Math.sqrt(A)},D.tapDistance=function(x){return arguments.length?(J=+x,D):J},D}const Ug=["width","height"],qg=["transform"],Vg=["y","height","fill"],Bg=["y","fill-opacity","stroke-opacity","onMouseover","onClick"],Wg={class:"minimap-link-layer"},Qg=["transform"],Zg=["d","stroke-width","stroke-opacity"],jg={class:"minimap-point-layer"},Jg=["cx","cy","r","fill","stroke","onMouseover","onClick"],Kg=["x","y","fill"],tp=Le({__name:"VMiniMap",props:{canvasWidth:{type:Number,default:40},canvasHeight:{type:Number,default:400},paddingX:{type:Number,default:5},baseLineHeight:{type:Number,default:20},minRadius:{default:3},maxRadiusRatio:{default:.3},colorScheme:{default:["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},records:{type:Array,required:!0},links:{type:Array,default:null},similarityMatrix:{type:Array,default:null},stages:{type:Array,default:null},hovered:{type:Object,default:null}},emits:["hover-prompt","unhover-prompt","click-prompt","update-stage"],setup(t,{emit:e}){const n=t,{canvasWidth:r,canvasHeight:i,paddingX:o,baseLineHeight:u,minRadius:l,maxRadiusRatio:v,colorScheme:f}=n,{records:d,links:m,similarityMatrix:_,hovered:k}=Rn(n),R=e,A=Xt(()=>Math.min(u*d.value.length,i)/d.value.length),J=Xt(()=>{const wt=Math.min(...d.value.map(q=>q.prompt.length)),Mt=Math.max(...d.value.map(q=>q.prompt.length));return[wt,Mt]}),D=Xt(()=>{const wt=Math.max(l,A.value*v);return[l,wt]}),ft=Xt(()=>fn(J.value,D.value)),nt=Xt(()=>Us.scale(f).mode("lab").domain([0,d.value.length-1])),H=Xt(()=>d.value.map((wt,Mt)=>({...wt,x:r/2,y:A.value*Mt+A.value/2}))),F=Xt(()=>{if(m.value===null)return[];const wt=new Map;m.value.forEach(([x,z])=>{const O=_.value[x][z];(!wt.has(z)||wt.get(z).maxSim<O)&&wt.set(z,{maxSrc:x,maxSim:O})});const Mt=m.value.map(([x,z])=>({source:{id:x,x:H.value[x].x,y:H.value[x].y},target:{id:z,x:H.value[z].x,y:H.value[z].y}})),q=Math.max(...Mt.map(({source:x,target:z})=>Math.abs(x.y-z.y)))/2,vt=Math.min(r/2-o,q),at=(x,z)=>{const O=Math.abs(x.y-z.y)/2,Q=vt*O/q,ot=(Q*Q+O*O)/(2*Q),ht=Math.atan2(O,ot-Q);return{arc:Ao().innerRadius(ot).outerRadius(ot).startAngle(Math.PI+Math.PI/2-ht).endAngle(Math.PI+Math.PI/2+ht)(),offsetX:ot-Q}};return Mt.map(({source:x,target:z})=>({source:{x:x.x,y:x.y},target:{x:z.x,y:z.y},...at(x,z),highlight:wt.has(z.id)&&wt.get(z.id).maxSrc===x.id}))}),V=Vt(null),st=Vt(null),$t=Vt([]);return Te(k,(wt,Mt)=>{if($t.value=[],wt===null){st.value=null;return}const{field:q,value:vt,triggerView:at}=wt;if(q==="prompt")st.value=vt;else if(q==="word"){Mt&&Mt.field==="prompt"&&(st.value=Mt.value);const x=vt.text;$t.value=d.value.filter(z=>z.promptTokens.includes(x)).map(z=>z.promptId)}else if(q==="image"){const{promptIndex:x}=vt;st.value=x}}),(wt,Mt)=>(it(),ct("svg",{width:et(r),height:et(i)},[P("g",{class:"minimap-stage-layer",transform:`translate(${et(r)-10}, 0)`},[(it(!0),ct(ge,null,pe(t.stages,(q,vt)=>(it(),ct("g",{class:"minimap-stage",key:vt},[P("rect",{x:-5,y:q[0]*A.value+2,width:5,height:(q[q.length-1]-q[0]+1)*A.value-4,rx:5,ry:5,fill:nt.value(Math.ceil((q[q.length-1]+q[0])/2)),"fill-opacity":.9},null,8,Vg)]))),128)),(it(!0),ct(ge,null,pe(et(d),(q,vt)=>(it(),ct("g",{class:"minimap-stage-segment",key:vt},[vt?(it(),ct("rect",{key:0,x:-9,y:vt*A.value-4,rx:2,ry:2,width:13,height:8,fill:"#f0f0f0","fill-opacity":V.value===vt?.8:0,stroke:"#666666","stroke-opacity":V.value===vt?1:0,style:{cursor:"pointer"},onMouseover:()=>V.value=vt,onMouseout:Mt[0]||(Mt[0]=()=>V.value=null),onClick:()=>R("update-stage",vt)},null,40,Bg)):te("",!0)]))),128))],8,qg),P("g",Wg,[(it(!0),ct(ge,null,pe(F.value,({source:q,target:vt,arc:at,offsetX:x,highlight:z},O)=>(it(),ct("g",{class:"minimap-link",key:O,transform:`translate(
                    ${et(r)/2+x},
                    ${(q.y+vt.y)/2}
                )`},[P("path",{d:at,fill:"none",stroke:"#666","stroke-width":z?2:.5,"stroke-opacity":z?1:.1},null,8,Zg)],8,Qg))),128))]),P("g",jg,[(it(!0),ct(ge,null,pe(H.value,(q,vt)=>(it(),ct("g",{class:"minimap-point",key:vt},[P("circle",{cx:q.x,cy:q.y,r:ft.value(q.prompt.length),fill:st.value===vt?"#fbbf24":nt.value(vt),"stroke-width":2,stroke:$t.value.includes(vt)?"#fbbf24":"none",onMouseover:at=>R("hover-prompt",vt),onMouseout:Mt[1]||(Mt[1]=at=>R("unhover-prompt")),onClick:()=>R("click-prompt",vt)},null,40,Jg),(vt+1)%5===0?(it(),ct("text",{key:0,x:q.x+ft.value(q.prompt.length)+2,y:q.y+5,"font-size":10,fill:nt.value(vt)},be(vt+1),9,Kg)):te("",!0)]))),128))])],8,Ug))}}),ep=t=>t&&JSON.parse(JSON.stringify(t)),np=(t,e,n)=>rp(t,e,n).sort((i,o)=>o.weight-i.weight).map(i=>i.index),rp=(t,e,n)=>{const r=ep(t);for(const i of r)i.weight=0;for(const i of n)i.edges.forEach(o=>{const u=e[o];r[u.src].weight+=u.weight,r[u.tgt].weight+=u.weight});return r};function Rs(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)}const pa=(t,e=r=>r,n=r=>r)=>{const{data:r,...i}=t;return i.x=e(t.x),i.y=n(t.y),i};function ap(){let t=n=>n,e=n=>n;this.xScale=n=>n.length?(t=n,this):t,this.yScale=n=>n.length?(e=n,this):e,this.node=(n,r=!0)=>r?pa(n,t,e):pa(n),this.nodes=(...n)=>n.map(r=>pa(r,t,e))}const ma=Ng().curve(Yg.alpha(.5)).x(t=>t.x).y(t=>t.y),Ps=(t,e,n)=>{ma([t,n,e]);const r=e.x-t.x,i=e.y-t.y,u=Math.atan2(i,r)+Math.PI/2,l=2,v=l*2,f={x:n.x+l*Math.cos(u),y:n.y+l*Math.sin(u)},d={x:n.x-l*Math.cos(u),y:n.y-l*Math.sin(u)},m={x:t.x+v*Math.cos(u),y:t.y+v*Math.sin(u)},_={x:t.x-v*Math.cos(u),y:t.y-v*Math.sin(u)},k=ma([m,f,e]),R=ma([e,d,_]);return`${k} L ${R.slice(1)} Z`};function ee(){function t(h){var y=this,E=0,S=0,M=0,C=0,B=0;this.rect=function(U){if(!arguments.length)return{x:E,y:S,width:M,height:C};E=+U.x,S=+U.y,M=+U.width,C=+U.height},this.minX=function(){return E},this.minY=function(){return S},this.maxX=function(){return E+M},this.maxY=function(){return S+C},this.centerX=function(){return E+M*.5},this.centerY=function(){return S+C*.5},this.width=function(){return M},this.height=function(){return C},this.centroidDistance=function(U){if(!arguments.length)return B;B=U},this.cmp=function(U){return B<U.centroidDistance()?-1:(B>U.centroidDistance(),0)},this.add=function(U){var tt=Math.min(y.minX(),U.minX()),j=Math.min(y.minY(),U.minY()),mt=Math.max(y.maxX(),U.maxX()),yt=Math.max(y.maxY(),U.maxY());E=tt,S=j,M=mt-E,C=yt-S},this.contains=function(U){var tt=U.x(),j=U.y();return y.containsPt(tt,j)},this.containsPt=function(U,tt){return U<E||U>=E+M?!1:!(tt<S||tt>=S+C)},this.intersects=function(U){return y.width()<=0||y.height()<=0||U.width()<=0||U.height()<=0?!1:U.maxX()>y.minX()&&U.maxY()>y.minY()&&U.minX()<y.maxX()&&U.minY()<y.maxY()},this.intersectsLine=function(U){var tt=U.x1(),j=U.y1(),mt=U.x2(),yt=U.y2(),bt,Nt;if((Nt=y.outcode(mt,yt))===0)return!0;for(;(bt=y.outcode(tt,j))!==0;){if(bt&Nt)return!1;if(bt&(t.OUT_LEFT|t.OUT_RIGHT)){var Ht=y.minX();bt&t.OUT_RIGHT&&(Ht+=y.width()),j=j+(Ht-tt)*(yt-j)/(mt-tt),tt=Ht}else{var zt=y.minY();bt&t.OUT_BOTTOM&&(zt+=y.height()),tt=tt+(zt-j)*(mt-tt)/(yt-j),j=zt}}return!0},this.outcode=function(U,tt){var j=0;return M<=0?j|=t.OUT_LEFT|t.OUT_RIGHT:U<E?j|=t.OUT_LEFT:U>E+M&&(j|=t.OUT_RIGHT),C<=0?j|=t.OUT_TOP|t.OUT_BOTTOM:tt<S?j|=t.OUT_TOP:tt>S+C&&(j|=t.OUT_BOTTOM),j},arguments.length&&h&&this.rect(h)}t.prototype.toString=function(){return"Rectangle[x="+this.minX()+", y="+this.minY()+", w="+this.width()+", h="+this.height()+"]"},t.OUT_LEFT=1,t.OUT_TOP=2,t.OUT_RIGHT=4,t.OUT_BOTTOM=8;function e(h,y){var E=+h,S=+y;this.x=function(M){if(!arguments.length)return E;E=M},this.y=function(M){if(!arguments.length)return S;S=M},this.distanceSq=function(M){return e.ptsDistanceSq(E,S,M.x(),M.y())},this.get=function(){return[E,S]}}e.ptsDistanceSq=function(h,y,E,S){return(h-E)*(h-E)+(y-S)*(y-S)},e.doublePointsEqual=function(h,y,E,S,M){return e.ptsDistanceSq(h,y,E,S)<M*M};function n(h){var y=0,E=[];E.length=h;var S={};function M(C){return C.x()+"x"+C.y()}this.add=function(C){S[M(C)]=C,E[y]=C,y+=1},this.contains=function(C){var B=S[M(C)];return B?B.x()===C.x()&&B.y()===C.y():!1},this.isFirst=function(C){if(!y)return!1;var B=E[0];return B.x()===C.x()&&B.y()===C.y()},this.list=function(){return E.filter(function(C){return C}).map(function(C){return C.get()})},this.clear=function(){for(var C=0;C<E.length;C+=1)E[C]=null;S={},y=0},this.get=function(C){return E[C]},this.size=function(){return y}}function r(h,y,E,S){var M=+h,C=+y,B=+E,U=+S;this.rect=function(){var tt=Math.min(M,B),j=Math.min(C,U),mt=Math.max(M,B),yt=Math.max(C,U),bt=new t({x:tt,y:j,width:mt-tt,height:yt-j});return bt},this.x1=function(tt){if(!arguments.length)return M;M=tt},this.x2=function(tt){if(!arguments.length)return B;B=tt},this.y1=function(tt){if(!arguments.length)return C;C=tt},this.y2=function(tt){if(!arguments.length)return U;U=tt},this.cuts=function(tt){if(C===U)return!1;var j=tt.y();if(j<C&&j<=U||j>C&&j>=U)return!1;var mt=tt.x();if(mt>M&&mt>=B)return!1;if(mt<M&&mt<=B)return!0;var yt=M+(j-C)*(B-M)/(U-C);return mt<=yt},this.ptSegDistSq=function(tt,j){return ee.linePtSegDistSq(M,C,B,U,tt,j)},this.ptClose=function(tt,j,mt){if(M<B){if(tt<M-mt||tt>B+mt)return!1}else if(tt<B-mt||tt>M+mt)return!1;if(C<U){if(j<C-mt||j>U+mt)return!1}else if(j<U-mt||j>C+mt)return!1;return!0}}function i(h,y){var E=h*y,S=new Float32Array(E);this.bound=function(M,C){return M<0?0:Math.min(M,(C?h:y)-1)},this.get=function(M,C){return M<0||M>=h||C<0||C>=y?(console.warn("Area.get out of bounds",M,C,h,y),Number.NaN):S[M+C*h]},this.set=function(M,C,B){if(M<0||M>=h||C<0||C>=y){console.warn("Area.set out of bounds",M,C,h,y);return}S[M+C*h]=B},this.width=function(){return h},this.height=function(){return y}}function o(h,y){var E=h,S=y;this.getState=function(){return S},this.getPoint=function(){return E}}o.POINT=1,o.PARALLEL=2,o.COINCIDENT=3,o.NONE=4,o.intersectLineLine=function(h,y){var E=(y.x2()-y.x1())*(h.y1()-y.y1())-(y.y2()-y.y1())*(h.x1()-y.x1()),S=(h.x2()-h.x1())*(h.y1()-y.y1())-(h.y2()-h.y1())*(h.x1()-y.x1()),M=(y.y2()-y.y1())*(h.x2()-h.x1())-(y.x2()-y.x1())*(h.y2()-h.y1());if(M){var C=E/M,B=S/M;if(0<=C&&C<=1&&0<=B&&B<=1){var U=new e(h.x1()+C*(h.x2()-h.x1()),h.y1()+C*(h.y2()-h.y1()));return new o(U,o.POINT)}return new o(null,o.NONE)}return new o(null,E===0||S===0?o.COINCIDENT:o.PARALLEL)},o.fractionAlongLineA=function(h,y){var E=(y.x2()-y.x1())*(h.y1()-y.y1())-(y.y2()-y.y1())*(h.x1()-y.x1()),S=(h.x2()-h.x1())*(h.y1()-y.y1())-(h.y2()-h.y1())*(h.x1()-y.x1()),M=(y.y2()-y.y1())*(h.x2()-h.x1())-(y.x2()-y.x1())*(h.y2()-h.y1());if(M){var C=E/M,B=S/M;if(0<=C&&C<=1&&0<=B&&B<=1)return C}return Number.POSITIVE_INFINITY};var u=new r(0,0,0,0);o.fractionToLineCenter=function(h,y){var E=Number.POSITIVE_INFINITY,S=0;function M(C,B,U,tt){u.x1(C),u.y1(B),u.x2(U),u.y2(tt);var j=o.fractionAlongLineA(y,u);j=Math.abs(j-.5),j>=0&&j<=1&&(S+=1,j<E&&(E=j))}return M(h.minX(),h.minY(),h.maxX(),h.minY()),M(h.minX(),h.minY(),h.minX(),h.maxY()),S>1||(M(h.minX(),h.maxY(),h.maxX(),h.maxY()),S>1)?E:(M(h.maxX(),h.minY(),h.maxX(),h.maxY()),S===0?-1:E)},o.fractionToLineEnd=function(h,y){var E=Number.POSITIVE_INFINITY,S=0;function M(C,B,U,tt){var j=o.fractionAlongLineA(y,new r(C,B,U,tt));j>=0&&j<=1&&(S+=1,j<E&&(E=j))}return M(h.minX(),h.minY(),h.maxX(),h.minY()),M(h.minX(),h.minY(),h.minX(),h.maxY()),S>1||(M(h.minX(),h.maxY(),h.maxX(),h.maxY()),S>1)?E:(M(h.maxX(),h.minY(),h.maxX(),h.maxY()),S===0?-1:E)},o.testIntersection=function(h,y,E){var S=0;function M(C,B,U,tt,j){E[C]=o.intersectLineLine(h,new r(B,U,tt,j)),E[C].getState()===o.POINT&&(S+=1)}return M(0,y.minX(),y.minY(),y.maxX(),y.minY()),M(1,y.minX(),y.minY(),y.minX(),y.maxY()),M(2,y.minX(),y.maxY(),y.maxX(),y.maxY()),M(3,y.maxX(),y.minY(),y.maxX(),y.maxY()),S};function l(h,y,E,S){var M=l.S,C=S,B=!1;function U(mt,yt,bt,Nt){var Ht=y.get(mt,yt);return isNaN(Ht)?Ht:Ht>C?bt+Nt:bt}function tt(mt,yt){var bt=0;return bt=U(mt,yt,bt,1),bt=U(mt+1,yt,bt,2),bt=U(mt,yt+1,bt,4),bt=U(mt+1,yt+1,bt,8),isNaN(bt)?(console.warn("marched out of bounds: "+mt+" "+yt+" bounds: "+y.width()+" "+y.height()),-1):bt}function j(mt,yt){for(var bt=mt,Nt=yt;;){var Ht=new e(bt*E,Nt*E);if(h.contains(Ht)){if(h.isFirst(Ht))return!0}else h.add(Ht);var zt=tt(bt,Nt);switch(zt){case-1:return!0;case 0:case 3:case 2:case 7:M=l.E;break;case 12:case 14:case 4:M=l.W;break;case 6:M=M===l.N?l.W:l.E;break;case 1:case 13:case 5:M=l.N;break;case 9:M=M===l.E?l.N:l.S;break;case 10:case 8:case 11:M=l.S;break;default:return console.warn("Marching squares invalid state: "+zt),!0}switch(M){case l.N:Nt-=1;break;case l.S:Nt+=1;break;case l.W:bt-=1;break;case l.E:bt+=1;break;default:return console.warn("Marching squares invalid state: "+zt),!0}}return console.warn("should not be reachable..."),!0}this.march=function(){for(var mt=0;mt<y.width()&&!B;mt+=1)for(var yt=0;yt<y.height()&&!B;yt+=1)y.get(mt,yt)>C&&tt(mt,yt)!=15&&(B=j(mt,yt));return B}}l.N=0,l.S=1,l.E=2,l.W=3;var v=ee.DEFAULT_MAX_ROUTING_ITERATIONS,f=ee.DEFAULT_MAX_MARCHING_ITERATIONS,d=ee.DEFAULT_PIXEL_GROUP,m=ee.DEFAULT_EDGE_R0,_=ee.DEFAULT_EDGE_R1,k=ee.DEFAULT_NODE_R0,R=ee.DEFAULT_NODE_R1,A=ee.DEFAULT_MORPH_BUFFER,J=ee.DEFAULT_SKIP;this.maxRoutingIterations=function(h){if(!arguments.length)return v;v=h},this.maxMarchingIterations=function(h){if(!arguments.length)return f;f=h},this.pixelGroup=function(h){if(!arguments.length)return d;d=h},this.edgeR0=function(h){if(!arguments.length)return m;m=h},this.edgeR1=function(h){if(!arguments.length)return _;_=h},this.nodeR0=function(h){if(!arguments.length)return k;k=h},this.nodeR1=function(h){if(!arguments.length)return R;R=h},this.morphBuffer=function(h){if(!arguments.length)return A;A=h},this.skip=function(h){if(!arguments.length)return J;J=h};var D=1,ft=1,nt=1,H=-.8,F=null,V=[],st=null,$t=Number.NaN;this.createOutline=function(h,y,E){if(!h.length)return[];var S=h.map(function(kt){return new t(kt)}),M=y.map(function(kt){return new t(kt)});x(S,M),E&&E.forEach(function(kt){V.push(new r(kt.x1,kt.y1,kt.x2,kt.y2))}),F=null,S.forEach(function(kt){F?F.add(kt):F=new t(kt.rect())}),V.forEach(function(kt){F.add(kt.rect())}),F.rect({x:F.minX()-Math.max(_,R)-A,y:F.minY()-Math.max(_,R)-A,width:F.width()+2*Math.max(_,R)+2*A,height:F.height()+2*Math.max(_,R)+2*A}),st=new i(Math.ceil(F.width()/d),Math.ceil(F.height()/d));var C=(Math.floor(F.width())+Math.floor(F.height()))*2,B=new n(C),U=D,tt=H,j=ft,mt=nt,yt=0;for(vt(F,S,M,st);!Mt(B,F,S,M,st)&&yt<f;)B.clear(),yt+=1,yt<=f*.5&&H!=0&&(D*=.95,H*=.8,vt(F,S,M,st)),yt>f*.5&&(D*=.95,ft*=1.2,nt*=1.2,vt(F,S,M,st));$t=D,D=U,H=tt,ft=j,nt=mt;var bt=J,Nt=B.size();if(bt>1)for(Nt=Math.floor(B.size()/bt);Nt<3&&bt>1;)bt-=1,Nt=Math.floor(B.size()/bt);for(var Ht=F.minX(),zt=F.minY(),Ct=new n(Nt),ae=0,jt=0;jt<Nt;jt+=1,ae+=bt)Ct.add(new e(B.get(ae).x()+Ht,B.get(ae).y()+zt));return wt||(F=null,st=null),Ct.list()};var wt=!1;this.debug=function(h){if(!arguments.length)return wt;wt=!!h},this.debugPotentialArea=function(){wt||console.warn("debug mode should be activated");for(var h=[],y=0;y<st.width();y+=1)for(var E=0;E<st.height();E+=1)h.push({x:y*d+Math.floor(F.minX()),y:E*d+Math.floor(F.minY()),width:d,height:d,value:st.get(y,E),threshold:$t});return h};function Mt(h,y,E,S,M){return new l(h,M,d,D).march()?q(h,y,E,S)[0]:!1}function q(h,y,E,S){var M=[],C=null;function B(ae,jt){var kt=null,he=null,me=0;return ae.forEach(function(Zt){if(!kt){kt=new r(Zt.x(),Zt.y(),Zt.x(),Zt.y()),he=Zt;return}kt.x1(kt.x2()),kt.y1(kt.y2()),kt.x2(Zt.x()),kt.y2(Zt.y()),kt.cuts(jt)&&(me+=1)}),he&&(kt.x1(kt.x2()),kt.y1(kt.y2()),kt.x2(he.x()),kt.y2(he.y()),kt.cuts(jt)&&(me+=1)),me%2===1}var U=J,tt=h.size();if(U>1)for(tt=h.size()/U;tt<3&&U>1;)U--,tt=h.size()/U;for(var j=y.minX(),mt=y.minY(),yt=0;yt<tt-1;yt+=1){var bt=h.get(yt*U).x()+j,Nt=h.get(yt*U).y()+mt,Ht={x:bt,y:Nt,width:0,height:0};C?C.add(new t(Ht)):C=new t(Ht),M.push(new e(bt,Nt))}var zt=!0,Ct=!1;return C&&(E.forEach(function(ae){var jt=new e(ae.centerX(),ae.centerY());zt=zt&&C.contains(jt),zt=zt&&B(M,jt)}),S.forEach(function(ae){var jt=new e(ae.centerX(),ae.centerY());C.contains(jt)&&B(M,jt)&&(Ct=!0)})),[zt,Ct]}function vt(h,y,E,S){var M=0;if(ft&&y.forEach(function(B){M=ft;var U=k-R,tt=U*U;rt(S,M/tt,R,B)}),nt){M=nt;var C=(m-_)*(m-_);V.length>0&&ut(S,M/C,_,V,h)}H&&E.forEach(function(B){if(h.intersects(B)){M=H;var U=k-R,tt=U*U;dt(S,M/tt,R,B)}})}function at(h){var y=0,E=0,S=0;h.forEach(function(M){y+=M.centerX(),E+=M.centerY(),S+=1}),y/=S,E/=S,h.forEach(function(M){var C=y-M.centerX(),B=E-M.centerY();M.centroidDistance(Math.sqrt(C*C+B*B))})}function x(h,y){var E=[];V=[],at(h),h.sort(function(S,M){return S.cmp(M)}),h.forEach(function(S){var M=z(y,S,E);M.forEach(function(C){V.push(C)}),E.push(S)})}function z(h,y,E){var S=[],M=[],C=new e(y.centerX(),y.centerY()),B=null,U=Number.POSITIVE_INFINITY;if(E.forEach(function(ue){var Ae=new e(ue.centerX(),ue.centerY()),ie=C.distanceSq(Ae),Xe=new r(C.x(),C.y(),Ae.x(),Ae.y()),Se=ht(h,Xe);ie*(Se+1)*(Se+1)<U&&(B=ue,U=ie*(Se+1)*(Se+1))}),B){var tt=new r(C.x(),C.y(),B.centerX(),B.centerY());M.push(tt);var j=!0,mt=0,yt=[];yt.length=4;for(var bt=0;j&&mt<v;)for(j=!1;!j&&M.length;){var Nt=M.pop(),Ht=ot(h,Nt);if(Ht&&(bt=o.testIntersection(Nt,Ht,yt),bt===2)){for(var zt=A,Ct=St(Ht,zt,yt,!0),ae=Q(Ct,M)||Q(Ct,S),jt=O(Ct,h);!ae&&jt&&zt>=1;)zt/=1.5,Ct=St(Ht,zt,yt,!0),ae=Q(Ct,M)||Q(Ct,S),jt=O(Ct,h);if(Ct&&!ae&&!jt&&(M.push(new r(Nt.x1(),Nt.y1(),Ct.x(),Ct.y())),M.push(new r(Ct.x(),Ct.y(),Nt.x2(),Nt.y2())),j=!0),!j){zt=A,Ct=St(Ht,zt,yt,!1);var kt=Q(Ct,M)||Q(Ct,S);for(jt=O(Ct,h);!kt&&jt&&zt>=1;)zt/=1.5,Ct=St(Ht,zt,yt,!1),kt=Q(Ct,M)||Q(Ct,S),jt=O(Ct,h);Ct&&!kt&&(M.push(new r(Nt.x1(),Nt.y1(),Ct.x(),Ct.y())),M.push(new r(Ct.x(),Ct.y(),Nt.x2(),Nt.y2())),j=!0)}}j||S.push(Nt),mt+=1}for(;M.length;)S.push(M.pop());for(;S.length;){var he=S.pop();if(S.length){var me=S.pop(),Zt=new r(he.x1(),he.y1(),me.x2(),me.y2()),Ht=ot(h,Zt);Ht?(M.push(he),S.push(me)):S.push(Zt)}else M.push(he)}S=M}return S}function O(h,y){return y.some(function(E){return E.contains(h)})}function Q(h,y){var E=!1;return y.forEach(function(S){E||(e.doublePointsEqual(S.x1(),S.y1(),h.x(),h.y(),.001)&&(E=!0),e.doublePointsEqual(S.x2(),S.y2(),h.x(),h.y(),.001)&&(E=!0))}),E}function ot(h,y){var E=Number.POSITIVE_INFINITY,S=null;return h.forEach(function(M){if(M.intersectsLine(y)){var C=o.fractionToLineCenter(M,y);C>=0&&C<E&&(S=M,E=C)}}),S}function ht(h,y){return h.reduce(function(E,S){return S.intersectsLine(y)&&o.fractionToLineCenter(S,y)>=0?E+1:E},0)}function ut(h,y,E,S,M){S.forEach(function(C){for(var B=C.rect(),U=h.bound(Math.floor((B.minX()-E-M.minX())/d),!0),tt=h.bound(Math.floor((B.minY()-E-M.minY())/d),!1),j=h.bound(Math.ceil((B.maxX()+E-M.minX())/d),!0),mt=h.bound(Math.ceil((B.maxY()+E-M.minY())/d),!1),yt=tt;yt<mt;yt+=1)for(var bt=U;bt<j;bt+=1)if(!(y<0&&h.get(bt,yt)<=0)){var Nt=bt*d+M.minX(),Ht=yt*d+M.minY(),zt=C.ptSegDistSq(Nt,Ht);if(zt<E*E){var Ct=Math.sqrt(zt)-E;h.set(bt,yt,h.get(bt,yt)+y*Ct*Ct)}}})}function _t(h,y,E){if(!h.containsPt(y,E)){var S=h.outcode(y,E);if((S&t.OUT_TOP)===t.OUT_TOP)return(S&t.OUT_LEFT)===t.OUT_LEFT?e.ptsDistanceSq(y,E,h.minX(),h.minY()):(S&t.OUT_RIGHT)===t.OUT_RIGHT?e.ptsDistanceSq(y,E,h.maxX(),h.minY()):(h.minY()-E)*(h.minY()-E);if((S&t.OUT_BOTTOM)===t.OUT_BOTTOM)return(S&t.OUT_LEFT)===t.OUT_LEFT?e.ptsDistanceSq(y,E,h.minX(),h.maxY()):(S&t.OUT_RIGHT)===t.OUT_RIGHT?e.ptsDistanceSq(y,E,h.maxX(),h.maxY()):(E-h.maxY())*(E-h.maxY());if((S&t.OUT_LEFT)===t.OUT_LEFT)return(h.minX()-y)*(h.minX()-y);if((S&t.OUT_RIGHT)===t.OUT_RIGHT)return(y-h.maxX())*(y-h.maxX())}return 0}function rt(h,y,E,S){y<0&&console.warn("expected positive influence",y);for(var M=h.bound(Math.floor((S.minX()-E-F.minX())/d),!0),C=h.bound(Math.floor((S.minY()-E-F.minY())/d),!1),B=h.bound(Math.ceil((S.maxX()+E-F.minX())/d),!0),U=h.bound(Math.ceil((S.maxY()+E-F.minY())/d),!1),tt=C;tt<U;tt+=1)for(var j=M;j<B;j+=1){var mt=j*d+F.minX(),yt=tt*d+F.minY(),bt=_t(S,mt,yt);if(bt<E*E){var Nt=Math.sqrt(bt)-E;h.set(j,tt,h.get(j,tt)+y*Nt*Nt)}}}function dt(h,y,E,S){y>0&&console.warn("expected negative influence",y);for(var M=h.bound(Math.floor((S.minX()-E-F.minX())/d),!0),C=h.bound(Math.floor((S.minY()-E-F.minY())/d),!1),B=h.bound(Math.ceil((S.maxX()+E-F.minX())/d),!0),U=h.bound(Math.ceil((S.maxY()+E-F.minY())/d),!1),tt=C;tt<U;tt+=1)for(var j=M;j<B;j+=1)if(!(h.get(j,tt)<=0)){var mt=j*d+F.minX(),yt=tt*d+F.minY(),bt=_t(S,mt,yt);if(bt<E*E){var Nt=Math.sqrt(bt)-E;h.set(j,tt,h.get(j,tt)+y*Nt*Nt)}}}function St(h,y,E,S){var M=E[0],C=E[1],B=E[2],U=E[3];if(S){if(C.getState()===o.POINT){if(M.getState()===o.POINT)return new e(h.minX()-y,h.minY()-y);if(B.getState()===o.POINT)return new e(h.minX()-y,h.maxY()+y);var j=h.height()*h.width(),tt=h.width()*((C.getPoint().y()-h.minY()+(U.getPoint().y()-h.minY()))*.5);return tt<j*.5?C.getPoint().y()>U.getPoint().y()?new e(h.minX()-y,h.minY()-y):new e(h.maxX()+y,h.minY()-y):C.getPoint().y()<U.getPoint().y()?new e(h.minX()-y,h.maxY()+y):new e(h.maxX()+y,h.maxY()+y)}if(U.getState()===o.POINT){if(M.getState()===o.POINT)return new e(h.maxX()+y,h.minY()-y);if(B.getState()===o.POINT)return new e(h.maxX()+y,h.maxY()+y)}var j=h.height()*h.width(),mt=h.height()*((M.getPoint().x()-h.minX()+(B.getPoint().x()-h.minX()))*.5);return mt<j*.5?M.getPoint().x()>B.getPoint().x()?new e(h.minX()-y,h.minY()-y):new e(h.minX()-y,h.maxY()+y):M.getPoint().x()<B.getPoint().x()?new e(h.maxX()+y,h.minY()-y):new e(h.maxX()+y,h.maxY()+y)}if(C.getState()===o.POINT){if(M.getState()===o.POINT)return new e(h.maxX()+y,h.maxY()+y);if(B.getState()===o.POINT)return new e(h.maxX()+y,h.minY()-y);var j=h.height()*h.width(),tt=h.width()*((C.getPoint().y()-h.minY()+(U.getPoint().y()-h.minY()))*.5);return tt<j*.5?C.getPoint().y()>U.getPoint().y()?new e(h.maxX()+y,h.maxY()+y):new e(h.minX()-y,h.maxY()+y):C.getPoint().y()<U.getPoint().y()?new e(h.maxX()+y,h.minY()-y):new e(h.minX()-y,h.minY()-y)}if(U.getState()===o.POINT){if(M.getState()===o.POINT)return new e(h.minX()-y,h.maxY()+y);if(B.getState()===o.POINT)return new e(h.minX()-y,h.minY()-y)}var j=h.height()*h.width(),mt=h.height()*((M.getPoint().x()-h.minX()+(B.getPoint().x()-h.minX()))*.5);return mt<j*.5?M.getPoint().x()>B.getPoint().x()?new e(h.maxX()+y,h.maxY()+y):new e(h.maxX()+y,h.minY()-y):M.getPoint().x()<B.getPoint().x()?new e(h.minX()-y,h.maxY()+y):new e(h.minX()-y,h.minY()-y)}}ee.DEFAULT_MAX_ROUTING_ITERATIONS=100;ee.DEFAULT_MAX_MARCHING_ITERATIONS=20;ee.DEFAULT_PIXEL_GROUP=4;ee.DEFAULT_EDGE_R0=10;ee.DEFAULT_EDGE_R1=20;ee.DEFAULT_NODE_R0=15;ee.DEFAULT_NODE_R1=50;ee.DEFAULT_MORPH_BUFFER=ee.DEFAULT_NODE_R0;ee.DEFAULT_SKIP=8;ee.linePtSegDistSq=function(t,e,n,r,i,o){var u=t,l=e,v=n-u,f=r-l,d=i-u,m=o-l,_=d*v+m*f,k;_<=0?k=0:(d=v-d,m=f-m,_=d*v+m*f,_<=0?k=0:k=_*_/(v*v+f*f));var R=d*d+m*m-k;return R<0&&(R=0),R};ee.addPadding=function(t,e){return t.map(function(n){return{x:n.x-e,y:n.y-e,width:n.width+2*e,height:n.height+2*e}})};function Yr(t){var e=this,n=[],r=!0;this.closed=function(i){if(!arguments.length)return r;r=i},this.addAll=function(i){i.forEach(function(o){e.add(o)})},this.add=function(i){var o=i[0],u=i[1];(Number.isNaN(o)||Number.isNaN(u))&&console.warn("Point with NaN",o,u),n.push([o,u])},this.size=function(){return n.length},this.get=function(i){var o=e.size(),u=e.closed();return i<0?u?e.get(i+o):e.get(0):i>=o?u?e.get(i-o):e.get(o-1):n[i]},this.forEach=function(i){n.forEach(function(o,u){i(o,u,e)})},this.isEmpty=function(){return!e.size()},this.transform=function(i){var o=e;return i.forEach(function(u){o=u.apply(o)}),o},arguments.length&&t&&e.addAll(t)}Yr.prototype.toString=function(){var t=this,e="";return t.forEach(function(n){e.length?e+=" L"+n[0]+" "+n[1]:e+="M"+n[0]+" "+n[1]}),e.length?(t.closed()&&(e+=" Z"),e):"M0 0"};function Os(t){var e=this,n=0,r=0;this.tolerance=function(o){if(!arguments.length)return n;n=o,r=n*n},this.isDisabled=function(){return n<0};function i(o,u){var l=this,v=u,f=u+1;this.advanceEnd=function(){f+=1},this.decreaseEnd=function(){f-=1},this.end=function(){return f},this.validEnd=function(){return o.closed()?f<o.size():f<o.size()-1},this.endPoint=function(){return o.get(f)},this.startPoint=function(){return o.get(v)},this.lineDstSqr=function(d){var m=o.get(d),_=l.startPoint(),k=l.endPoint();return ee.linePtSegDistSq(_[0],_[1],k[0],k[1],m[0],m[1])},this.canTakeNext=function(){if(!l.validEnd())return!1;var d=!0;l.advanceEnd();for(var m=v+1;m<f;m+=1)if(l.lineDstSqr(m)>r){d=!1;break}return l.decreaseEnd(),d}}this.apply=function(o){if(e.isDisabled()||o.size()<3)return o;for(var u=[],l=0;l<o.size();){for(var v=new i(o,l);v.canTakeNext();)v.advanceEnd();l=v.end(),u.push(v)}return new Yr(u.map(function(f){return f.startPoint()}))},arguments.length&&e.tolerance(t)}function ip(){var t=3,e=t-1,n=1,r=n-t,i=this,o=6;this.granularity=function(f){if(!arguments.length)return o;o=f};function u(f,d){switch(f){case-2:return(((-d+3)*d-3)*d+1)/6;case-1:return((3*d-6)*d*d+4)/6;case 0:return(((-3*d+3)*d+3)*d+1)/6;case 1:return d*d*d/6;default:console.warn("internal error!")}}function l(f,d){return f+d}function v(f,d,m){for(var _=0,k=0,R=r;R<=n;R+=1){var A=f.get(l(d,R)),J=u(R,m);_+=J*A[0],k+=J*A[1]}return[_,k]}this.apply=function(f){if(f.size()<3)return f;var d=new Yr,m=f.size()+t-1,_=i.granularity(),k=f.closed();d.add(v(f,e-(k?0:2),0));for(var R=e-(k?0:2);R<m+(k?0:2);R+=1)for(var A=1;A<=_;A+=1)d.add(v(f,R,A/_));return d}}const Ys=(t,e=[],n=0)=>{const i=new ee().createOutline(ee.addPadding(t,n),ee.addPadding(e,n),null);return new Yr(i).transform([new Os(0),new ip,new Os(0)])},sp=()=>{const t=[],e=[],n={},r=m=>{const _=t.length,k=t.filter(R=>R.includes(m)).length;return Math.log(_/(1+k))},i=()=>{[...new Set(t.flat())].forEach(_=>{n[_]=r(_)})},o=(m,_)=>_.filter(R=>R===m).length/_.length,u=()=>{i()},d={documents:m=>(t.push(...m),u(),d),documentsToAnnotate:m=>(e.length=0,e.push(...m),d),annotate:()=>{const m=e.flat(),_=[...new Set(m)],k={};_.forEach(nt=>{k[nt]=o(nt,m)*n[nt]});const A=e.map(nt=>{const H=nt.reduce((F,V)=>F+k[V],0);return{doc:nt,score:H}}).sort((nt,H)=>H.score-nt.score)[0],ft=[...new Set(A.doc)].sort((nt,H)=>k[H]-k[nt]).filter(nt=>nt!==",").slice(0,8);return A.doc.filter(nt=>ft.includes(nt))}};return d},op=["width","height","fill","stroke","stroke-width"],up=["transform"],lp=["fill"],cp=["transform"],fp=Le({__name:"VClusterMinimap",props:{canvasWidth:{type:Number,default:100},canvasHeight:{type:Number,default:100},canvasBorderColor:{type:String,default:"#e5e5e5"},canvasBorderWidth:{type:Number,default:1},canvasBackground:{type:String,default:"#e5e5e535"},canvasPadding:{type:Number,default:10},nodes:{type:Array,required:!0},clusters:{type:Object,required:!0}},setup(t){const e=t,{canvasWidth:n,canvasHeight:r,canvasPadding:i}=e,{nodes:o,clusters:u}=Rn(e),l=Xt(()=>{const m=new Set;return o.value.forEach(_=>{m.add(u.value[_.id])}),m.size}),v=Xt(()=>fn([0,1],[i,n-i])),f=Xt(()=>fn([0,1],[r-i,i])),d=wo(_g);return(m,_)=>(it(),ct("g",null,[P("rect",{width:et(n),height:et(r),fill:t.canvasBackground,stroke:t.canvasBorderColor,"stroke-width":t.canvasBorderWidth},null,8,op),P("g",null,[(it(!0),ct(ge,null,pe(et(o),(k,R)=>(it(),ct("g",{key:R,transform:`translate(${v.value(k.x)}, ${f.value(k.y)})`},[P("circle",{r:2,"fill-opacity":.5,fill:et(d)(et(u)[k.id])},null,8,lp)],8,up))),128))]),P("text",{transform:`translate(${et(i)/2}, ${et(r)-et(i)/2})`,"font-size":10},be(l.value+" clusters"),9,cp)]))}}),hp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAA5CAYAAADKriAvAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEnSURBVHgB7ZcxqsJAEIZnH4HH44mFFlpYRLCyEKxsY+MBxM5GD2CnpxBB8AA2YuUBxEZLLW1sLExhYyPiBdaJIIjJTrISiJj5YAnMPzsT+GfJBoBhGIZhGCYoQiVIKU18tECfoRDiAu+ATS35HqZf7R+IgEiaGkETT+crLDY7V7xuleH/7xd00Go6ma9d8VqlqN00Rp7iiB8gXJZYU6Wt8Ay3HU9NCBfTT4uPp0I+GdAbze5HQ4WXlkkllfmlQg66zdpzyPG0arwWpZoGfRE/LT6eRj9IlD/b/REG04Ur3u80yGF60dyDRG3OppPKotQ+L+L1Ec8rNAvXGPSp4rKpBAON9UzA+SI3Etiqmg8++46UwCuJ7pRqw/feMKA8df5HbGAYhvlqbjXHwSiHcNLFAAAAAElFTkSuQmCC",dp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAA5CAYAAADKriAvAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACcSURBVHgB7dQ9CsJAEIbhb42NkAVPEVtBD+BRvIleQzyMegNb7bzBQgorWWMhiOSfhITkfZpdmFm+YpaRAAAAAAyH+V689/PkWKp5V2OMS60koVvfjs1/1kQd6CR0mlV4xbGet7uqmi0iBdaqVqg7XfTY7VVVdDwoXK9ye8Yz0359pMCGhbNJf2fLN7Mc2vA7089SPqt5TgAAYBjeZYDJFYpqQ2UAAAAASUVORK5CYII=",vp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhCAYAAAC803lsAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJqSURBVHgB7ZbBaxNBFMZfwoqYQilowUPFREEhXiwoFA82onjwpJCbh8bcPEj8C0y9eVMo6M029x5yakEQ21sPheChAYVq1B7UKlYhsdrD+n3jbBiWtN3Z3Wwu/eAxO5uZ3V/mfW92RA6UkFzXHUE8lkEKABXED4QrgxDeW0A0XEOSpPC+LOKV20OShLQPql4a2n+33fbOdrIgeEfJA6CWPq655cWn7tf2z1AgjliKPkBTRbCV5rcNmX+7Is3vGxJFgUHoAw1QYn+z80sBLH9qShzaF4Q+QFNB3EeMdHb+yMK7hiy+b0gb13HJ2QfiJhpuSln2Vz+vS21tWa1G3HJ2AShIH3wQGESngQBMgzAN829WZAFpCCtWV4Bh9ZQxwQMgjAII44MLx0/LkHM48PjJE3nJHxvLOToNs6J9wDQ8e/0itA/oIxsBQrVpD8DT5m8ADOBTZaaGaWGZZtlXJYpQYBYKkprVL+vdlN89f53pyXXNmkqlngCmjstpxNSNU+NyEQ+13bSmzk3KaGbYvHXHP+Tey+cFv/fSZgcwLUQJlznEEh9I4pmrZckfHZMwwvPmzMCtD73GpXeZTKAr+t+0CPTgUlFBjR4Zln4ovdeP+l9wdR4itlhqM9fKUjw7IUOHgpdoZBADaBrNOKLGfvHMhDy6fFvtAYmCaBjTPy3TP3GkKzCID4gwXf8wXVH9Y30wMoDmdLlz/6kyTSz3TEjvWK+ID2ZL+4crVMtEMHAkEAPI888tREtCKBYQT4Cpm/6xmWtzZi2JnVjqlR7zTkoUEPl/VFDnFEvN+m90epxxrKuGH8F+KFaPRNE/PCZU0kfWB3cAAAAASUVORK5CYII=",gp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAoCAYAAACFFRgXAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQ3SURBVHgB7Vi9T1NRFD81JsZADDExmshQqC4m8rH4wdK3SHQwfKxqlMTBTQad5R8gwbgwSkAmI2waHCiDgC4KJiwC7YCJxESrwRin5/m9vlvOPe/2taUtYeCX3LT39t17f+/c3/m4JTrEISwkqnnY9/0kf3Rxa6HakeOWTyQSn6ieYJIt3J5wy/qNQZbbQ6oHYFG/cURdxJPlOCXiyPLHPLck7R/y3LpZJrlSD8QRzpIi++fvP9r4+p2+/fhNteLMyROUOnuKmo4f0z/lmHBbqXlHXYNM9h4psjOZjzT5ZjkgXS+cZtID6W4a8LrlMGQ4zKTHXHOOlFirT3bm3q/R+MxCXckC23xSWBfGiNtfIkKY3w4hq1+OTbFlGwnH+l7IIwKXJLpkB1bYFpp9MJgOjrFWrK5v0eNnL4PvO3xym+wb7axpARjtuZ7nkoRl3ZUvW9aPvZcuUD3QrhxO70PKcAYuwmnZWfq8Ufzeca7V5dV7QjOvkxIWXRT7hHDq2JJEqBvrzVbWd98chOMw/mohCHsGj271BpGgFHoupgJpAJAEnFoYBNEiqWOytrAnO2YRg87zEcJDvCBieQYdkAUB0wTawueG5KBcbyeM8XF8XIStY9C6clg4Q9VhVnYq0HFaD2jClhwWlX4VkEapkvxP4fFSocqzqrNOsa46FaBfDxQ17O+WjkXII4LeFLB5lirDfKkfYAhjGBBWOm7ROpYW9uRCZrJBqnXXozFu4rNsGq5ndLbs6bAN4dCxZWUZJSy9SD0hBElJvFvdoNHpOSoHkxgkrnEcR/QwQBSBRc2LLPLaSn4et2JdEWthg3LhrFZIua2sxzteQJh1Au0mzSBCjCSsj63ekAbRoZQKOvZMx0jCcrZNpaOUneMDPd++foU03n5Ys7SMmkNnRukLBjDI6PRuH5LrvWyVAOCXkYSt+AsdGUBj7Zow9/VLADgVizDXuXGZzgA+gufM3M2o44HfmCTs6Y0NHPrNcZtQY3cp/ir1lMK4rUgUTxY6nlko1MUIc6gKBbpQNnB4yx8N9VusPXWKdKTjCZ44Igd4jXQZwmO6JuA5eUkYhjGETQgUp2NqnAws7MmFVsun45bwCmWNUTz6eM6vuDkdyjAIq0rHHoWEbf2KdAztOjS4l/8Qxso9YGK9kSM+FeFAIyBcMkK4HCsOI/dvBpIyqMThJLCfIbwUrY8DnojD1tFI/VabMJpCbzetWsj9dqIX3oAnLJwnQVqmyVk4QVX/vtWGWXF7bi5xswFhlHueGRjkYD8Z3mJh7dEX5WuGRuBqtDoMylJIYkGO9lcY7BsJ7H/nRiSTBjwT4T0Oda0Vi6deLwcOgL+lmut08awEiAyulE6Fa1Yu+Ia/hvyDjZHIm2HQP5gYKXkcfsHSWf9g4Ce3Yc0x4SCdpELUMAUNtJ2n/UOOCg6G+mM/920M/gP9vGvSi2rGrgAAAABJRU5ErkJggg==",pp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAxCAYAAAChzEtEAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAPJSURBVHgB7ZlNTBNBFMdfscFIaGhCYlIu9ITxBIp3ljsoHo0H8ILeJMZ74exH9Ga8oAc/jga8t97B6JEmpiWakpggJSU0ISHr/Jed7ZuPLoHu1sbsL9lsd3Z29u2b/7x5MyVKSEhISEj4n0mdpbLruo44TYhjnKKhLo7v4iilUqkqRQUMFUfRjZdVceSpU0QjBbd7VMQxQeely8ZK9sKMToUYmxenil5+sLFJe8USHR8cUKdczOVo+OYM9Y+M6Le+CU1fsz0TZvCqOC3I6+NGg348euwZHDW5B4uUu7+oF98WRn/SC/tC2lngFz+fPI/FWLDz6jXtrn2msPdL0rZC9yR8BRzVavRnfT24vpDJ0KUrY9Qpza2y13NgV7QPeTCmbM+k27Q1xy8aG1+Vm1c/vrPp7szAq9uFZe83eg/Gwxk+WThOyKLEn2knCWViqJdazwzemIzEWM+iadWJ9eIXvYoRLQyDxVdlxcnhZeg6ycBY51KQwJv845tbW3qVW3qBzcMOv4Cx0LAkO+1QlGSdlpfrJdPDvgMDbAYrX9XQIgMkESW8PTiGO0cAYxVZ2AxWKjQ2N62NR0VGa9OiYyUAKFHCn90Ug3nszTqO1njJ1o1tGZ6dMQyEjuEI+Z5muaw/Nt7WYNL0K0ONZECLvfvCGzw+n0Zm0t5DGMjSYDhhdKWg2AQdi/CGVNSQhBJnuH6lJ+JgiA1kOIhHJZ+gQl+7G4Drt513ogA9xyYMY6BzuwJJ+Cldntfi+rV5t38kdyavo74NOdUHshAT1eW7d3gVRK4lxWAKGWwgYzHMy7IoGjCgg4FnSiIvdcwlocRfiF+C2SiKZCcM3j50bJGFF964wQ6/e1iOZzpuB3qQ69iSynoBwZOEr99gCsQX8geGzOm46h+dorwX42Hf71kMeE1uDlFLww6/0zD0e5007ulp33kQjnohTg+D90y2DJa5MvM6dJyXBmv6bc1e0K8lnZwXD89T5+T5BdLNX0+feb9h7KEwWhvsc9JgJUI0y600L2MPWwsUA3AMPCpnV3hbe/94n58/KPrlYWXImaJuwvOVQzOvcIxsjecOgI/cbsAnl6PajnHfWNPBQN4t24WV2HIIG/tK/DempWoam3BCFsiEPFnAWKSBv99/8Gp4K+a1Gv0Lhmdn9aKqlMRLXoopN+6Z7TSwsaIt+8Fbb+fHXzdhW0pZP2EZzjO2bpAeHPTWjRYZYkt2OrgSRi+5vUvFtW3FisJlt/eouGFbsO7J5nXF7Q2KrubZsN1Lh05yjFHqPvgb4Y1cxyUkhPAX/Y+D3XkYsqYAAAAASUVORK5CYII=",mp="/prompthis/assets/diff_frequency-d3a6fd89.svg",yp="/prompthis/assets/diff_weight-3c558357.svg",oe=t=>(pf("data-v-838821d9"),t=t(),mf(),t),_p={class:"ivg-container"},bp=oe(()=>P("div",{class:"ivg-shadow",style:{position:"absolute",left:"-1000px",top:"-1000px"}},null,-1)),xp=["viewBox"],wp=oe(()=>P("defs",null,[P("marker",{id:"arrow",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto"},[P("path",{d:"M0,0 L0,6 L9,3 z",fill:"black"})]),P("filter",{id:"shadow",x:"-20%",y:"-20%",width:"140%",height:"140%"},[P("feDropShadow",{dx:"4",dy:"4",stdDeviation:"4","flood-color":"rgba(0,0,0,0.4)"})])],-1)),kp=["width","height"],Ap={key:0,class:"ivg-cluster-bubble-layer no-transition"},Mp=["id"],$p=["d","fill","fill-opacity"],Ip={class:"ivg-bubble-layer no-transition"},Ep=["onMouseenter"],Tp=["d","stroke","stroke-width","stroke-opacity","stroke-dasharray","fill","fill-opacity"],Sp={key:1,class:"ivg-edge-layer no-transition",ref:"edgeLayer"},Np=["id"],Cp=["id"],Rp=["d","fill","fill-opacity"],Pp={class:"ivg-image-layer"},Op=["transform","id","onMouseenter"],Yp=["width","height","x","y","fill"],Fp=["width","height","x","y","fill"],Xp=["onClick","width","x","y","xlink:href"],Dp={key:3,class:"ivg-image-button",style:{cursor:"pointer"}},zp=["onClick"],Lp=["width","x"],Gp=oe(()=>P("text",{y:-12,"text-anchor":"middle","alignment-baseline":"middle","font-size":"10",fill:"white"},"Full",-1)),Hp=["onClick"],Up=["width","x"],qp=oe(()=>P("text",{y:12,"text-anchor":"middle","alignment-baseline":"middle","font-size":"10",fill:"white"},"Copy",-1)),Vp=["width","height","x","y","fill"],Bp=["xlink:href"],Wp={key:2,class:"ivg-cluster-annotation-layer no-transition"},Qp=["id"],Zp=["x","y","width","height"],jp=["innerHTML"],Jp={key:3,class:"ivg-word-layer no-transition",ref:"wordLayer"},Kp=["id","transform","onMousedown","onMousemove","onMouseup"],tm={class:"ivg-word-glyph"},em=["d","fill","stroke","fill-opacity","stroke-opacity"],nm=["transform"],rm=["xlink:href"],am=["stroke","onMouseenter"],im={class:"legend px-2 flex justify-between items-strech"},sm={class:"legend-node py-1 space-y-1"},om={class:"px-1 flex justify-between items-center"},um=oe(()=>P("div",{class:"legend-text font-bold"},"Generated image (node)",-1)),lm={class:"px-1 flex space-x-2"},cm=oe(()=>P("div",{class:"legend-text"},"Steps:",-1)),fm={class:"legend-color-scale flex flex-auto items-center space-x-2"},hm=oe(()=>P("div",{class:"legend-text"},"1",-1)),dm=oe(()=>P("div",{class:"gradient-bar flex-1"},null,-1)),vm={class:"legend-text"},gm={class:"legend-bubble-container px-1 flex items-center space-x-2"},pm=oe(()=>P("div",{class:"legend-bubble flex"},[P("div",{class:"bubble-rect legend-bubble-prompt"})],-1)),mm=oe(()=>P("div",{class:"legend-text"},"Images generated by same prompt",-1)),ym={class:"button-group"},_m={class:"legend-bubble-container px-1 flex items-center space-x-2"},bm=oe(()=>P("div",{class:"legend-bubble flex"},[P("div",{class:"bubble-rect legend-bubble-group"})],-1)),xm=oe(()=>P("div",{class:"legend-text"},"Images grouped by",-1)),wm={class:"button-group"},km={class:"legend-edge flex flex-col py-1"},Am={class:"px-1 mb-1 flex justify-between items-center"},Mm=oe(()=>P("div",{class:"legend-text font-bold"},"Prompt difference (edge)",-1)),$m={class:"flex-1 flex space-x-2 px-1"},Im={class:"flex flex-col justify-between"},Em=oe(()=>P("div",{class:"legend-edge-direction flex space-x-1 items-center"},[P("div",{class:"legend-text"},"Old"),P("div",{class:"triangle"}),P("div",{class:"legend-text"},"New")],-1)),Tm={class:"legend-edge-frequency flex space-x-1 items-center"},Sm=["src"],Nm=oe(()=>P("div",{class:"legend-text"},"Diff frequency",-1)),Cm={class:"legend-edge-weight flex space-x-1 items-center"},Rm=["src"],Pm=oe(()=>P("div",{class:"legend-text"},"Diff weight",-1)),Om={class:"flex flex-col justify-between"},Ym={class:"legend-glyph-row flex px-1 space-x-1 justify-end"},Fm={class:"legend-glyph flex space-x-0.5 items-center"},Xm=["src"],Dm=oe(()=>P("div",{class:"legend-text"},"Reorder",-1)),zm={class:"legend-glyph-row flex px-1 space-x-1 justify-end"},Lm={class:"legend-glyph flex space-x-0.5 items-center"},Gm=["src"],Hm=oe(()=>P("div",{class:"legend-text"},"Insert",-1)),Um={class:"legend-glyph flex space-x-0.5 items-center"},qm=["src"],Vm=oe(()=>P("div",{class:"legend-text"},"Increase weight",-1)),Bm={class:"legend-glyph-row flex px-1 space-x-1 justify-end"},Wm={class:"legend-glyph flex space-x-0.5 items-center"},Qm=["src"],Zm=oe(()=>P("div",{class:"legend-text"},"Remove",-1)),jm={class:"legend-glyph flex space-x-0.5 items-center"},Jm=["src"],Km=oe(()=>P("div",{class:"legend-text"},"Reduce weight",-1)),t1={class:"tooltip-image flex-shrink-0"},e1=["src"],n1={class:"tooltip-prompt"},r1=Le({__name:"IVG",props:{canvasWidth:{type:Number,required:!0},canvasHeight:{type:Number,required:!0},marginLeft:{type:Number,default:50},marginRight:{type:Number,default:50},marginBottom:{type:Number,default:110},marginTop:{type:Number,default:50},minEdgeWeight:{type:Number,default:.4},idealEdgeGroupRange:{type:Array,default:()=>[6,12]},records:{type:Array,required:!0},images:{type:Object,required:!0},projection:{type:Object,required:!0},clusters:{type:Object,required:!0},edges:{type:Array,required:!0},edgeGroups:{type:Object,required:!0},stages:{type:Array,default:null},bubbleStrokeWidth:{type:Number,default:.5},bubbleStrokeOpacity:{type:Number,default:.7},bubbleStrokeDasharray:{type:String,default:"2,2"},bubbleFillOpacity:{type:Number,default:0},edgeFill:{type:String,default:"gray"},edgeFillOpacity:{type:Number,default:.2},colorScheme:{default:["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},colorFocus:{default:"#fef08a"},colorBrushed:{default:"white"},miniMapWidth:{type:Number,default:100},miniMapHeight:{type:Number,default:100},hovered:{type:Object,default:null}},emits:["update-weight-thresh","update-max-weight","hover-image","unhover-image","click-image","open-image","copy-prompt"],setup(t,{emit:e}){const n={i:hp,r:dp,m:vp,iw:gp,rw:pp},r=t,{idealEdgeGroupRange:i,colorScheme:o}=r,{canvasWidth:u,canvasHeight:l,marginLeft:v,marginRight:f,marginBottom:d,marginTop:m,minEdgeWeight:_,records:k,images:R,projection:A,clusters:J,edges:D,edgeGroups:ft,stages:nt,hovered:H}=Rn(r),F=X=>`ivg-image-${X.replace("(","-").replace(")","")}`,V=Xt(()=>{const X=new Map,N=new Map,T=[];return k.value.forEach((K,G)=>{const{outputFilenames:xt,width:Et,height:Tt}=K,re=[];xt.forEach(ne=>{const It=ne.substring(0,ne.lastIndexOf("."));X.set(It,T.length),re.push(T.length);const Rt=R.value[ne],{x:Ut,y:xe}=A.value[It];T.push({id:It,x:Ut,y:xe,data:Rt,promptId:G,width:Et,height:Tt})}),N.set(G,re)}),{nodes:T,nodeId2Index:X,record2nodeIndices:N}}),st=Xt(()=>V.value.nodes),$t=Xt(()=>V.value.record2nodeIndices),wt=Vt(),Mt=Vt();Te(st,(X,N)=>{if(X.length===N.length||wt.value===null)return;if(N.length===0){Kt(wt.value).attr("opacity",0).transition().duration(1e3).attr("opacity",1);return}Mt.value.innerHTML=wt.value.innerHTML,Kt(wt.value).attr("visibility","hidden"),Kt(Mt.value).attr("opacity",1).attr("visibility","visible"),Kt(Mt.value).selectAll(".no-transition").attr("opacity",1).transition().duration(1e3).attr("opacity",0).attr("visibility","hidden");const T=Kt(Mt.value);N.forEach((K,G)=>{T.select("#"+F(K.id)).transition().duration(1e3).attr("transform",`translate(${St.value(X[G].x)}, ${h.value(X[G].y)})`)}),setTimeout(()=>{X.filter((K,G)=>G>=N.length).forEach(K=>{T.append("g").attr("transform",`translate(${St.value(K.x)}, ${h.value(K.y)})`).append("image").attr("width",ut.value).attr("x",-ut.value/2).attr("y",-ut.value/2).attr("xlink:href","data:image/png;base64,"+K.data).attr("opacity",0).transition().duration(1e3).attr("opacity",1)})},1e3),setTimeout(()=>{Kt(".main-ivg").attr("opacity",0).attr("visibility","visible").transition().duration(1e3).attr("opacity",1),Kt(Mt.value).attr("opacity",1).transition().duration(1e3).attr("opacity",0),setTimeout(()=>{Kt(Mt.value).attr("visibility","hidden")},1e3)},2e3)});const q=Xt(()=>V.value.nodeId2Index),vt=Xt(()=>D.value.map((N,T)=>({...N,id:T,src:q.value.get(N.src),tgt:q.value.get(N.tgt)}))),at=Xt(()=>ft.value.map(X=>{const N=X.edges.map(It=>vt.value[It]),T=N.map(It=>{const Rt=st.value[It.src],Ut=st.value[It.tgt],xe=(Rt.x+Ut.x)/2,Ie=(Rt.y+Ut.y)/2,vn=It.weight/X.weight;return{x:xe,y:Ie,weight:vn}}),K=is(T,It=>It.x*It.weight),G=is(T,It=>It.y*It.weight),xt=N.map(It=>{const Rt=st.value[It.src],Ut=st.value[It.tgt];return[q.value.get(Rt.id),q.value.get(Ut.id)]}),Et=[];xt.forEach(([It,Rt])=>{vt.value.forEach(Ut=>{if(Ut.src===It&&Ut.tgt===Rt){const xe=Ut.changes.map(Ie=>({...Ie,weight:Ut.weight/Ut.changes.length}));Et.push(...xe)}})});const Tt=new Map;Et.forEach(It=>{const Rt=It.action+"-"+It.word;if(Tt.has(Rt)){const Ut=Tt.get(Rt);Tt.set(Rt,{...Ut,frequency:Ut.frequency+1,weight:Ut.weight+It.weight})}else Tt.set(Rt,{action:It.action,word:It.word,frequency:1,weight:It.weight,included:!1})}),Tt.forEach((It,Rt,Ut)=>{Ut.set(Rt,{...It,frequency:It.frequency/Et.length})});const re=[];N.forEach(It=>{const Rt=It.changes.map(Ut=>({...Ut,weight:It.weight/It.changes.length}));re.push(...Rt)}),re.forEach(It=>{const Rt=It.action+"-"+It.word;Tt.has(Rt)&&Tt.set(Rt,{...Tt.get(Rt),included:!0})});const ne=Array.from(Tt.values()).sort((It,Rt)=>It.included&&!Rt.included||It.included&&Rt.included&&It.action==="i"&&Rt.action==="r"?-1:1);return{...X,changes:ne,baryCenter:{x:K,y:G}}})),x=Xt(()=>at.value.filter(X=>X.changes.filter(K=>K.included&&K.weight>=_.value).length>0).map(X=>{const N=X.edges.map(G=>({...vt.value[G]})),T={};N.forEach(G=>{const xt=G.src_pmt+"-"+G.tgt_pmt;T[xt]?T[xt].push(G):T[xt]=[G]});for(const G in T){const xt=T[G];let Et=!1;for(const Tt of xt)if(C.value[Tt.src]&&C.value[Tt.tgt]){Tt.display=!0,Et=!0;break}else if(C.value[Tt.src]||C.value[Tt.tgt]){Tt.display=!0,Et=!0;break}else Tt.display=!1;Et||(xt[0].display=!0)}let K=N.filter(G=>G.display);return{...X,edges:K}})),z=X=>X.included&&X.weight&&X.weight>=_.value,O=(X,N)=>{let T=i[0],K=i[1];if(at.value.length===0)return 0;at.value.length<i[0]&&(T=1);let G=(X+N)/2;for(;X+1e-6<N;){const xt=at.value.filter(Et=>Et.changes.filter(ne=>ne.weight>=G).length>0).length;if(xt<T)N=G;else if(xt>K)X=G;else break;G=(X+N)/2}return G},Q=e,ot=Vt(2),ht=Vt(1),ut=Xt(()=>{if(!u.value)return 50;const X=40,N=80;let T=u.value/20;return T=Math.max(T,X),T=Math.min(T,N),T*ht.value}),_t=Xt(()=>{if(!u.value)return 10;const X=8,N=12;let T=ut.value/5;return T=Math.max(T,X),T=Math.min(T,N),T*ht.value}),rt=Xt(()=>{let X=.5;at.value.forEach(T=>{T.changes.forEach(K=>{K.weight&&K.weight>X&&(X=K.weight)})});const N=O(0,X);return Q("update-weight-thresh",N),Q("update-max-weight",X),[0,X]}),dt=Vt({x:0,y:0,k:1}),St=Xt(()=>{const X=fn([0,1],[v.value,u.value-f.value]);return dt.value.rescaleX?dt.value.rescaleX(X):X}),h=Xt(()=>{const X=fn([0,1],[l.value-d.value,m.value]);return dt.value.rescaleY?dt.value.rescaleY(X):X}),y=Xt(()=>fn(rt.value,[5,12])),E=Xt(()=>Us.scale(o).mode("lab").domain([0,k.value.length-1])),S=Xt(()=>new ap().xScale(St.value).yScale(h.value)),M=Xt(()=>sp().documents(k.value.map(X=>X.promptTokens||[]))),C=Xt(()=>{const X=np(st.value,vt.value,at.value),N=st.value.map(K=>({x:St.value(K.x)-ut.value/2,y:h.value(K.y)-ut.value/2,width:ut.value,height:ut.value})),T=st.value.map(()=>!1);for(let K=0,G=X.length;K<G;++K){let xt=!0;for(let Et=0;Et<K;++Et)T[Et]&&Rs(N[K],N[Et])&&(xt=!1);xt&&(T[K]=!0)}return T}),B=X=>S.value.nodes(...X).map(N=>{const T=q.value.get(N.id),G=C.value[T]?ut.value:_t.value,xt=G/N.width*N.height,Et=N.x-G/2,Tt=N.y-xt/2;return{x:Et,y:Tt,width:G,height:xt}}),U=Xt(()=>N=>{const K=$t.value.get(N).map(xt=>st.value[xt]),G=B(K);return{promptId:N,rects:G}}),tt=Xt(()=>N=>{const K=st.value.filter(xt=>J.value[xt.id]===N).map(xt=>q.value.get(xt.id)).map(xt=>st.value[xt]),G=B(K);return{clusterId:N,rects:G}}),j=Xt(()=>{if(k.value.length===0)return[];const X=[];return k.value.forEach((T,K)=>{const G=T.outputFilenames.map(Et=>{const Tt=Et.substring(0,Et.lastIndexOf("."));return J.value[Tt]});Array.from(new Set(G)).length>1&&X.push(K)}),ie.value&&!X.includes(ie.value)&&X.push(ie.value),X.map(T=>U.value(T))}),mt=Xt(()=>{if(kt.value===null)return[];if(kt.value==="cluster"){const N=Array.from(new Set(Object.values(J.value))).map(T=>{const K=tt.value(T),G=Array.from(new Set(st.value.filter(Tt=>J.value[Tt.id]===T).map(Tt=>Tt.promptId))).map(Tt=>k.value[Tt].promptTokens||[]),Et={words:M.value.documentsToAnnotate(G).annotate(),position:{x:-100,y:-100,w:0,h:0},html:""};return{id:T,bubble:K,annotation:Et}});return ln(()=>{bt()}),N}else if(kt.value==="stage"){const X=nt.value.map((N,T)=>{const K=[];N.forEach(Rt=>{const Ut=$t.value.get(Rt);K.push(...Ut)});const G=K.map(Rt=>st.value[Rt]),xt=B(G),Et={id:T,rects:xt},Tt=N.map(Rt=>k.value[Rt].promptTokens||[]),ne={words:M.value.documentsToAnnotate(Tt).annotate(),position:{x:-100,y:-100,w:0,h:0},html:""};return{id:Math.ceil((N[0]+N[N.length-1])/2),bubble:Et,annotation:ne}});return ln(()=>{bt()}),X}return[]}),yt=Vt([]),bt=()=>{const X=Kt(".ivg-svg").node().getBoundingClientRect(),N=Kt(".ivg-shadow").node(),K=[...mt.value.map(({id:G})=>{const Et=Kt(`#cluster-${G}`).select("path").node().getBoundingClientRect();return{x:Et.x-X.x,y:Et.y-X.y,width:Et.width,height:Et.height}})];yt.value=mt.value.map(({id:G,annotation:xt})=>{const Et=Kt(`#cluster-${G}`).select("path").node(),Tt=nv("div").style("width","200px").style("border","0.5px solid #ddd").style("border-radius","2px").style("padding","0.2rem").style("font-size","0.5rem").style("color","#999").style("background","rgba(255, 255, 255, 0.8)").text(xt.words.join(", ")).node();N.appendChild(Tt);const re=Tt.getBoundingClientRect(),ne=Et.getBoundingClientRect(),It=[{dx:ne.width+1,dy:0},{dx:ne.width+1,dy:ne.height/2},{dx:ne.width/2,dy:ne.height-1},{dx:0,dy:ne.height-1},{dx:-re.width-1,dy:ne.height-re.height},{dx:-re.width-1,dy:ne.height/2},{dx:-re.width-1,dy:0},{dx:0,dy:-re.height-1},{dx:ne.width/2,dy:-re.height-1}];let Rt={x:-100,y:-100,w:0,h:0};for(const xe of It){const Ie={x:ne.x-X.x+xe.dx,y:ne.y-X.y+xe.dy,width:re.width,height:re.height};let vn=!0;for(const gn of K)if(Rs(Ie,gn)){vn=!1;break}if(vn){K.push(Ie),Rt={x:Ie.x,y:Ie.y,w:Ie.width,h:Ie.height};break}}const Ut=Tt.outerHTML;return{...xt,position:Rt,html:Ut}}),Kt(N).selectAll("*").remove()},Nt=Pg().value(X=>X.frequency).sort(null),Ht=X=>Ao().innerRadius(0).outerRadius(y.value(X.data.weight))(X),zt={i:"#466E8F",r:"#CD3033",iw:"#466E8F",rw:"#CD3033",m:"#57B28F"},Ct=Vt(!1),ae={dragStart:function(X,N){Ct.value||(Ct.value=!0,N.startX=X.x,N.startY=X.y,N.offsetX=N.offsetX||St.value(N.baryCenter.x),N.offsetY=N.offsetY||h.value(N.baryCenter.y))},dragging:function(X,N){if(!Ct.value||!N.startX||!N.startY)return;const T=X.x-N.startX,K=X.y-N.startY;N.offsetX+=T,N.offsetY+=K,Kt("#word-glyph-"+N.idx).attr("transform",`translate(${N.offsetX}, ${N.offsetY})`),N.edges.forEach(G=>{Kt(`#edge-${G.id}`).select("path").attr("d",Ps(S.value.node(st.value[G.src]),S.value.node(st.value[G.tgt]),S.value.node({x:N.offsetX,y:N.offsetY},!1)))}),N.startX=X.x,N.startY=X.y},dragEnd:(X,N)=>{Ct.value=!1,delete N.startX,delete N.startY}},jt=Vt(!0),kt=Vt("cluster"),he=Vt(!0),me=Vt(!0),Zt=Vt(null),ue=Vt({}),Ae=Vt(null),ie=Vt(null);Vt(null);const Xe=Vt([]),Se=Xt(()=>{if(!Zt.value||H.value&&H.value.triggerView!=="ivg")return null;const X=q.value.get(Zt.value),N=st.value[X],{data:T,promptId:K}=N,G=k.value[K],{prompt:xt}=G;return{promptId:K,prompt:xt,data:T}}),He=Vt({x:0,y:0}),Pn=(X,N=null)=>{N?Q("hover-image",{imageId:N.id,imageIndex:q.value.get(N.id),promptIndex:N.promptId}):Q("unhover-image",null),Zt.value=(N==null?void 0:N.id)||null,N&&(ie.value=N.promptId,ln(()=>{const K=Kt(".ivg-container").node().getBoundingClientRect(),{x:G,y:xt}=X,Et=G-K.x,Tt=xt-K.y,ne=Kt(".tooltip").node().getBoundingClientRect(),{width:It,height:Rt}=ne,Ut=ut.value,xe=10;Et+It+Ut>K.width?He.value.x=Et-It-Ut:He.value.x=Et+Ut,Tt+Rt+xe>K.height?He.value.y=Tt-Rt-xe:He.value.y=Tt+xe}))},Fr=X=>{const{id:N,promptId:T}=X;Q("click-image",{imageId:N,imageIndex:q.value.get(N),promptIndex:T})},jn=(X=null)=>{ie.value=X},On=(X=null)=>{Ae.value=X,Yn(X)},Yn=X=>{if(ue.value={},Xe.value=[],!X)return;const N=k.value;st.value.forEach(T=>{N[T.promptId].promptTokens.includes(X.text)&&(ue.value[T.id]="white")}),x.value.forEach(T=>{T.edges.forEach(G=>{G.changes.filter(Et=>Et.word===X.text&&(X.action===null||X.action==="k"||Et.action===X.action)).length>0&&Xe.value.push(G.id)})}),Xe.value.forEach(T=>{var Tt;const K=vt.value[T],G=(Tt=K.changes.find(re=>re.word===X.text&&(X.action===null||X.action==="k"||re.action===X.action)))==null?void 0:Tt.action,xt=st.value[K.src].id,Et=st.value[K.tgt].id;G==="r"?(ue.value[xt]="steelblue",ue.value[Et]="rgb(241, 41, 41)"):G==="i"?(ue.value[xt]="rgb(241, 41, 41)",ue.value[Et]="steelblue"):G==="m"?ue.value[Et]="mediumaquamarine":G==="iw"?ue.value[xt]="steelblue":G==="rw"&&(ue.value[xt]="rgb(241, 41, 41)")})};Te(H,(X,N)=>{if(!X){Zt.value=null,Ae.value=null,ie.value=null,ue.value={},Xe.value=[];return}if(X.field==="image"){const T=X,{imageId:K,promptIndex:G}=T.value;Zt.value=K,ie.value=G}else if(X.field==="word"){const T=X;if(Ae.value=T.value,Yn(T.value),N&&N.field==="prompt"){const K=N.value;ie.value=K}}else if(X.field==="prompt"){const T=X;ie.value=T.value}});const Xr=X=>{const N=X.transform;dt.value=N;const{k:T}=N;T>3?ht.value=Math.min(T/3,2):ht.value=1},Jn=Hg().scaleExtent([.8,15]).on("zoom",Xr);return gf(()=>{wt.value!==null&&Kt(wt.value).select("rect.zoom-canvas").call(Jn).call(Jn.transform,Ha)}),(X,N)=>(it(),ct("div",_p,[bp,(it(),ct("svg",{viewBox:`0, 0, ${et(u)}, ${et(l)}`,onMouseup:N[4]||(N[4]=T=>Ct.value=!1),onMouseleave:N[5]||(N[5]=T=>Ct.value=!1),class:"ivg-svg"},[wp,P("g",{class:"main-ivg",ref_key:"ivgMain",ref:wt},[P("rect",{class:"zoom-canvas",width:et(u),height:et(l),fill:"white",opacity:0,onMouseover:N[0]||(N[0]=()=>{Q("unhover-image",null),Zt.value=null,Ae.value=null,ie.value=null,ue.value={},Xe.value=[]})},null,40,kp),kt.value!==null?(it(),ct("g",Ap,[(it(!0),ct(ge,null,pe(mt.value,({id:T,bubble:K},G)=>(it(),ct("g",{class:"ivg-cluster",key:G,id:`cluster-${T}`},[P("path",{d:et(Ys)(K.rects),fill:kt.value==="stage"?E.value(T):"gray","fill-opacity":kt.value==="stage"?.3:.1},null,8,$p)],8,Mp))),128))])):te("",!0),P("g",Ip,[(it(!0),ct(ge,null,pe(j.value,(T,K)=>(it(),ct("g",{class:"ivg-bubble",key:K,onMouseenter:G=>jn(T.promptId),onMouseleave:N[1]||(N[1]=G=>jn())},[jt.value||ie.value===T.promptId?(it(),ct("path",{key:0,d:et(Ys)(T.rects),stroke:T.promptId!==ie.value?E.value(T.promptId):"#f59e0b","stroke-width":T.promptId!==ie.value?t.bubbleStrokeWidth:Math.max(t.bubbleStrokeWidth*2,2),"stroke-opacity":t.bubbleStrokeOpacity,"stroke-dasharray":t.bubbleStrokeDasharray,fill:T.promptId!==ie.value?E.value(T.promptId):t.colorFocus,"fill-opacity":T.promptId!==ie.value?t.bubbleFillOpacity:.5},null,8,Tp)):te("",!0)],40,Ep))),128))]),me.value?(it(),ct("g",Sp,[(it(!0),ct(ge,null,pe(x.value,(T,K)=>(it(),ct("g",{class:"ivg-edge-group",key:K,id:`edge-group-${T.idx}`},[(it(!0),ct(ge,null,pe(T.edges,(G,xt)=>(it(),ct("g",{class:"ivg-edge",key:xt,id:`edge-${G.id}`},[P("path",{d:et(Ps)(S.value.node(st.value[G.src]),S.value.node(st.value[G.tgt]),S.value.node(T.baryCenter)),fill:Xe.value.includes(G.id)?"#fbbf24":t.edgeFill,"fill-opacity":t.edgeFillOpacity},null,8,Rp)],8,Cp))),128))],8,Np))),128))],512)):te("",!0),P("g",Pp,[(it(!0),ct(ge,null,pe(st.value,T=>(it(),ct("g",{class:"ivg-image",key:T.id,transform:"translate("+St.value(T.x)+","+h.value(T.y)+")",id:F(T.id),onMouseenter:K=>Pn(K,T),onMouseleave:N[2]||(N[2]=K=>Pn(X.e))},[Zt.value===T.id||ue.value[T.id]&&C.value[q.value.get(T.id)]?(it(),ct("rect",{key:0,width:ut.value+ot.value*4,height:ut.value/T.width*T.height+ot.value*4,x:-ut.value/2-ot.value*2,y:-ut.value/T.width*T.height/2-ot.value*2,fill:Zt.value===T.id?t.colorFocus:ue.value[T.id]||t.colorBrushed,filter:"url(#shadow)"},null,8,Yp)):te("",!0),C.value[q.value.get(T.id)]||Zt.value===T.id?(it(),ct("rect",{key:1,width:ut.value+ot.value*2,height:ut.value/T.width*T.height+ot.value*2,x:-ut.value/2-ot.value,y:-ut.value/T.width*T.height/2-ot.value,fill:E.value(T.promptId)},null,8,Fp)):te("",!0),C.value[q.value.get(T.id)]||Zt.value===T.id?(it(),ct("image",{key:2,onClick:K=>Fr(T),width:ut.value,x:-ut.value/2,y:-ut.value/T.width*T.height/2,"xlink:href":"data:image/jpeg;base64,"+T.data},null,8,Xp)):te("",!0),Zt.value===T.id&&et(H)&&et(H).triggerView==="ivg"?(it(),ct("g",Dp,[P("g",{onClick:K=>Q("open-image",{data:T.data,filename:T.id})},[P("rect",{class:"ivg-full-button",width:ut.value*2/3,height:20,x:-ut.value/3,y:-22,rx:4,ry:4,"fill-opacity":.7},null,8,Lp),Gp],8,zp),P("g",{onClick:K=>Q("copy-prompt",et(k)[T.promptId].prompt)},[P("rect",{class:"ivg-full-button",width:ut.value*2/3,height:20,x:-ut.value/3,y:2,rx:4,ry:4,"fill-opacity":.7},null,8,Up),qp],8,Hp)])):te("",!0),!C.value[q.value.get(T.id)]&&Zt.value!==T.id?(it(),ct("rect",{key:4,width:_t.value,height:_t.value/T.width*T.height,x:-_t.value/2,y:-_t.value/2,fill:E.value(T.promptId)},null,8,Vp)):te("",!0)],40,Op))),128)),Zt.value?(it(),ct("use",{key:0,"xlink:href":"#"+F(Zt.value)},null,8,Bp)):te("",!0)]),kt.value!==null&&he.value?(it(),ct("g",Wp,[(it(!0),ct(ge,null,pe(yt.value,({id:T,position:K,html:G},xt)=>(it(),ct("g",{class:"ivg-cluster-annotation",key:xt,id:`cluster-annotation-${T}`},[(it(),ct("foreignObject",{x:K.x,y:K.y,width:K.w,height:K.h},[P("div",{innerHTML:G},null,8,jp)],8,Zp))],8,Qp))),128))])):te("",!0),me.value?(it(),ct("g",Jp,[(it(!0),ct(ge,null,pe(x.value,(T,K)=>(it(),ct("g",{class:"ivg-word",key:K,id:`word-glyph-${T.idx}`,transform:"translate("+St.value(T.baryCenter.x)+","+h.value(T.baryCenter.y)+")",style:{cursor:"pointer"},onMousedown:G=>ae.dragStart(G,T),onMousemove:G=>ae.dragging(G,T),onMouseup:G=>ae.dragEnd(G,T)},[P("g",tm,[(it(!0),ct(ge,null,pe(et(Nt)(T.changes),(G,xt)=>{var Et,Tt;return it(),ct("g",{class:"ivg-word-glyph-component",key:xt},[P("path",{d:Ht(G),fill:G.data.included?zt[G.data.action]:"white",stroke:G.data.included?"white":zt[G.data.action],"fill-opacity":G.data.weight>=et(_)?1:.1,"stroke-opacity":G.data.weight>=et(_)?1:.1},null,8,em),z(G.data)&&xt<3?(it(),ct("g",{key:0,transform:`translate(
                                    ${y.value(G.data.weight)*1.2},
                                    ${xt*14}
                                )`},[P("image",{y:-15,width:10,"xlink:href":n[G.data.action]},null,8,rm),P("text",{x:"10",stroke:((Et=Ae.value)==null?void 0:Et.text)===G.data.word?t.colorFocus:"white","stroke-width":"3","font-size":"0.7rem",style:es([{"paint-order":"stroke fill","font-weight":"300"},((Tt=Ae.value)==null?void 0:Tt.text)===G.data.word?"font-weight: bold;":"font-weight: 300;"]),onMouseenter:re=>On({action:G.data.action,text:G.data.word}),onMouseleave:N[3]||(N[3]=re=>On())},be(G.data.word),45,am)],8,nm)):te("",!0)])}),128))])],40,Kp))),128))],512)):te("",!0)],512),P("g",{class:"animation-ivg",ref_key:"ivgAnimation",ref:Mt},null,512),Ye(fp,{transform:"translate(5,5)",nodes:st.value,clusters:et(J)},null,8,["nodes","clusters"])],40,xp)),P("div",im,[P("div",sm,[P("div",om,[um,P("button",{class:Ee({active:he.value}),onClick:N[6]||(N[6]=T=>he.value=!he.value)},"annotation",2)]),P("div",lm,[cm,P("div",fm,[hm,dm,P("div",vm,be(et(k).length||1),1)])]),P("div",gm,[pm,mm,P("div",ym,[P("button",{class:Ee({active:jt.value}),onClick:N[7]||(N[7]=T=>jt.value=!0)},"show",2),P("button",{class:Ee({active:!jt.value}),onClick:N[8]||(N[8]=T=>jt.value=!1)},"hide",2)])]),P("div",_m,[bm,xm,P("div",wm,[P("button",{class:Ee({active:kt.value==="cluster"}),onClick:N[9]||(N[9]=T=>kt.value="cluster")},"cluster",2),P("button",{class:Ee({active:kt.value==="stage"}),onClick:N[10]||(N[10]=T=>kt.value="stage")},"exploration stage",2),P("button",{class:Ee({active:kt.value===null}),onClick:N[11]||(N[11]=T=>kt.value=null)},"hide",2)])])]),P("div",km,[P("div",Am,[Mm,P("button",{class:Ee({active:me.value}),onClick:N[12]||(N[12]=T=>me.value=!me.value)},"edge",2)]),P("div",$m,[P("div",Im,[Em,P("div",Tm,[P("img",{src:et(mp)},null,8,Sm),Nm]),P("div",Cm,[P("img",{src:et(yp)},null,8,Rm),Pm])]),P("div",Om,[P("div",Ym,[P("div",Fm,[P("img",{src:n.m},null,8,Xm),Dm])]),P("div",zm,[P("div",Lm,[P("img",{src:n.i},null,8,Gm),Hm]),P("div",Um,[P("img",{src:n.iw},null,8,qm),Vm])]),P("div",Bm,[P("div",Wm,[P("img",{src:n.r},null,8,Qm),Zm]),P("div",jm,[P("img",{src:n.rw},null,8,Jm),Km])])])])])]),Se.value?(it(),ct("div",{key:0,class:"tooltip flex space-x-2 p-2 bg-white bg-opacity-90",style:es({top:He.value.y+"px",left:He.value.x+"px"})},[P("div",t1,[P("img",{src:"data:image/png;base64,"+Se.value.data},null,8,e1)]),P("div",n1,[P("span",null,be(Se.value.promptId+1+". "),1),P("span",null,be(Se.value.prompt),1)])],4)):te("",!0)]))}});const a1=Cr(r1,[["__scopeId","data-v-838821d9"]]),i1={class:"flex bg-white"},s1={class:"flex w-35/85"},o1={class:"flex-grow"},u1={class:"h-full"},d1=Le({__name:"ThePanelVis",emits:["open-image"],setup(t,{emit:e}){const n=Vt(),r=ns(n),i=Vt(!1),o=Vt(),u=ns(o),l=Xt(()=>u.width.value),v=Xt(()=>u.height.value),f=Ls(),d=Un(),m=Gs(),{sessionId:_}=En(d),{records:k,images:R,image_projection:A,text_projection:J,clusters:D,edges:ft,edgeGroups:nt,cache:H}=En(f),{embeddingWeight:F,minSimilarity:V,clusterThresh:st,showIVG:$t,promptPairs:wt,stages:Mt,edgeWeightThresh:q,hovered:vt,selected:at}=En(m),x=Xt(()=>f.promptSimilarityMatrix),z=Xt(()=>{const _t={},rt={};k.value.forEach(dt=>{const St=dt.outputFilenames,h=dt.settingFilename;St.forEach(y=>{y=y.slice(0,y.lastIndexOf(".")),_t[y]=J.value[h]})});for(const[dt,St]of Object.entries(A.value))rt[dt]={x:F.value*St.x+(1-F.value)*_t[dt].x,y:F.value*St.y+(1-F.value)*_t[dt].y};return rt}),O=Xt(()=>{console.log("recompute history box records");const _t=k.value.map(rt=>({meta:{...rt,showDiff:!1},details:rt.outputFilenames.map(dt=>{const St=dt.slice(0,dt.lastIndexOf(".")),h=R.value[dt];return{id:St,data:h}})}));return wt.value.forEach(([rt,dt])=>{rt+1===dt&&(_t[dt].meta.showDiff=!0)}),H.value?[..._t,{meta:H.value,details:[]}]:_t}),Q=_t=>{m.setEdgeWeightThresh(_t)},ot=_t=>{m.setEdgeWeightMax(_t)},ht=Vt(!0);Xs(()=>{_.value!==null&&f.fetchSessionData()}),Te(_,()=>{ht.value=!1,f.emptyCache(),m.emptyPromptPairs(),m.emptyStages(),f.emptySessionData(),f.fetchSessionData(),ln(()=>{ht.value=!0})}),Te(()=>r,()=>{r.width.value!==0&&(i.value=!0)},{deep:!0}),Te(k,async(_t,rt)=>{!k||k.value.length===0||_t.length!==rt.length&&(m.emptyPromptPairs(),await f.tokenizePrompts(),m.filterPromptPairs(f.promptSimilarityMatrix),m.updateStages(f.promptSimilarityMatrix),await f.clusterImages(z.value,st.value),f.deriveEdges(wt.value))},{deep:!1}),Te(V,()=>{m.filterPromptPairs(f.promptSimilarityMatrix),m.updateStages(f.promptSimilarityMatrix),f.deriveEdges(wt.value)}),Te(st,async()=>{await f.clusterImages(z.value,st.value),f.deriveEdges(wt.value)});const ut=e;return(_t,rt)=>(it(),ct("div",i1,[P("div",{class:"w-50/85",ref_key:"ivgContainer",ref:o},[et($t)&&ht.value?(it(),br(a1,{key:0,records:et(k),images:et(R),projection:z.value,clusters:et(D),edges:et(ft),"edge-groups":et(nt),stages:et(Mt),"canvas-width":l.value,"canvas-height":v.value,"min-edge-weight":et(q),hovered:et(vt),onUpdateWeightThresh:Q,onUpdateMaxWeight:ot,onHoverImage:rt[0]||(rt[0]=dt=>et(m).setHovered({field:"image",value:dt,triggerView:"ivg"})),onUnhoverImage:rt[1]||(rt[1]=dt=>et(m).setHovered(null)),onClickImage:rt[2]||(rt[2]=dt=>et(m).setSelected({field:"image",value:dt,triggerView:"ivg"})),onOpenImage:rt[3]||(rt[3]=dt=>ut("open-image",dt)),onCopyPrompt:rt[4]||(rt[4]=dt=>et(m).setCopiedPrompt(dt))},null,8,["records","images","projection","clusters","edges","edge-groups","stages","canvas-width","canvas-height","min-edge-weight","hovered"])):te("",!0)],512),P("div",s1,[P("div",o1,[P("div",u1,[Ye(ih,{records:O.value,cache:et(H),hovered:et(vt),selected:et(at),onOpenImage:rt[5]||(rt[5]=dt=>ut("open-image",dt)),onCopyPrompt:rt[6]||(rt[6]=dt=>et(m).setCopiedPrompt(dt)),onHoverImage:rt[7]||(rt[7]=dt=>et(m).setHovered({field:"image",value:dt,triggerView:"historyBox"})),onUnhoverImage:rt[8]||(rt[8]=dt=>et(m).setHovered(null)),onHoverWord:rt[9]||(rt[9]=dt=>et(m).setHovered({field:"word",value:dt,triggerView:"historyBox"})),onUnhoverWord:rt[10]||(rt[10]=dt=>et(m).setHovered(null)),onHoverPrompt:rt[11]||(rt[11]=dt=>et(m).setHovered({field:"prompt",value:dt,triggerView:"historyBox"})),onUnhoverPrompt:rt[12]||(rt[12]=dt=>et(m).setHovered(null))},null,8,["records","cache","hovered","selected"])])]),P("div",{ref_key:"miniMapContainer",ref:n,class:"flex-shrink-0 w-16"},[i.value?(it(),br(tp,{key:0,"canvas-width":et(r).width.value,"canvas-height":et(r).height.value,records:et(k),links:et(wt),stages:et(Mt),"similarity-matrix":x.value,hovered:et(vt),onHoverPrompt:rt[13]||(rt[13]=dt=>et(m).setHovered({field:"prompt",value:dt,triggerView:"miniMap"})),onUnhoverPrompt:rt[14]||(rt[14]=dt=>et(m).setHovered(null)),onClickPrompt:rt[15]||(rt[15]=dt=>et(m).setSelected({field:"prompt",value:dt,triggerView:"miniMap"})),onUpdateStage:rt[16]||(rt[16]=dt=>et(m).segmentStages(dt))},null,8,["canvas-width","canvas-height","records","links","stages","similarity-matrix","hovered"])):te("",!0)],512)])]))}}),l1=["src"],c1=Le({__name:"VFullImage",props:{modalOpen:{type:Boolean,required:!0},imageData:{type:String,default:null}},emits:["close-image"],setup(t,{emit:e}){const n=t,{modalOpen:r,imageData:i}=Rn(n),o=e;return(u,l)=>(it(),br(zs,{name:"fade"},{default:Ds(()=>[et(r)?(it(),ct("div",{key:0,class:"modal",onClick:l[1]||(l[1]=yf(v=>o("close-image"),["self"]))},[P("span",{class:"close",onClick:l[0]||(l[0]=v=>o("close-image"))},"×"),et(i)?(it(),ct("img",{key:0,src:"data:image/png;base64,"+et(i),alt:"Full Image"},null,8,l1)):te("",!0)])):te("",!0)]),_:1}))}});const v1=Cr(c1,[["__scopeId","data-v-846fd371"]]);export{v1 as V,h1 as _,Gs as a,d1 as b,Ls as u};
